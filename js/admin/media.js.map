{"version":3,"file":"admin/media.js","mappings":"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","sources":["webpack://pdf-renderer/webpack/bootstrap","webpack://pdf-renderer/webpack/runtime/compat get default export","webpack://pdf-renderer/webpack/runtime/define property getters","webpack://pdf-renderer/webpack/runtime/hasOwnProperty shorthand","webpack://pdf-renderer/external var \"jQuery\"","webpack://pdf-renderer/external var \"mOxie\"","webpack://pdf-renderer/./src/js/lib/page-item.js","webpack://pdf-renderer/./src/js/lib/misc.js","webpack://pdf-renderer/./src/js/lib/pdf-frame.js","webpack://pdf-renderer/./src/js/admin/media/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var __WEBPACK_NAMESPACE_OBJECT__ = jQuery;","var __WEBPACK_NAMESPACE_OBJECT__ = mOxie;","\nconst PageItem = wp.media.View.extend({\n\ttemplate:  wp.template('pdf-page-item'),\n\tclassName:'pdf-page-item',\n\tevents: {\n\t}\n});\n\nexport { PageItem }\n","const pdfAllowed = _wpPluploadSettings.defaults.filters.mime_types[0].extensions.split(',').indexOf('pdf') !== -1\nconst { l10n, options } = pdf_renderer\n\n\nexport { pdfAllowed, l10n, options }\n","import $ from 'jquery';\nimport o from 'moxie';\nimport { PageItem } from 'page-item.js';\nimport { pdfAllowed, l10n, options } from 'misc.js';\n\npdfjsLib.GlobalWorkerOptions.workerSrc = options.worker_url;\n\nconst PDFFrame = wp.media.view.MediaFrame.extend({\n\ttemplate: wp.template('pdf-modal'),\n\tregions: [ 'title','content','instructions','buttons', 'pagenav' ],\n\tevents: {\n\t\t'click [data-page]' : 'clickPage',\n\t\t'click .media-modal-close' : function() {\n\t\t\tthis.trigger('cancel-upload');\n\t\t\tthis.reset().close();\n\t\t},\n\t\t'click [data-action=\"select-all\"]' : 'selectAll',\n\t\t'click [data-action=\"unselect-all\"]' : 'unselectAll'\n\t},\n\t_state: 'pdf-frame',\n\tinitialize: function() {\n\n\t\tconst self = this;\n\n\t\t_.defaults( this.options, {\n\t\t\tuploader:\tfalse,\n\t\t});\n\n\t\twp.media.view.MediaFrame.prototype.initialize.apply(this,arguments);\n\n\t\tthis._pdf = this._canvas = null;\n\t\tthis._current_page = 0;\n\n\t\tthis._uploadBtn = new wp.media.view.Button({\n\t\t\ttext: l10n.UploadImages,\n\t\t\tclassName: 'button-primary',\n\t\t\tclick:function() {\n\t\t\t\tself.trigger('cancel-upload');\n\t\t\t\tself.uploadImages();\n\t\t\t}\n\t\t});\n\t\tif ( pdfAllowed ) {\n\t\t\tthis._skipBtn = new wp.media.view.Button({\n\t\t\t\ttext: l10n.UploadPDF,\n\t\t\t\tclassName: 'upload-pdf',\n\t\t\t\tclick:function() {\n\t\t\t\t\tself.trigger('continue-upload');\n\t\t\t\t\tself.reset().close();\n\t\t\t\t\t// dismiss, continue with wp default behaviour\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tthis._cancelBtn = new wp.media.view.Button({\n\t\t\ttext: l10n.CancelUpload,\n\t\t\tclassName: 'cancel-upload',\n\t\t\tclick:function() {\n\t\t\t\tself.trigger('cancel-upload');\n\t\t\t\tself.reset().close();\n\t\t\t}\n\t\t});\n\n\t\tthis._pages = new Backbone.Collection();\n\t\tthis.listenTo(this._pages,'change:selected',function(e){\n\t\t\t// disable img upload btn if no pages selected\n\t\t\tthis._uploadBtn.$el.prop('disabled', ! this._pages.where( { selected: true } ).length )\n\t\t})\n\n\t\tthis.createTitle();\n\t\tthis.createButtons();\n\n\t\tthis.on( 'escape', () => {\n\t\t\tself.reset();\n\t\t\tself.trigger('cancel-upload');\n\t\t});\n\n\t\treturn this;\n\n\t},\n\trender:function() {\n\t\tconst ret = wp.media.view.MediaFrame.prototype.render.apply(this,arguments);\n\t\tthis.$(`[name=\"pdf-renderer-fileformat\"][value=\"${options.image_type}\"]`).prop('checked',true)\n\t\treturn ret;\n\t},\n\tgetImageType:function() {\n\t\treturn this.$('[name=\"pdf-renderer-fileformat\"]:checked').val();\n\t},\n\treset: function() {\n\t\tthis.actionBtn.forEach( btn => btn.$el.prop( 'disabled', false ) )\n\t\tthis.title.set([]);\n\t\tthis.content.set([]);\n\t\tthis.pagenav.set([]);\n\t\tthis._pages.reset([]);\n\t\tthis._pdf = this._canvas = null;\n\t\tthis._current_page = 0;\n\t\treturn this;\n\t},\n\tcreateTitle: function( ) {\n\t\tlet title;\n\t\tthis._title = new wp.media.View({\n\t\t\ttagName: 'h1'\n\t\t});\n\t\tif ( this.file ) {\n\t\t\ttitle = l10n.Upload + ': ' + this.file.file.name.replace(/\\.[a-z0-9]+$/,'');\n\t\t} else {\n\t\t\ttitle =\tl10n.pdfUpload;\n\t\t}\n\t\tthis._title.$el.text( title );\n\t\tthis.title.set( [ this._title ] );\n\t\treturn this;\n\t},\n\tcreateButtons: function() {\n\t\tthis.actionBtn = [];\n\n\t\tthis.actionBtn.push( this._cancelBtn );\n\t\tif ( !! this._skipBtn ) {\n\t\t\tthis.actionBtn.push( this._skipBtn );\n\t\t}\n\t\tthis.actionBtn.push( this._uploadBtn );\n\n\t\tthis.buttons.set( this.actionBtn );\n\t\treturn this;\n\t},\n\tsetFile:function( file ) {\n\t\tconst self = this,\n\t\t\tfileReader = new FileReader();\n\t\tthis.file = file;\n\t\tfileReader.onload = function(event) {\n//\t\t\t    arrayBuffer = event.target.result;\n\t\t\tself.parsePDF( event.target.result );\n\t\t};\n\t\tfileReader.readAsArrayBuffer( file.blob );\n\t\treturn this.createTitle();\n\t},\n\tclickPage:function(e) {\n\t\tthis.showPage($(e.target).attr('data-page'));\n\t},\n\trenderPageNav:function(numPages) {\n\t\tconst self = this, btns = [];\n\t\tlet m, i = 1, pgItem;\n\n\t\twhile ( this._pages.length ) {\n\t\t\tthis._pages.pop();\n\t\t}\n\n\t\tfor (i;i<=numPages;i++) {\n\t\t\tm = new Backbone.Model({\n\t\t\t\tid:i,\n\t\t\t\tselected:true,\n\t\t\t});\n\t\t\tthis._pages.add( m );\n\t\t\tpgItem = new PageItem({\n\t\t\t\tpagenum:i,\n\t\t\t\tselected:true,\n\t\t\t\tmodel:m,\n\t\t\t\tevents:{\n\t\t\t\t\t'change [type=\"radio\"]' : function(){\n\t\t\t\t\t\tif ( this.$('[type=\"radio\"]').prop('checked') ) {\n\t\t\t\t\t\t\tself.showPage( this.options.pagenum );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t'change [type=\"checkbox\"]' : function(){\n\t\t\t\t\t\tthis.model.set( 'selected', this.$('[type=\"checkbox\"]').prop('checked') );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tm.set( 'pageItem', pgItem );\n\t\t\tbtns.push( pgItem );\n\t\t}\n\t\tthis.pagenav.set( btns );\n\t},\n\tselectAll:function() {\n\t\tthis.$('.pdf-page-item > [type=\"checkbox\"]').each((i,el) => {\n\t\t\t$(el).prop('checked',true).trigger('change')\n\t\t})\n\t},\n\tunselectAll:function() {\n\t\tthis.$('.pdf-page-item > [type=\"checkbox\"]').each((i,el) => {\n\t\t\t$(el).prop('checked',false).trigger('change')\n\t\t})\n\t},\n\tparsePDF: function( arr ) {\n\t\tconst self = this;\n\t\tpdfjsLib.getDocument(arr).promise.then(\n\t\t\tpdf => {\n\t\t\t\tself._pdf = pdf;\n\t\t\t\tself.renderPageNav(pdf.numPages)\n\n\t\t\t\tself.showPage(1);\n\t\t\t},\n\t\t\tconsole.error\n\t\t)\n\t},\n\tshowPage:function(idx) {\n\t\tconst self = this,\n\t\t\tm = this._pages.get(idx);\n\n\t\tif ( !! m.get('canvas') ) {\n\t\t\tthis.content.set( [\n\t\t\t\tnew wp.media.View({\n\t\t\t\t\tel: m.get('canvas'),\n\t\t\t\t})\n\t\t\t] );\n\t\t} else {\n\t\t\tthis.content.set([new Backbone.View()])\n\t\t\tthis.renderPage( idx, function(){\n\t\t\t\tself.showPage(idx);\n\t\t\t} );\n\t\t}\n\n\t},\n\trenderPage:function(idx,cb,cb_args) {\n\t\tconst self = this,\n\t\t\tm = this._pages.get(idx);\n\t\t(async () => {\n\t\t\tconst page = await self._pdf.getPage(idx),\n\t\t\t\tcanvas = $('<canvas></canvas>').get(0),\n\t\t\t\tctx = canvas.getContext('2d');\n\n\t\t\tlet vp = page.getViewport({scale:1});\n\n\t\t\tvp = page.getViewport( { scale: options.image_width / vp.width } );\n\n\t\t\tcanvas.width = vp.width;\n\t\t\tcanvas.height = vp.height;\n\n\t\t\tpage.render({\n\t\t\t\tcanvasContext: ctx,\n\t\t\t\tviewport: vp,\n\t\t\t}).promise.then(() => {\n\t\t\t\tm.set( 'page', page );\n\t\t\t\tm.set( 'canvas', canvas );\n\t\t\t\t!!cb && cb.apply(m,cb_args||[]);\n\t\t\t});\n\n\n\t\t})();\n\t},\n\n\tuploadImages:function() {\n\t\tconst self = this,\n\t\t\ttype = self.getImageType(),\n\t\t\tupload = function( name ) {\n\t\t\t\tconst m = this;\n\n\t\t\t\tthis.get('canvas').toBlob( function(blob) {\n\n\t\t\t\t\tconst file = new File( [blob], name, { type } );\n\n\t\t\t\t\tself.options.uploader.addFile( file );\n\t\t\t\t\tm.set( 'selected', false );\n\n\t\t\t\t}, type, options.jpeg_quality * 0.01 )\n\n\t\t\t};\n\n\t\tthis.actionBtn.forEach( btn => btn.$el.prop('disabled',true) )\n\n\t\t// create e new media model from blob data URL thingy\n\t\t_.each( this._pages.where( { selected: true } ), ( pg, i ) => {\n\n\t\t\tconst name = self.file.file.name.replace(/\\.[a-z0-9]+$/,'') + '-p' + i + '.' + ( 'image/png'  === type ? 'png' : 'jpg' );\n\n\t\t\tif ( ! pg.get('canvas') ) {\n\t\t\t\t// needs rendering\n\t\t\t\tself.renderPage( pg.get('id'), upload,[name]);\n\t\t\t} else {\n\t\t\t\tupload.apply(pg,[name])\n\t\t\t}\n\t\t});\n\t\tthis.reset().close()\n\t}\n});\n\nexport { PDFFrame }\n","import $ from 'jquery';\nimport { PDFFrame } from 'pdf-frame.js';\nimport { pdfAllowed, l10n } from 'misc.js';\n\n\n\n// temporaily add pdf type to plupload settings,\n// so the uploader doesn't cancel too early.\n// File types are checked server-side too, so\n// there should be no security implications.\nif ( ! pdfAllowed ) {\n\t_wpPluploadSettings.defaults.filters.mime_types[0].extensions += ',pdf';\n}\n\n\n// extend WP Uploader window\n_.extend( wp.media.view.UploaderWindow.prototype, {\n\t_parentReady: wp.media.view.UploaderWindow.prototype.ready,\n\tdidReady:false,\n\n\tready:function() {\n\t\tconst pdfs = [],\n\t\t\tself = this;\n\t\tlet pdfModal, ret;\n\n\t\t// prevent double init\n\t\tif ( this.didReady ) {\n\t\t\treturn this._parentReady.apply( this , arguments );\n\t\t}\n\t\tthis.didReady = true;\n\n\t\tret = this._parentReady.apply( this , arguments );\n\n\t\tfunction pdfPopup( uploader, fileItem ) {\n\n\t\t\tif ( pdfModal ) {\n\t\t\t\tpdfModal.reset().close().dispose();\n\t\t\t} else {\n\t\t\t\tpdfModal = new PDFFrame( {\n\t\t\t\t\tcontroller: $(this),\n\t\t\t\t\tuploader:uploader\n\t\t\t\t} );\n\t\t\t\tpdfModal.on('cancel-upload', () => {\n\t\t\t\t\t// stop ecerything!\n\t\t\t\t\tuploader.removeFile( pdfModal.file.file );\n\t\t\t\t\tpdfModal.file.file.attachment.destroy();\n\n\t\t\t\t}).on('continue-upload',() => {\n\t\t\t\t\t// go ahead with a normal WP upload..\n\t\t\t\t\tuploader.start();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tpdfModal.setFile( fileItem );\n\t\t\tpdfModal.open();\n\t\t}\n\n\t\t/**\n\t\t *\t@return native file object or blob\n\t\t */\n\t\tfunction resolveFile( file ) {\n\t\t\tconst _ret = {\n\t\t\t\tfile: file,\n\t\t\t\tblob:file.getNative()\n\t\t\t};\n\t\t\tif ( ! _ret.blob ) {\n\t\t\t\t_ret.blob = file.getSource();\n\t\t\t}\n\t\t\treturn _ret;\n\t\t}\n\n\t\t// send cropdata\n\t\tthis.uploader.uploader.bind('BeforeUpload',function( up, file ) {\n\n\t\t\tif ( file.type == 'application/pdf') {\n\n\t\t\t\tconst fileData = resolveFile( file );\n\t\t\t\tif ( fileData.blob instanceof Blob ) {\n\t\t\t\t\tup.stop();\n\t\t\t\t\tup.refresh();\n\t\t\t\t\tpdfPopup( up, fileData ); // will ask for focus or start uploader\n\t\t\t\t}\n\t\t\t}\n\n\t\t});\n\t\treturn ret;\n\t}\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","jQuery","mOxie","PageItem","wp","media","View","extend","template","className","events","pdfAllowed","_wpPluploadSettings","defaults","filters","mime_types","extensions","split","indexOf","l10n","options","pdf_renderer","pdfjsLib","GlobalWorkerOptions","workerSrc","worker_url","PDFFrame","view","MediaFrame","regions","this","trigger","reset","close","_state","initialize","self","_","uploader","apply","arguments","_pdf","_canvas","_current_page","_uploadBtn","Button","text","UploadImages","click","uploadImages","_skipBtn","UploadPDF","_cancelBtn","CancelUpload","_pages","Backbone","Collection","listenTo","e","$el","where","selected","length","createTitle","createButtons","on","render","ret","$","image_type","getImageType","val","actionBtn","forEach","btn","title","set","content","pagenav","_title","tagName","file","Upload","name","replace","pdfUpload","push","buttons","setFile","fileReader","FileReader","onload","event","parsePDF","target","result","readAsArrayBuffer","blob","clickPage","showPage","attr","renderPageNav","numPages","btns","m","pgItem","i","pop","Model","id","add","pagenum","model","selectAll","each","el","unselectAll","arr","getDocument","promise","then","pdf","console","error","idx","renderPage","cb","cb_args","page","getPage","canvas","ctx","getContext","vp","getViewport","scale","image_width","width","height","canvasContext","viewport","type","upload","toBlob","File","addFile","jpeg_quality","pg","UploaderWindow","_parentReady","ready","didReady","pdfModal","bind","up","fileData","_ret","getNative","getSource","resolveFile","Blob","stop","refresh","fileItem","dispose","controller","removeFile","attachment","destroy","start","open","pdfPopup"],"sourceRoot":""}