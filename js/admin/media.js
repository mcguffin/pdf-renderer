!function s(o,r,l){function p(t,e){if(!r[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var a=r[t]={exports:{}};o[t][0].call(a.exports,function(e){return p(o[t][1][e]||e)},a,a.exports,s,o,r,l)}return r[t].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)p(l[e]);return p}({1:[function(n,e,t){(function(e){"use strict";var a=t("undefined"!=typeof window?window.jQuery:void 0!==e?e.jQuery:null),s=t(n("pdf-frame.js"));function t(e){return e&&e.__esModule?e:{default:e}}n("misc.js").pdfAllowed||(_wpPluploadSettings.defaults.filters.mime_types[0].extensions+=",pdf"),_.extend(wp.media.view.UploaderWindow.prototype,{_parentReady:wp.media.view.UploaderWindow.prototype.ready,didReady:!1,ready:function(){var i,e;if(this.didReady)return this._parentReady.apply(this,arguments);return this.didReady=!0,e=this._parentReady.apply(this,arguments),this.uploader.uploader.bind("BeforeUpload",function(e,t){if("application/pdf"==t.type){var n=function(e){var t={file:e,blob:e.getNative()};return t.blob||(t.blob=e.getSource()),t}(t);n.blob instanceof Blob&&(e.stop(),e.refresh(),function(e,t){i?i.reset().close().dispose():(i=new s.default({controller:(0,a.default)(this),uploader:e})).on("cancel-upload",function(){e.removeFile(i.file.file),i.file.file.attachment.destroy()}).on("continue-upload",function(){e.start()}),i.setFile(t),i.open()}(e,n))}}),e}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"misc.js":2,"pdf-frame.js":4}],2:[function(e,t,n){"use strict";t.exports={pdfAllowed:-1!==_wpPluploadSettings.defaults.filters.mime_types[0].extensions.split(",").indexOf("pdf"),l10n:pdf_renderer.l10n,options:pdf_renderer.options}},{}],3:[function(e,t,n){"use strict";t.exports=wp.media.View.extend({template:wp.template("pdf-page-item"),className:"pdf-page-item",events:{}})},{}],4:[function(i,a,e){(function(e){"use strict";var c=t("undefined"!=typeof window?window.jQuery:void 0!==e?e.jQuery:null),o=t("undefined"!=typeof window?window.mOxie:void 0!==e?e.mOxie:null),s=t(i("page-item.js")),d=i("misc.js");function t(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n,i,a,s,o){try{var r=e[s](o),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}function n(r){return function(){var e=this,o=arguments;return new Promise(function(t,n){var i=r.apply(e,o);function a(e){l(i,t,n,a,s,"next",e)}function s(e){l(i,t,n,a,s,"throw",e)}a(void 0)})}}a.exports=wp.media.view.MediaFrame.extend({template:wp.template("pdf-modal"),regions:["title","content","instructions","buttons","pagenav"],events:{"click [data-page]":"clickPage","click .media-modal-close":function(){this.trigger("cancel-upload"),this.reset().close()}},initialize:function(){var e=this;return _.defaults(this.options,{uploader:!1}),wp.media.view.MediaFrame.prototype.initialize.apply(this,arguments),this._pdf=this._canvas=null,this._current_page=0,this._uploadBtn=new wp.media.view.Button({text:d.l10n.UploadImages,className:"button-primary",click:function(){e.trigger("cancel-upload"),e.uploadImages()}}),d.pdfAllowed&&(this._skipBtn=new wp.media.view.Button({text:d.l10n.UploadPDF,className:"upload-pdf",click:function(){e.trigger("continue-upload"),e.reset().close()}})),this._cancelBtn=new wp.media.view.Button({text:d.l10n.CancelUpload,className:"cancel-upload",click:function(){e.trigger("cancel-upload"),e.reset().close()}}),this._pages=new Backbone.Collection,this.listenTo(this._pages,"change:selected",function(e){this._uploadBtn.$el.prop("disabled",!this._pages.where({selected:!0}).length)}),this.createTitle(),this.createButtons(),this.on("escape",function(){e.reset(),e.trigger("cancel-upload")}),this},reset:function(){return this.actionBtn.forEach(function(e){return e.$el.prop("disabled",!1)}),this.title.set([]),this.content.set([]),this.pagenav.set([]),this._pages.reset([]),this._pdf=this._canvas=null,this._current_page=0,this},createTitle:function(){var e;return this._title=new wp.media.View({tagName:"h1"}),e=this.file?d.l10n.Upload+": "+this.file.file.name.replace(/\.[a-z0-9]+$/,""):d.l10n.pdfUpload,this._title.$el.text(e),this.title.set([this._title]),this},createButtons:function(){return this.actionBtn=[],this.actionBtn.push(this._cancelBtn),this._skipBtn&&this.actionBtn.push(this._skipBtn),this.actionBtn.push(this._uploadBtn),this.buttons.set(this.actionBtn),this},setFile:function(e){var t=this,n=new FileReader;return this.file=e,n.onload=function(e){t.parsePDF(e.target.result)},n.readAsArrayBuffer(e.blob),this.createTitle()},clickPage:function(e){this.showPage((0,c.default)(e.target).attr("data-page"))},renderPageNav:function(e){for(var t,n=this,i=[],a=1;this._pages.length;)this._pages.pop();for(;a<=e;a++)t=new Backbone.Model({id:a,selected:!0}),this._pages.add(t),i.push(new s.default({pagenum:a,selected:!0,model:t,events:{'change [type="radio"]':function(){this.$('[type="radio"]').prop("checked")&&n.showPage(this.options.pagenum)},'change [type="checkbox"]':function(){this.model.set("selected",this.$('[type="checkbox"]').prop("checked"))}}}));this.pagenav.set(i)},parsePDF:function(e){var t,i=this;t=n(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pdfjsLib.getDocument(t);case 2:n=e.sent,i._pdf=n,i.renderPageNav(n.numPages),i.showPage(1);case 6:case"end":return e.stop()}},e)})),function(e){t.apply(this,arguments)}(e)},showPage:function(e){var t=this,n=this._pages.get(e);n.get("canvas")?this.content.set([new wp.media.View({el:n.get("canvas")})]):(this.content.set([new Backbone.View]),this.renderPage(e,function(){t.showPage(e)}))},renderPage:function(s,o,r){var l=this,p=this._pages.get(s);n(regeneratorRuntime.mark(function e(){var t,n,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l._pdf.getPage(s);case 2:return t=e.sent,n=(0,c.default)("<canvas></canvas>").get(0),i=n.getContext("2d"),a=t.getViewport({scale:1}),a=t.getViewport({scale:d.options.image_width/a.width}),n.width=a.width,n.height=a.height,e.next=11,t.render({canvasContext:i,viewport:a});case 11:p.set("page",t),p.set("canvas",n),o&&o.apply(p,r||[]);case 14:case"end":return e.stop()}},e)}))()},uploadImages:function(){function i(e){var t=new o.default.Image,n=this;t.onload=function(){t.name=e,t.type=s,a.options.uploader.addFile(t.getAsBlob(),e),n.set("selected",!1),a._pages.where({selected:!0}).length||(a.trigger("complete"),a.reset().close())},t.load(this.get("canvas").toDataURL(d.options.image_type,.01*d.options.jpeg_quality)),(0,c.default)("body").append(t)}var a=this,s=d.options.image_type;this.actionBtn.forEach(function(e){return e.$el.prop("disabled",!0)}),_.each(),_.each(this._pages.where({selected:!0}),function(e,t){var n=a.file.file.name.replace(/\.[a-z0-9]+$/,"")+"-p"+t+".png";e.get("canvas")?i.apply(e,[n]):a.renderPage(e.get("id"),i,[n])})}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"misc.js":2,"page-item.js":3}]},{},[1]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluL25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhZG1pbi9zcmMvanMvYWRtaW4vbWVkaWEvaW5kZXguanMiLCJhZG1pbi9zcmMvanMvbGliL21pc2MuanMiLCJhZG1pbi9zcmMvanMvbGliL3BhZ2UtaXRlbS5qcyIsImFkbWluL3NyYy9qcy9saWIvcGRmLWZyYW1lLmpzIl0sIm5hbWVzIjpbInIiLCJlIiwibiIsInQiLCJvIiwiaSIsImYiLCJjIiwicmVxdWlyZSIsInUiLCJhIiwiRXJyb3IiLCJjb2RlIiwicCIsImV4cG9ydHMiLCJjYWxsIiwibGVuZ3RoIiwiMSIsIm1vZHVsZSIsIl9qcXVlcnkiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Iiwid2luZG93IiwiZ2xvYmFsIiwiX3BkZkZyYW1lIiwicGRmQWxsb3dlZCIsIl93cFBsdXBsb2FkU2V0dGluZ3MiLCJkZWZhdWx0cyIsImZpbHRlcnMiLCJtaW1lX3R5cGVzIiwiZXh0ZW5zaW9ucyIsIl8iLCJleHRlbmQiLCJ3cCIsIm1lZGlhIiwidmlldyIsIlVwbG9hZGVyV2luZG93IiwicHJvdG90eXBlIiwiX3BhcmVudFJlYWR5IiwicmVhZHkiLCJkaWRSZWFkeSIsInBkZk1vZGFsIiwicmV0IiwidGhpcyIsImFwcGx5IiwiYXJndW1lbnRzIiwidXBsb2FkZXIiLCJiaW5kIiwidXAiLCJmaWxlIiwidHlwZSIsImZpbGVEYXRhIiwiX3JldCIsImJsb2IiLCJnZXROYXRpdmUiLCJnZXRTb3VyY2UiLCJyZXNvbHZlRmlsZSIsIkJsb2IiLCJzdG9wIiwicmVmcmVzaCIsImZpbGVJdGVtIiwicmVzZXQiLCJjbG9zZSIsImRpc3Bvc2UiLCJkZWZhdWx0IiwiY29udHJvbGxlciIsIm9uIiwicmVtb3ZlRmlsZSIsImF0dGFjaG1lbnQiLCJkZXN0cm95Iiwic3RhcnQiLCJzZXRGaWxlIiwib3BlbiIsInBkZlBvcHVwIiwic3BsaXQiLCJpbmRleE9mIiwibDEwbiIsInBkZl9yZW5kZXJlciIsIm9wdGlvbnMiLCJWaWV3IiwidGVtcGxhdGUiLCJjbGFzc05hbWUiLCJldmVudHMiLCJfbW94aWUiLCJfcGFnZUl0ZW0iLCJfbWlzYyIsIk1lZGlhRnJhbWUiLCJyZWdpb25zIiwiY2xpY2sgW2RhdGEtcGFnZV0iLCJjbGljayAubWVkaWEtbW9kYWwtY2xvc2UiLCJ0cmlnZ2VyIiwiaW5pdGlhbGl6ZSIsInNlbGYiLCJfcGRmIiwiX2NhbnZhcyIsIl9jdXJyZW50X3BhZ2UiLCJfdXBsb2FkQnRuIiwiQnV0dG9uIiwidGV4dCIsIlVwbG9hZEltYWdlcyIsImNsaWNrIiwidXBsb2FkSW1hZ2VzIiwiX3NraXBCdG4iLCJVcGxvYWRQREYiLCJfY2FuY2VsQnRuIiwiQ2FuY2VsVXBsb2FkIiwiX3BhZ2VzIiwiQmFja2JvbmUiLCJDb2xsZWN0aW9uIiwibGlzdGVuVG8iLCIkZWwiLCJwcm9wIiwid2hlcmUiLCJzZWxlY3RlZCIsImNyZWF0ZVRpdGxlIiwiY3JlYXRlQnV0dG9ucyIsImFjdGlvbkJ0biIsImZvckVhY2giLCJidG4iLCJ0aXRsZSIsInNldCIsImNvbnRlbnQiLCJwYWdlbmF2IiwiX3RpdGxlIiwidGFnTmFtZSIsIlVwbG9hZCIsIm5hbWUiLCJyZXBsYWNlIiwicGRmVXBsb2FkIiwicHVzaCIsImJ1dHRvbnMiLCJmaWxlUmVhZGVyIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsImV2ZW50IiwicGFyc2VQREYiLCJ0YXJnZXQiLCJyZXN1bHQiLCJyZWFkQXNBcnJheUJ1ZmZlciIsImNsaWNrUGFnZSIsInNob3dQYWdlIiwiYXR0ciIsInJlbmRlclBhZ2VOYXYiLCJudW1QYWdlcyIsIm0iLCJidG5zIiwicG9wIiwiTW9kZWwiLCJpZCIsImFkZCIsInBhZ2VudW0iLCJtb2RlbCIsImNoYW5nZSBbdHlwZT1cInJhZGlvXCJdIiwiJCIsImNoYW5nZSBbdHlwZT1cImNoZWNrYm94XCJdIiwiYXJyIiwiX3JlZiIsIl9hc3luY1RvR2VuZXJhdG9yIiwicmVnZW5lcmF0b3JSdW50aW1lIiwibWFyayIsIl9jYWxsZWUiLCJwZGYiLCJ3cmFwIiwiX2NvbnRleHQiLCJwcmV2IiwibmV4dCIsInBkZmpzTGliIiwiZ2V0RG9jdW1lbnQiLCJzZW50IiwiX3giLCJpZHgiLCJnZXQiLCJlbCIsInJlbmRlclBhZ2UiLCJjYiIsImNiX2FyZ3MiLCJfY2FsbGVlMiIsInBhZ2UiLCJjYW52YXMiLCJjdHgiLCJ2cCIsIl9jb250ZXh0MiIsImdldFBhZ2UiLCJnZXRDb250ZXh0IiwiZ2V0Vmlld3BvcnQiLCJzY2FsZSIsImltYWdlX3dpZHRoIiwid2lkdGgiLCJoZWlnaHQiLCJyZW5kZXIiLCJjYW52YXNDb250ZXh0Iiwidmlld3BvcnQiLCJ1cGxvYWQiLCJpbWciLCJJbWFnZSIsImFkZEZpbGUiLCJnZXRBc0Jsb2IiLCJsb2FkIiwidG9EYXRhVVJMIiwiaW1hZ2VfdHlwZSIsImpwZWdfcXVhbGl0eSIsImFwcGVuZCIsImVhY2giLCJwZyJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsRUFBQUMsRUFBQUMsR0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUFBLElBQUFKLEVBQUFHLEdBQUEsQ0FBQSxJQUFBSixFQUFBSSxHQUFBLENBQUEsSUFBQUUsRUFBQSxtQkFBQUMsU0FBQUEsUUFBQSxJQUFBRixHQUFBQyxFQUFBLE9BQUFBLEVBQUFGLEdBQUEsR0FBQSxHQUFBSSxFQUFBLE9BQUFBLEVBQUFKLEdBQUEsR0FBQSxJQUFBSyxFQUFBLElBQUFDLE1BQUEsdUJBQUFOLEVBQUEsS0FBQSxNQUFBSyxFQUFBRSxLQUFBLG1CQUFBRixFQUFBLElBQUFHLEVBQUFYLEVBQUFHLEdBQUEsQ0FBQVMsUUFBQSxJQUFBYixFQUFBSSxHQUFBLEdBQUFVLEtBQUFGLEVBQUFDLFFBQUEsU0FBQWQsR0FBQSxPQUFBSSxFQUFBSCxFQUFBSSxHQUFBLEdBQUFMLElBQUFBLElBQUFhLEVBQUFBLEVBQUFDLFFBQUFkLEVBQUFDLEVBQUFDLEVBQUFDLEdBQUEsT0FBQUQsRUFBQUcsR0FBQVMsUUFBQSxJQUFBLElBQUFMLEVBQUEsbUJBQUFELFNB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LHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xuaW1wb3J0IFBERkZyYW1lIGZyb20gJ3BkZi1mcmFtZS5qcyc7XG5pbXBvcnQgeyBwZGZBbGxvd2VkLCBsMTBuIH0gZnJvbSAnbWlzYy5qcyc7XG5cblxuXG4vLyB0ZW1wb3JhaWx5IGFkZCBwZGYgdHlwZSB0byBwbHVwbG9hZCBzZXR0aW5ncyxcbi8vIHNvIHRoZSB1cGxvYWRlciBkb2Vzbid0IGNhbmNlbCB0b28gZWFybHkuXG4vLyBGaWxlIHR5cGVzIGFyZSBjaGVja2VkIHNlcnZlci1zaWRlIHRvbywgc29cbi8vIHRoZXJlIHNob3VsZCBiZSBubyBzZWN1cml0eSBpbXBsaWNhdGlvbnMuXG5pZiAoICEgcGRmQWxsb3dlZCApIHtcblx0X3dwUGx1cGxvYWRTZXR0aW5ncy5kZWZhdWx0cy5maWx0ZXJzLm1pbWVfdHlwZXNbMF0uZXh0ZW5zaW9ucyArPSAnLHBkZic7XG59XG5cbi8vIGV4dGVuZCBXUCBVcGxvYWRlciB3aW5kb3dcbl8uZXh0ZW5kKCB3cC5tZWRpYS52aWV3LlVwbG9hZGVyV2luZG93LnByb3RvdHlwZSwge1xuXHRfcGFyZW50UmVhZHk6IHdwLm1lZGlhLnZpZXcuVXBsb2FkZXJXaW5kb3cucHJvdG90eXBlLnJlYWR5LFxuXHRkaWRSZWFkeTpmYWxzZSxcblxuXHRyZWFkeTpmdW5jdGlvbigpIHtcblx0XHRjb25zdCBwZGZzID0gW10sIFxuXHRcdFx0c2VsZiA9IHRoaXM7XG5cdFx0bGV0IHBkZk1vZGFsLCByZXQ7XG5cblx0XHQvLyBwcmV2ZW50IGRvdWJsZSBpbml0XG5cdFx0aWYgKCB0aGlzLmRpZFJlYWR5ICkge1xuXHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudFJlYWR5LmFwcGx5KCB0aGlzICwgYXJndW1lbnRzICk7XG5cdFx0fVxuXHRcdHRoaXMuZGlkUmVhZHkgPSB0cnVlO1xuXG5cdFx0cmV0ID0gdGhpcy5fcGFyZW50UmVhZHkuYXBwbHkoIHRoaXMgLCBhcmd1bWVudHMgKTtcblxuXHRcdGZ1bmN0aW9uIHBkZlBvcHVwKCB1cGxvYWRlciwgZmlsZUl0ZW0gKSB7XG5cblx0XHRcdGlmICggcGRmTW9kYWwgKSB7XG5cdFx0XHRcdHBkZk1vZGFsLnJlc2V0KCkuY2xvc2UoKS5kaXNwb3NlKCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRwZGZNb2RhbCA9IG5ldyBQREZGcmFtZSgge1xuXHRcdFx0XHRcdGNvbnRyb2xsZXI6ICQodGhpcyksXG5cdFx0XHRcdFx0dXBsb2FkZXI6dXBsb2FkZXJcblx0XHRcdFx0fSApO1xuXHRcdFx0XHRwZGZNb2RhbC5vbignY2FuY2VsLXVwbG9hZCcsICgpID0+IHtcblx0XHRcdFx0XHQvLyBzdG9wIGVjZXJ5dGhpbmchXG5cdFx0XHRcdFx0dXBsb2FkZXIucmVtb3ZlRmlsZSggcGRmTW9kYWwuZmlsZS5maWxlICk7XG5cdFx0XHRcdFx0cGRmTW9kYWwuZmlsZS5maWxlLmF0dGFjaG1lbnQuZGVzdHJveSgpO1xuXG5cdFx0XHRcdH0pLm9uKCdjb250aW51ZS11cGxvYWQnLCgpID0+IHtcblx0XHRcdFx0XHQvLyBnbyBhaGVhZCB3aXRoIGEgbm9ybWFsIFdQIHVwbG9hZC4uXG5cdFx0XHRcdFx0dXBsb2FkZXIuc3RhcnQoKTtcblx0XHRcdFx0fSk7XHRcdFx0XHRcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0cGRmTW9kYWwuc2V0RmlsZSggZmlsZUl0ZW0gKTtcblx0XHRcdHBkZk1vZGFsLm9wZW4oKTtcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKlx0QHJldHVybiBuYXRpdmUgZmlsZSBvYmplY3Qgb3IgYmxvYlxuXHRcdCAqL1xuXHRcdGZ1bmN0aW9uIHJlc29sdmVGaWxlKCBmaWxlICkge1xuXHRcdFx0Y29uc3QgX3JldCA9IHtcblx0XHRcdFx0ZmlsZTogZmlsZSxcblx0XHRcdFx0YmxvYjpmaWxlLmdldE5hdGl2ZSgpXG5cdFx0XHR9O1xuXHRcdFx0aWYgKCAhIF9yZXQuYmxvYiApIHtcblx0XHRcdFx0X3JldC5ibG9iID0gZmlsZS5nZXRTb3VyY2UoKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBfcmV0O1xuXHRcdH1cblxuXHRcdC8vIHNlbmQgY3JvcGRhdGFcblx0XHR0aGlzLnVwbG9hZGVyLnVwbG9hZGVyLmJpbmQoJ0JlZm9yZVVwbG9hZCcsZnVuY3Rpb24oIHVwLCBmaWxlICkge1xuXG5cdFx0XHRpZiAoIGZpbGUudHlwZSA9PSAnYXBwbGljYXRpb24vcGRmJykge1xuXG5cdFx0XHRcdGNvbnN0IGZpbGVEYXRhID0gcmVzb2x2ZUZpbGUoIGZpbGUgKTtcblx0XHRcdFx0aWYgKCBmaWxlRGF0YS5ibG9iIGluc3RhbmNlb2YgQmxvYiApIHtcblx0XHRcdFx0XHR1cC5zdG9wKCk7XG5cdFx0XHRcdFx0dXAucmVmcmVzaCgpO1xuXHRcdFx0XHRcdHBkZlBvcHVwKCB1cCwgZmlsZURhdGEgKTsgLy8gd2lsbCBhc2sgZm9yIGZvY3VzIG9yIHN0YXJ0IHVwbG9hZGVyXG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdH0pO1xuXHRcdHJldHVybiByZXQ7XG5cdH1cbn0pO1xuIiwibW9kdWxlLmV4cG9ydHMgPSB7XG5cdHBkZkFsbG93ZWQ6IF93cFBsdXBsb2FkU2V0dGluZ3MuZGVmYXVsdHMuZmlsdGVycy5taW1lX3R5cGVzWzBdLmV4dGVuc2lvbnMuc3BsaXQoJywnKS5pbmRleE9mKCdwZGYnKSAhPT0gLTEsXG5cdGwxMG46IHBkZl9yZW5kZXJlci5sMTBuLFxuXHRvcHRpb25zOiBwZGZfcmVuZGVyZXIub3B0aW9uc1xufVxuIiwiXG5tb2R1bGUuZXhwb3J0cyA9IHdwLm1lZGlhLlZpZXcuZXh0ZW5kKHtcblx0dGVtcGxhdGU6ICB3cC50ZW1wbGF0ZSgncGRmLXBhZ2UtaXRlbScpLFxuXHRjbGFzc05hbWU6J3BkZi1wYWdlLWl0ZW0nLFxuXHRldmVudHM6IHtcblx0fVxufSk7XG4iLCJpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xuaW1wb3J0IG8gZnJvbSAnbW94aWUnO1xuaW1wb3J0IFBhZ2VJdGVtIGZyb20gJ3BhZ2UtaXRlbS5qcyc7XG5pbXBvcnQgeyBwZGZBbGxvd2VkLCBsMTBuLCBvcHRpb25zIH0gZnJvbSAnbWlzYy5qcyc7XG5cbm1vZHVsZS5leHBvcnRzID0gd3AubWVkaWEudmlldy5NZWRpYUZyYW1lLmV4dGVuZCh7XG5cdHRlbXBsYXRlOiB3cC50ZW1wbGF0ZSgncGRmLW1vZGFsJyksXG5cdHJlZ2lvbnM6IFsgJ3RpdGxlJywnY29udGVudCcsJ2luc3RydWN0aW9ucycsJ2J1dHRvbnMnLCAncGFnZW5hdicgXSxcblx0ZXZlbnRzOiB7XG5cdFx0J2NsaWNrIFtkYXRhLXBhZ2VdJyA6ICdjbGlja1BhZ2UnLFxuXHRcdCdjbGljayAubWVkaWEtbW9kYWwtY2xvc2UnIDogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLnRyaWdnZXIoJ2NhbmNlbC11cGxvYWQnKTtcblx0XHRcdHRoaXMucmVzZXQoKS5jbG9zZSgpO1xuXHRcdH1cblx0fSxcblx0aW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG5cblx0XHRjb25zdCBzZWxmID0gdGhpcztcblxuXHRcdF8uZGVmYXVsdHMoIHRoaXMub3B0aW9ucywge1xuXHRcdFx0dXBsb2FkZXI6XHRmYWxzZSxcblx0XHR9KTtcblxuXHRcdHdwLm1lZGlhLnZpZXcuTWVkaWFGcmFtZS5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cblx0XHR0aGlzLl9wZGYgPSB0aGlzLl9jYW52YXMgPSBudWxsO1xuXHRcdHRoaXMuX2N1cnJlbnRfcGFnZSA9IDA7XG5cblx0XHR0aGlzLl91cGxvYWRCdG4gPSBuZXcgd3AubWVkaWEudmlldy5CdXR0b24oe1xuXHRcdFx0dGV4dDogbDEwbi5VcGxvYWRJbWFnZXMsXG5cdFx0XHRjbGFzc05hbWU6ICdidXR0b24tcHJpbWFyeScsXG5cdFx0XHRjbGljazpmdW5jdGlvbigpIHtcblx0XHRcdFx0c2VsZi50cmlnZ2VyKCdjYW5jZWwtdXBsb2FkJyk7XG5cdFx0XHRcdHNlbGYudXBsb2FkSW1hZ2VzKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0aWYgKCBwZGZBbGxvd2VkICkge1xuXHRcdFx0dGhpcy5fc2tpcEJ0biA9IG5ldyB3cC5tZWRpYS52aWV3LkJ1dHRvbih7XG5cdFx0XHRcdHRleHQ6IGwxMG4uVXBsb2FkUERGLFxuXHRcdFx0XHRjbGFzc05hbWU6ICd1cGxvYWQtcGRmJyxcblx0XHRcdFx0Y2xpY2s6ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0c2VsZi50cmlnZ2VyKCdjb250aW51ZS11cGxvYWQnKTtcblx0XHRcdFx0XHRzZWxmLnJlc2V0KCkuY2xvc2UoKTtcblx0XHRcdFx0XHQvLyBkaXNtaXNzLCBjb250aW51ZSB3aXRoIHdwIGRlZmF1bHQgYmVoYXZpb3VyXG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0XHR0aGlzLl9jYW5jZWxCdG4gPSBuZXcgd3AubWVkaWEudmlldy5CdXR0b24oe1xuXHRcdFx0dGV4dDogbDEwbi5DYW5jZWxVcGxvYWQsXG5cdFx0XHRjbGFzc05hbWU6ICdjYW5jZWwtdXBsb2FkJyxcblx0XHRcdGNsaWNrOmZ1bmN0aW9uKCkge1xuXHRcdFx0XHRzZWxmLnRyaWdnZXIoJ2NhbmNlbC11cGxvYWQnKTtcblx0XHRcdFx0c2VsZi5yZXNldCgpLmNsb3NlKCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHR0aGlzLl9wYWdlcyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCk7XG5cdFx0dGhpcy5saXN0ZW5Ubyh0aGlzLl9wYWdlcywnY2hhbmdlOnNlbGVjdGVkJyxmdW5jdGlvbihlKXtcblx0XHRcdC8vIGRpc2FibGUgaW1nIHVwbG9hZCBidG4gaWYgbm8gcGFnZXMgc2VsZWN0ZWRcblx0XHRcdHRoaXMuX3VwbG9hZEJ0bi4kZWwucHJvcCgnZGlzYWJsZWQnLCAhIHRoaXMuX3BhZ2VzLndoZXJlKCB7IHNlbGVjdGVkOiB0cnVlIH0gKS5sZW5ndGggKVxuXHRcdH0pXG5cblx0XHR0aGlzLmNyZWF0ZVRpdGxlKCk7XG5cdFx0dGhpcy5jcmVhdGVCdXR0b25zKCk7XG5cblx0XHR0aGlzLm9uKCAnZXNjYXBlJywgKCkgPT4ge1xuXHRcdFx0c2VsZi5yZXNldCgpO1xuXHRcdFx0c2VsZi50cmlnZ2VyKCdjYW5jZWwtdXBsb2FkJyk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gdGhpcztcblxuXHR9LFxuXHRyZXNldDogZnVuY3Rpb24oKSB7XG5cdFx0dGhpcy5hY3Rpb25CdG4uZm9yRWFjaCggYnRuID0+IGJ0bi4kZWwucHJvcCggJ2Rpc2FibGVkJywgZmFsc2UgKSApXG5cdFx0dGhpcy50aXRsZS5zZXQoW10pO1xuXHRcdHRoaXMuY29udGVudC5zZXQoW10pO1xuXHRcdHRoaXMucGFnZW5hdi5zZXQoW10pO1xuXHRcdHRoaXMuX3BhZ2VzLnJlc2V0KFtdKTtcblx0XHR0aGlzLl9wZGYgPSB0aGlzLl9jYW52YXMgPSBudWxsO1xuXHRcdHRoaXMuX2N1cnJlbnRfcGFnZSA9IDA7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH0sXG5cdGNyZWF0ZVRpdGxlOiBmdW5jdGlvbiggKSB7XG5cdFx0bGV0IHRpdGxlO1xuXHRcdHRoaXMuX3RpdGxlID0gbmV3IHdwLm1lZGlhLlZpZXcoe1xuXHRcdFx0dGFnTmFtZTogJ2gxJ1xuXHRcdH0pO1xuXHRcdGlmICggdGhpcy5maWxlICkge1xuXHRcdFx0dGl0bGUgPSBsMTBuLlVwbG9hZCArICc6ICcgKyB0aGlzLmZpbGUuZmlsZS5uYW1lLnJlcGxhY2UoL1xcLlthLXowLTldKyQvLCcnKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGl0bGUgPVx0bDEwbi5wZGZVcGxvYWQ7XG5cdFx0fVxuXHRcdHRoaXMuX3RpdGxlLiRlbC50ZXh0KCB0aXRsZSApO1xuXHRcdHRoaXMudGl0bGUuc2V0KCBbIHRoaXMuX3RpdGxlIF0gKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fSxcblx0Y3JlYXRlQnV0dG9uczogZnVuY3Rpb24oKSB7XG5cdFx0dGhpcy5hY3Rpb25CdG4gPSBbXTtcblxuXHRcdHRoaXMuYWN0aW9uQnRuLnB1c2goIHRoaXMuX2NhbmNlbEJ0biApO1xuXHRcdGlmICggISEgdGhpcy5fc2tpcEJ0biApIHtcblx0XHRcdHRoaXMuYWN0aW9uQnRuLnB1c2goIHRoaXMuX3NraXBCdG4gKTtcblx0XHR9XG5cdFx0dGhpcy5hY3Rpb25CdG4ucHVzaCggdGhpcy5fdXBsb2FkQnRuICk7XG5cblx0XHR0aGlzLmJ1dHRvbnMuc2V0KCB0aGlzLmFjdGlvbkJ0biApO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9LFxuXHRzZXRGaWxlOmZ1bmN0aW9uKCBmaWxlICkge1xuXHRcdGNvbnN0IHNlbGYgPSB0aGlzLFxuXHRcdFx0ZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cdFx0dGhpcy5maWxlID0gZmlsZTtcblx0XHRmaWxlUmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4vL1x0XHRcdCAgICBhcnJheUJ1ZmZlciA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7XG5cdFx0XHRzZWxmLnBhcnNlUERGKCBldmVudC50YXJnZXQucmVzdWx0ICk7XG5cdFx0fTtcblx0XHRmaWxlUmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKCBmaWxlLmJsb2IgKTtcblx0XHRyZXR1cm4gdGhpcy5jcmVhdGVUaXRsZSgpO1xuXHR9LFxuXHRjbGlja1BhZ2U6ZnVuY3Rpb24oZSkge1xuXHRcdHRoaXMuc2hvd1BhZ2UoJChlLnRhcmdldCkuYXR0cignZGF0YS1wYWdlJykpO1xuXHR9LFxuXHRyZW5kZXJQYWdlTmF2OmZ1bmN0aW9uKG51bVBhZ2VzKSB7XG5cdFx0Y29uc3Qgc2VsZiA9IHRoaXMsIGJ0bnMgPSBbXTtcblx0XHRsZXQgbSwgaSA9IDE7XG5cblx0XHR3aGlsZSAoIHRoaXMuX3BhZ2VzLmxlbmd0aCApIHtcblx0XHRcdHRoaXMuX3BhZ2VzLnBvcCgpO1xuXHRcdH1cblxuXHRcdGZvciAoaTtpPD1udW1QYWdlcztpKyspIHtcblx0XHRcdG0gPSBuZXcgQmFja2JvbmUuTW9kZWwoe1xuXHRcdFx0XHRpZDppLFxuXHRcdFx0XHRzZWxlY3RlZDp0cnVlLFxuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLl9wYWdlcy5hZGQoIG0gKTtcblxuXHRcdFx0YnRucy5wdXNoKFxuXHRcdFx0XHRuZXcgUGFnZUl0ZW0oe1xuXHRcdFx0XHRcdHBhZ2VudW06aSxcblx0XHRcdFx0XHRzZWxlY3RlZDp0cnVlLFxuXHRcdFx0XHRcdG1vZGVsOm0sXG5cdFx0XHRcdFx0ZXZlbnRzOntcblx0XHRcdFx0XHRcdCdjaGFuZ2UgW3R5cGU9XCJyYWRpb1wiXScgOiBmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0XHRpZiAoIHRoaXMuJCgnW3R5cGU9XCJyYWRpb1wiXScpLnByb3AoJ2NoZWNrZWQnKSApIHtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLnNob3dQYWdlKCB0aGlzLm9wdGlvbnMucGFnZW51bSApO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0J2NoYW5nZSBbdHlwZT1cImNoZWNrYm94XCJdJyA6IGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRcdHRoaXMubW9kZWwuc2V0KCAnc2VsZWN0ZWQnLCB0aGlzLiQoJ1t0eXBlPVwiY2hlY2tib3hcIl0nKS5wcm9wKCdjaGVja2VkJykgKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pXG5cdFx0XHQpO1xuXG5cdFx0fVxuXHRcdHRoaXMucGFnZW5hdi5zZXQoIGJ0bnMgKTtcblx0fSxcblx0cGFyc2VQREY6IGZ1bmN0aW9uKCBhcnIgKSB7XG5cdFx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cdFx0KGFzeW5jIGFyciA9PiB7XG5cdFx0XHRjb25zdCBwZGYgPSBhd2FpdCBwZGZqc0xpYi5nZXREb2N1bWVudChhcnIpO1xuXHRcdFx0Ly8gYnVpbGQgcGFnZXMgc2VsZWN0b3Jcblx0XHRcdHNlbGYuX3BkZiA9IHBkZjtcblx0XHRcdHNlbGYucmVuZGVyUGFnZU5hdihwZGYubnVtUGFnZXMpXG5cblx0XHRcdHNlbGYuc2hvd1BhZ2UoMSk7XG5cblx0XHR9KShhcnIpXG5cdH0sXG5cdHNob3dQYWdlOmZ1bmN0aW9uKGlkeCkge1xuXHRcdGNvbnN0IHNlbGYgPSB0aGlzLFxuXHRcdFx0bSA9IHRoaXMuX3BhZ2VzLmdldChpZHgpO1xuXG5cdFx0aWYgKCAhISBtLmdldCgnY2FudmFzJykgKSB7XG5cdFx0XHR0aGlzLmNvbnRlbnQuc2V0KCBbXG5cdFx0XHRcdG5ldyB3cC5tZWRpYS5WaWV3KHtcblx0XHRcdFx0XHRlbDogbS5nZXQoJ2NhbnZhcycpLFxuXHRcdFx0XHR9KVxuXHRcdFx0XSApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmNvbnRlbnQuc2V0KFtuZXcgQmFja2JvbmUuVmlldygpXSlcblx0XHRcdHRoaXMucmVuZGVyUGFnZSggaWR4LCBmdW5jdGlvbigpe1xuXHRcdFx0XHRzZWxmLnNob3dQYWdlKGlkeCk7XG5cdFx0XHR9ICk7XG5cdFx0fVxuXG5cdH0sXG5cdHJlbmRlclBhZ2U6ZnVuY3Rpb24oaWR4LGNiLGNiX2FyZ3MpIHtcblx0XHRjb25zdCBzZWxmID0gdGhpcyxcblx0XHRcdG0gPSB0aGlzLl9wYWdlcy5nZXQoaWR4KTtcblx0XHQoYXN5bmMgKCkgPT4ge1xuXHRcdFx0Y29uc3QgcGFnZSA9IGF3YWl0IHNlbGYuX3BkZi5nZXRQYWdlKGlkeCksXG5cdFx0XHRcdGNhbnZhcyA9ICQoJzxjYW52YXM+PC9jYW52YXM+JykuZ2V0KDApLFxuXHRcdFx0XHRjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuXHRcdFx0bGV0IHZwID0gcGFnZS5nZXRWaWV3cG9ydCh7c2NhbGU6MX0pO1xuXG5cdFx0XHR2cCA9IHBhZ2UuZ2V0Vmlld3BvcnQoIHsgc2NhbGU6IG9wdGlvbnMuaW1hZ2Vfd2lkdGggLyB2cC53aWR0aCB9ICk7XG5cblx0XHRcdGNhbnZhcy53aWR0aCA9IHZwLndpZHRoO1xuXHRcdFx0Y2FudmFzLmhlaWdodCA9IHZwLmhlaWdodDtcblxuXHRcdFx0YXdhaXQgcGFnZS5yZW5kZXIoe1xuXHRcdFx0XHRjYW52YXNDb250ZXh0OiBjdHgsXG5cdFx0XHRcdHZpZXdwb3J0OiB2cCxcblx0XHRcdH0pO1xuXG5cdFx0XHRtLnNldCggJ3BhZ2UnLCBwYWdlICk7XG5cdFx0XHRtLnNldCggJ2NhbnZhcycsIGNhbnZhcyApO1xuXG5cdFx0XHQhIWNiICYmIGNiLmFwcGx5KG0sY2JfYXJnc3x8W10pO1xuXG5cdFx0fSkoKTtcblx0fSxcblxuXHR1cGxvYWRJbWFnZXM6ZnVuY3Rpb24oKSB7XG5cdFx0Y29uc3Qgc2VsZiA9IHRoaXMsXG5cdFx0XHR0eXBlID0gb3B0aW9ucy5pbWFnZV90eXBlLFxuXHRcdFx0dXBsb2FkID0gZnVuY3Rpb24oIG5hbWUgKSB7XG5cdFx0XHRcdGNvbnN0IGltZyA9IG5ldyBvLkltYWdlKCksXG5cdFx0XHRcdFx0bSA9IHRoaXM7XG5cdFx0XHRcdGltZy5vbmxvYWQgPSAoKSA9PiB7XG5cdFx0XHRcdFx0aW1nLm5hbWUgPSBuYW1lO1xuXHRcdFx0XHRcdGltZy50eXBlID0gdHlwZTtcblx0XHRcdFx0XHRzZWxmLm9wdGlvbnMudXBsb2FkZXIuYWRkRmlsZSggaW1nLmdldEFzQmxvYigpLCBuYW1lICk7XG5cblx0XHRcdFx0XHRtLnNldCggJ3NlbGVjdGVkJywgZmFsc2UgKTtcblxuXHRcdFx0XHRcdGlmICggISBzZWxmLl9wYWdlcy53aGVyZSggeyBzZWxlY3RlZDogdHJ1ZSB9ICkubGVuZ3RoICkge1xuXHRcdFx0XHRcdFx0Ly8gdHJpZ2dlciBzb21ldGhpbmdcblx0XHRcdFx0XHRcdHNlbGYudHJpZ2dlcignY29tcGxldGUnKTtcblx0XHRcdFx0XHRcdHNlbGYucmVzZXQoKS5jbG9zZSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGltZy5sb2FkKCB0aGlzLmdldCgnY2FudmFzJykudG9EYXRhVVJMKCBvcHRpb25zLmltYWdlX3R5cGUsIG9wdGlvbnMuanBlZ19xdWFsaXR5ICogMC4wMSApICk7XG5cdFx0XHRcdC8vXG5cdFx0XHRcdCQoJ2JvZHknKS5hcHBlbmQoaW1nKTtcblx0XHRcdH07XG5cblx0XHR0aGlzLmFjdGlvbkJ0bi5mb3JFYWNoKCBidG4gPT4gYnRuLiRlbC5wcm9wKCdkaXNhYmxlZCcsdHJ1ZSkgKVxuXG5cdFx0Xy5lYWNoKCAgKTtcblx0XHQvLyBjcmVhdGUgZSBuZXcgbWVkaWEgbW9kZWwgZnJvbSBibG9iIGRhdGEgVVJMIHRoaW5neVxuXG5cdFx0Xy5lYWNoKCB0aGlzLl9wYWdlcy53aGVyZSggeyBzZWxlY3RlZDogdHJ1ZSB9ICksICggcGcsIGkgKSA9PiB7XG5cblx0XHRcdGNvbnN0IG5hbWUgPSBzZWxmLmZpbGUuZmlsZS5uYW1lLnJlcGxhY2UoL1xcLlthLXowLTldKyQvLCcnKSArICctcCcgKyBpICsgJy5wbmcnO1xuXG5cdFx0XHRpZiAoICEgcGcuZ2V0KCdjYW52YXMnKSApIHtcblx0XHRcdFx0Ly8gbmVlZHMgcmVuZGVyaW5nXG5cdFx0XHRcdHNlbGYucmVuZGVyUGFnZSggcGcuZ2V0KCdpZCcpLCB1cGxvYWQsW25hbWVdKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHVwbG9hZC5hcHBseShwZyxbbmFtZV0pXG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cbn0pO1xuIl19
