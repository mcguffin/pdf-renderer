!function i(a,o,s){function r(t,e){if(!o[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);throw(n=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",n}n=o[t]={exports:{}},a[t][0].call(n.exports,function(e){return r(a[t][1][e]||e)},n,n.exports,i,a,o,s)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)r(s[e]);return r}({1:[function(n,e,t){!function(t){!function(){"use strict";var a=e("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),o=e(n("pdf-frame.js"));function e(e){return e&&e.__esModule?e:{default:e}}n("misc.js").pdfAllowed||(_wpPluploadSettings.defaults.filters.mime_types[0].extensions+=",pdf"),_.extend(wp.media.view.UploaderWindow.prototype,{_parentReady:wp.media.view.UploaderWindow.prototype.ready,didReady:!1,ready:function(){var i,e;return this.didReady?this._parentReady.apply(this,arguments):(this.didReady=!0,e=this._parentReady.apply(this,arguments),this.uploader.uploader.bind("BeforeUpload",function(e,t){var n;"application/pdf"==t.type&&((t={file:n=t,blob:n.getNative()}).blob||(t.blob=n.getSource()),(t=t).blob instanceof Blob&&(e.stop(),e.refresh(),function(e,t){i?i.reset().close().dispose():(i=new o.default({controller:(0,a.default)(this),uploader:e})).on("cancel-upload",function(){e.removeFile(i.file.file),i.file.file.attachment.destroy()}).on("continue-upload",function(){e.start()}),i.setFile(t),i.open()}(e,t)))}),e)}})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"misc.js":2,"pdf-frame.js":4}],2:[function(e,t,n){"use strict";t.exports={pdfAllowed:-1!==_wpPluploadSettings.defaults.filters.mime_types[0].extensions.split(",").indexOf("pdf"),l10n:pdf_renderer.l10n,options:pdf_renderer.options}},{}],3:[function(e,t,n){"use strict";t.exports=wp.media.View.extend({template:wp.template("pdf-page-item"),className:"pdf-page-item",events:{}})},{}],4:[function(n,i,e){!function(t){!function(){"use strict";var c=e("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),o=e("undefined"!=typeof window?window.mOxie:void 0!==t?t.mOxie:null),s=e(n("page-item.js")),u=n("misc.js");function e(e){return e&&e.__esModule?e:{default:e}}function f(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}pdfjsLib.GlobalWorkerOptions.workerSrc=u.options.worker_url,i.exports=wp.media.view.MediaFrame.extend({template:wp.template("pdf-modal"),regions:["title","content","instructions","buttons","pagenav"],events:{"click [data-page]":"clickPage","click .media-modal-close":function(){this.trigger("cancel-upload"),this.reset().close()}},_state:"pdf-frame",initialize:function(){var e=this;return _.defaults(this.options,{uploader:!1}),wp.media.view.MediaFrame.prototype.initialize.apply(this,arguments),this._pdf=this._canvas=null,this._current_page=0,this._uploadBtn=new wp.media.view.Button({text:u.l10n.UploadImages,className:"button-primary",click:function(){e.trigger("cancel-upload"),e.uploadImages()}}),u.pdfAllowed&&(this._skipBtn=new wp.media.view.Button({text:u.l10n.UploadPDF,className:"upload-pdf",click:function(){e.trigger("continue-upload"),e.reset().close()}})),this._cancelBtn=new wp.media.view.Button({text:u.l10n.CancelUpload,className:"cancel-upload",click:function(){e.trigger("cancel-upload"),e.reset().close()}}),this._pages=new Backbone.Collection,this.listenTo(this._pages,"change:selected",function(e){this._uploadBtn.$el.prop("disabled",!this._pages.where({selected:!0}).length)}),this.createTitle(),this.createButtons(),this.on("escape",function(){e.reset(),e.trigger("cancel-upload")}),this},reset:function(){return this.actionBtn.forEach(function(e){return e.$el.prop("disabled",!1)}),this.title.set([]),this.content.set([]),this.pagenav.set([]),this._pages.reset([]),this._pdf=this._canvas=null,this._current_page=0,this},createTitle:function(){var e;return this._title=new wp.media.View({tagName:"h1"}),e=this.file?u.l10n.Upload+": "+this.file.file.name.replace(/\.[a-z0-9]+$/,""):u.l10n.pdfUpload,this._title.$el.text(e),this.title.set([this._title]),this},createButtons:function(){return this.actionBtn=[],this.actionBtn.push(this._cancelBtn),this._skipBtn&&this.actionBtn.push(this._skipBtn),this.actionBtn.push(this._uploadBtn),this.buttons.set(this.actionBtn),this},setFile:function(e){var t=this,n=new FileReader;return this.file=e,n.onload=function(e){t.parsePDF(e.target.result)},n.readAsArrayBuffer(e.blob),this.createTitle()},clickPage:function(e){this.showPage((0,c.default)(e.target).attr("data-page"))},renderPageNav:function(e){for(var t,n=this,i=[],a=1;this._pages.length;)this._pages.pop();for(;a<=e;a++)t=new Backbone.Model({id:a,selected:!0}),this._pages.add(t),i.push(new s.default({pagenum:a,selected:!0,model:t,events:{'change [type="radio"]':function(){this.$('[type="radio"]').prop("checked")&&n.showPage(this.options.pagenum)},'change [type="checkbox"]':function(){this.model.set("selected",this.$('[type="checkbox"]').prop("checked"))}}}));this.pagenav.set(i)},parsePDF:function(e){var t=this;pdfjsLib.getDocument(e).promise.then(function(e){t._pdf=e,t.renderPageNav(e.numPages),t.showPage(1)},console.error)},showPage:function(e){var t=this,n=this._pages.get(e);n.get("canvas")?this.content.set([new wp.media.View({el:n.get("canvas")})]):(this.content.set([new Backbone.View]),this.renderPage(e,function(){t.showPage(e)}))},renderPage:function(o,s,r){var l,p=this,d=this._pages.get(o);l=regeneratorRuntime.mark(function e(){var t,n,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p._pdf.getPage(o);case 2:return t=e.sent,n=(0,c.default)("<canvas></canvas>").get(0),i=n.getContext("2d"),a=t.getViewport({scale:1}),a=t.getViewport({scale:u.options.image_width/a.width}),n.width=a.width,n.height=a.height,e.next=11,t.render({canvasContext:i,viewport:a});case 11:d.set("page",t),d.set("canvas",n),s&&s.apply(d,r||[]);case 14:case"end":return e.stop()}},e)}),function(){var e=this,s=arguments;new Promise(function(t,n){var i=l.apply(e,s);function a(e){f(i,t,n,a,o,"next",e)}function o(e){f(i,t,n,a,o,"throw",e)}a(void 0)})}()},uploadImages:function(){function n(e){var t=new o.default.Image,n=this;t.onload=function(){t.name=e,t.type=a,i.options.uploader.addFile(t.getAsBlob(),e),n.set("selected",!1),i._pages.where({selected:!0}).length||(i.trigger("complete"),i.reset().close())},t.load(this.get("canvas").toDataURL(u.options.image_type,.01*u.options.jpeg_quality)),(0,c.default)("body").append(t)}var i=this,a=u.options.image_type;this.actionBtn.forEach(function(e){return e.$el.prop("disabled",!0)}),_.each(),_.each(this._pages.where({selected:!0}),function(e,t){t=i.file.file.name.replace(/\.[a-z0-9]+$/,"")+"-p"+t+".png";e.get("canvas")?n.apply(e,[t]):i.renderPage(e.get("id"),n,[t])})}})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"misc.js":2,"page-item.js":3}]},{},[1]);