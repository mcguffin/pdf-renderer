!function i(a,o,s){function r(t,e){if(!o[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);throw(n=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",n}n=o[t]={exports:{}},a[t][0].call(n.exports,function(e){return r(a[t][1][e]||e)},n,n.exports,i,a,o,s)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)r(s[e]);return r}({1:[function(n,e,t){!function(t){!function(){"use strict";var a=e("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),o=e(n("pdf-frame.js"));function e(e){return e&&e.__esModule?e:{default:e}}n("misc.js").pdfAllowed||(_wpPluploadSettings.defaults.filters.mime_types[0].extensions+=",pdf"),_.extend(wp.media.view.UploaderWindow.prototype,{_parentReady:wp.media.view.UploaderWindow.prototype.ready,didReady:!1,ready:function(){var i,e;return this.didReady?this._parentReady.apply(this,arguments):(this.didReady=!0,e=this._parentReady.apply(this,arguments),this.uploader.uploader.bind("BeforeUpload",function(e,t){var n;"application/pdf"==t.type&&((t={file:n=t,blob:n.getNative()}).blob||(t.blob=n.getSource()),(t=t).blob instanceof Blob&&(e.stop(),e.refresh(),function(e,t){i?i.reset().close().dispose():(i=new o.default({controller:(0,a.default)(this),uploader:e})).on("cancel-upload",function(){e.removeFile(i.file.file),i.file.file.attachment.destroy()}).on("continue-upload",function(){e.start()}),i.setFile(t),i.open()}(e,t)))}),e)}})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"misc.js":2,"pdf-frame.js":4}],2:[function(e,t,n){"use strict";t.exports={pdfAllowed:-1!==_wpPluploadSettings.defaults.filters.mime_types[0].extensions.split(",").indexOf("pdf"),l10n:pdf_renderer.l10n,options:pdf_renderer.options}},{}],3:[function(e,t,n){"use strict";t.exports=wp.media.View.extend({template:wp.template("pdf-page-item"),className:"pdf-page-item",events:{}})},{}],4:[function(n,i,e){!function(t){!function(){"use strict";var d=e("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),o=e("undefined"!=typeof window?window.mOxie:void 0!==t?t.mOxie:null),s=e(n("page-item.js")),u=n("misc.js");function e(e){return e&&e.__esModule?e:{default:e}}function f(e,t,n,i,a,o,s){try{var r=e[o](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,a)}pdfjsLib.GlobalWorkerOptions.workerSrc=u.options.worker_url,i.exports=wp.media.view.MediaFrame.extend({template:wp.template("pdf-modal"),regions:["title","content","instructions","buttons","pagenav"],events:{"click [data-page]":"clickPage","click .media-modal-close":function(){this.trigger("cancel-upload"),this.reset().close()},'click [data-action="select-all"]':"selectAll",'click [data-action="unselect-all"]':"unselectAll"},_state:"pdf-frame",initialize:function(){var e=this;return _.defaults(this.options,{uploader:!1}),wp.media.view.MediaFrame.prototype.initialize.apply(this,arguments),this._pdf=this._canvas=null,this._current_page=0,this._uploadBtn=new wp.media.view.Button({text:u.l10n.UploadImages,className:"button-primary",click:function(){e.trigger("cancel-upload"),e.uploadImages()}}),u.pdfAllowed&&(this._skipBtn=new wp.media.view.Button({text:u.l10n.UploadPDF,className:"upload-pdf",click:function(){e.trigger("continue-upload"),e.reset().close()}})),this._cancelBtn=new wp.media.view.Button({text:u.l10n.CancelUpload,className:"cancel-upload",click:function(){e.trigger("cancel-upload"),e.reset().close()}}),this._pages=new Backbone.Collection,this.listenTo(this._pages,"change:selected",function(e){this._uploadBtn.$el.prop("disabled",!this._pages.where({selected:!0}).length)}),this.createTitle(),this.createButtons(),this.on("escape",function(){e.reset(),e.trigger("cancel-upload")}),this},render:function(){var e=wp.media.view.MediaFrame.prototype.render.apply(this,arguments);return this.$('[name="pdf-renderer-fileformat"][value="'.concat(u.options.image_type,'"]')).prop("checked",!0),e},getImageType:function(){return this.$('[name="pdf-renderer-fileformat"]:checked').val()},reset:function(){return this.actionBtn.forEach(function(e){return e.$el.prop("disabled",!1)}),this.title.set([]),this.content.set([]),this.pagenav.set([]),this._pages.reset([]),this._pdf=this._canvas=null,this._current_page=0,this},createTitle:function(){var e;return this._title=new wp.media.View({tagName:"h1"}),e=this.file?u.l10n.Upload+": "+this.file.file.name.replace(/\.[a-z0-9]+$/,""):u.l10n.pdfUpload,this._title.$el.text(e),this.title.set([this._title]),this},createButtons:function(){return this.actionBtn=[],this.actionBtn.push(this._cancelBtn),this._skipBtn&&this.actionBtn.push(this._skipBtn),this.actionBtn.push(this._uploadBtn),this.buttons.set(this.actionBtn),this},setFile:function(e){var t=this,n=new FileReader;return this.file=e,n.onload=function(e){t.parsePDF(e.target.result)},n.readAsArrayBuffer(e.blob),this.createTitle()},clickPage:function(e){this.showPage((0,d.default)(e.target).attr("data-page"))},renderPageNav:function(e){for(var t,n,i=this,a=[],o=1;this._pages.length;)this._pages.pop();for(;o<=e;o++)t=new Backbone.Model({id:o,selected:!0}),this._pages.add(t),n=new s.default({pagenum:o,selected:!0,model:t,events:{'change [type="radio"]':function(){this.$('[type="radio"]').prop("checked")&&i.showPage(this.options.pagenum)},'change [type="checkbox"]':function(){this.model.set("selected",this.$('[type="checkbox"]').prop("checked"))}}}),t.set("pageItem",n),a.push(n);this.pagenav.set(a)},selectAll:function(){this.$('.pdf-page-item > [type="checkbox"]').each(function(e,t){(0,d.default)(t).prop("checked",!0).trigger("change")})},unselectAll:function(){this.$('.pdf-page-item > [type="checkbox"]').each(function(e,t){(0,d.default)(t).prop("checked",!1).trigger("change")})},parsePDF:function(e){var t=this;pdfjsLib.getDocument(e).promise.then(function(e){t._pdf=e,t.renderPageNav(e.numPages),t.showPage(1)},console.error)},showPage:function(e){var t=this,n=this._pages.get(e);n.get("canvas")?this.content.set([new wp.media.View({el:n.get("canvas")})]):(this.content.set([new Backbone.View]),this.renderPage(e,function(){t.showPage(e)}))},renderPage:function(o,s,r){var l,c=this,p=this._pages.get(o);l=regeneratorRuntime.mark(function e(){var t,n,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c._pdf.getPage(o);case 2:t=e.sent,n=(0,d.default)("<canvas></canvas>").get(0),i=n.getContext("2d"),a=t.getViewport({scale:1}),a=t.getViewport({scale:u.options.image_width/a.width}),n.width=a.width,n.height=a.height,t.render({canvasContext:i,viewport:a}).promise.then(function(){p.set("page",t),p.set("canvas",n),s&&s.apply(p,r||[])});case 10:case"end":return e.stop()}},e)}),function(){var e=this,s=arguments;new Promise(function(t,n){var i=l.apply(e,s);function a(e){f(i,t,n,a,o,"next",e)}function o(e){f(i,t,n,a,o,"throw",e)}a(void 0)})}()},uploadImages:function(){function n(e){var t=new o.default.Image,n=this;t.onload=function(){t.name=e,"image/jpeg"===(t.type=a)?i.options.uploader.addFile(t.getAsBlob(a,.01*u.options.jpeg_quality),e):i.options.uploader.addFile(t.getAsBlob(a),e),n.set("selected",!1),i._pages.where({selected:!0}).length||(i.trigger("complete"),i.reset().close())},t.load(this.get("canvas").toDataURL(a)),(0,d.default)("body").append(t)}var i=this,a=i.getImageType();this.actionBtn.forEach(function(e){return e.$el.prop("disabled",!0)}),_.each(this._pages.where({selected:!0}),function(e,t){t=i.file.file.name.replace(/\.[a-z0-9]+$/,"")+"-p"+t+"."+("image/png"===a?"png":"jpg");e.get("canvas")?n.apply(e,[t]):i.renderPage(e.get("id"),n,[t])}),this.reset().close()}})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"misc.js":2,"page-item.js":3}]},{},[1]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluL25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhZG1pbi9zcmMvanMvYWRtaW4vbWVkaWEvaW5kZXguanMiLCJhZG1pbi9zcmMvanMvbGliL21pc2MuanMiLCJhZG1pbi9zcmMvanMvbGliL3BhZ2UtaXRlbS5qcyIsImFkbWluL3NyYy9qcy9saWIvcGRmLWZyYW1lLmpzIl0sIm5hbWVzIjpbInIiLCJlIiwibiIsInQiLCJvIiwiaSIsImYiLCJjIiwicmVxdWlyZSIsInUiLCJhIiwiRXJyb3IiLCJjb2RlIiwicCIsImV4cG9ydHMiLCJjYWxsIiwibGVuZ3RoIiwiMSIsIm1vZHVsZSIsIl9qcXVlcnkiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Iiwid2luZG93IiwiZ2xvYmFsIiwiX3BkZkZyYW1lIiwicGRmQWxsb3dlZCIsIl93cFBsdXBsb2FkU2V0dGluZ3MiLCJkZWZhdWx0cyIsImZpbHRlcnMiLCJtaW1lX3R5cGVzIiwiZXh0ZW5zaW9ucyIsIl8iLCJleHRlbmQiLCJ3cCIsIm1lZGlhIiwidmlldyIsIlVwbG9hZGVyV2luZG93IiwicHJvdG90eXBlIiwiX3BhcmVudFJlYWR5IiwicmVhZHkiLCJkaWRSZWFkeSIsInBkZk1vZGFsIiwicmV0IiwidGhpcyIsImFwcGx5IiwiYXJndW1lbnRzIiwidXBsb2FkZXIiLCJiaW5kIiwidXAiLCJmaWxlIiwidHlwZSIsIl9yZXQiLCJibG9iIiwiZ2V0TmF0aXZlIiwiZ2V0U291cmNlIiwiZmlsZURhdGEiLCJCbG9iIiwic3RvcCIsInJlZnJlc2giLCJmaWxlSXRlbSIsInJlc2V0IiwiY2xvc2UiLCJkaXNwb3NlIiwiZGVmYXVsdCIsImNvbnRyb2xsZXIiLCJvbiIsInJlbW92ZUZpbGUiLCJhdHRhY2htZW50IiwiZGVzdHJveSIsInN0YXJ0Iiwic2V0RmlsZSIsIm9wZW4iLCJwZGZQb3B1cCIsInNwbGl0IiwiaW5kZXhPZiIsImwxMG4iLCJwZGZfcmVuZGVyZXIiLCJvcHRpb25zIiwiVmlldyIsInRlbXBsYXRlIiwiY2xhc3NOYW1lIiwiZXZlbnRzIiwiX21veGllIiwiX3BhZ2VJdGVtIiwiX21pc2MiLCJwZGZqc0xpYiIsIkdsb2JhbFdvcmtlck9wdGlvbnMiLCJ3b3JrZXJTcmMiLCJ3b3JrZXJfdXJsIiwiTWVkaWFGcmFtZSIsInJlZ2lvbnMiLCJjbGljayBbZGF0YS1wYWdlXSIsImNsaWNrIC5tZWRpYS1tb2RhbC1jbG9zZSIsInRyaWdnZXIiLCJjbGljayBbZGF0YS1hY3Rpb249XCJzZWxlY3QtYWxsXCJdIiwiY2xpY2sgW2RhdGEtYWN0aW9uPVwidW5zZWxlY3QtYWxsXCJdIiwiX3N0YXRlIiwiaW5pdGlhbGl6ZSIsInNlbGYiLCJfcGRmIiwiX2NhbnZhcyIsIl9jdXJyZW50X3BhZ2UiLCJfdXBsb2FkQnRuIiwiQnV0dG9uIiwidGV4dCIsIlVwbG9hZEltYWdlcyIsImNsaWNrIiwidXBsb2FkSW1hZ2VzIiwiX3NraXBCdG4iLCJVcGxvYWRQREYiLCJfY2FuY2VsQnRuIiwiQ2FuY2VsVXBsb2FkIiwiX3BhZ2VzIiwiQmFja2JvbmUiLCJDb2xsZWN0aW9uIiwibGlzdGVuVG8iLCIkZWwiLCJwcm9wIiwid2hlcmUiLCJzZWxlY3RlZCIsImNyZWF0ZVRpdGxlIiwiY3JlYXRlQnV0dG9ucyIsInJlbmRlciIsIiQiLCJjb25jYXQiLCJpbWFnZV90eXBlIiwiZ2V0SW1hZ2VUeXBlIiwidmFsIiwiYWN0aW9uQnRuIiwiZm9yRWFjaCIsImJ0biIsInRpdGxlIiwic2V0IiwiY29udGVudCIsInBhZ2VuYXYiLCJfdGl0bGUiLCJ0YWdOYW1lIiwiVXBsb2FkIiwibmFtZSIsInJlcGxhY2UiLCJwZGZVcGxvYWQiLCJwdXNoIiwiYnV0dG9ucyIsImZpbGVSZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkIiwiZXZlbnQiLCJwYXJzZVBERiIsInRhcmdldCIsInJlc3VsdCIsInJlYWRBc0FycmF5QnVmZmVyIiwiY2xpY2tQYWdlIiwic2hvd1BhZ2UiLCJhdHRyIiwicmVuZGVyUGFnZU5hdiIsIm51bVBhZ2VzIiwibSIsInBnSXRlbSIsImJ0bnMiLCJwb3AiLCJNb2RlbCIsImlkIiwiYWRkIiwicGFnZW51bSIsIm1vZGVsIiwiY2hhbmdlIFt0eXBlPVwicmFkaW9cIl0iLCJjaGFuZ2UgW3R5cGU9XCJjaGVja2JveFwiXSIsInNlbGVjdEFsbCIsImVhY2giLCJlbCIsInVuc2VsZWN0QWxsIiwiYXJyIiwiZ2V0RG9jdW1lbnQiLCJwcm9taXNlIiwidGhlbiIsInBkZiIsImNvbnNvbGUiLCJlcnJvciIsImlkeCIsImdldCIsInJlbmRlclBhZ2UiLCJjYiIsImNiX2FyZ3MiLCJyZWdlbmVyYXRvclJ1bnRpbWUiLCJtYXJrIiwiX2NhbGxlZSIsInBhZ2UiLCJjYW52YXMiLCJjdHgiLCJ2cCIsIndyYXAiLCJfY29udGV4dCIsInByZXYiLCJuZXh0IiwiZ2V0UGFnZSIsInNlbnQiLCJnZXRDb250ZXh0IiwiZ2V0Vmlld3BvcnQiLCJzY2FsZSIsImltYWdlX3dpZHRoIiwid2lkdGgiLCJoZWlnaHQiLCJjYW52YXNDb250ZXh0Iiwidmlld3BvcnQiLCJfYXN5bmNUb0dlbmVyYXRvciIsInVwbG9hZCIsImltZyIsIkltYWdlIiwiYWRkRmlsZSIsImdldEFzQmxvYiIsImpwZWdfcXVhbGl0eSIsImxvYWQiLCJ0b0RhdGFVUkwiLCJhcHBlbmQiLCJwZyJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsRUFBQUMsRUFBQUMsR0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUFBLElBQUFKLEVBQUFHLEdBQUEsQ0FBQSxJQUFBSixFQUFBSSxHQUFBLENBQUEsSUFBQUUsRUFBQSxtQkFBQUMsU0FBQUEsUUFBQSxJQUFBRixHQUFBQyxFQUFBLE9BQUFBLEVBQUFGLEdBQUEsR0FBQSxHQUFBSSxFQUFBLE9BQUFBLEVBQUFKLEdBQUEsR0FBQSxNQUFBSyxFQUFBLElBQUFDLE1BQUEsdUJBQUFOLEVBQUEsTUFBQU8sS0FBQSxtQkFBQUYsRUFBQUcsRUFBQVgsRUFBQUcsR0FBQSxDQUFBUyxRQUFBLElBQUFiLEVBQUFJLEdB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QVdsSyxLQUV4QyxFQUFBOUIsRUFBQTJDLFNBQUUsUUFBUXNKLE9BQU9QLEdBOUJuQixJQUFNNUcsRUFBT3ZELEtBQ1pPLEVBQU9nRCxFQUFLNEIsZUFnQ2JuRixLQUFLcUYsVUFBVUMsUUFBUyxTQUFBQyxHQUFHLE9BQUlBLEVBQUlkLElBQUlDLEtBQUssWUFBVyxLQUd2RHRGLEVBQUV5SSxLQUFNN0gsS0FBS3FFLE9BQU9NLE1BQU8sQ0FBRUMsVUFBVSxJQUFVLFNBQUUrRixFQUFJaE4sR0FFaERvSSxFQUFPeEMsRUFBS2pELEtBQUtBLEtBQUt5RixLQUFLQyxRQUFRLGVBQWUsSUFBTSxLQUFPckksRUFBSSxLQUFRLGNBQWlCNEMsRUFBTyxNQUFRLE9BRTFHb0ssRUFBR25DLElBQUksVUFJYjBCLEVBQU9qSyxNQUFNMEssRUFBRyxDQUFDNUUsSUFGakJ4QyxFQUFLa0YsV0FBWWtDLEVBQUduQyxJQUFJLE1BQU8wQixFQUFPLENBQUNuRSxNQUt6Qy9GLEtBQUtpQixRQUFRQyIsImZpbGUiOiJhZG1pbi9tZWRpYS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xuaW1wb3J0IFBERkZyYW1lIGZyb20gJ3BkZi1mcmFtZS5qcyc7XG5pbXBvcnQgeyBwZGZBbGxvd2VkLCBsMTBuIH0gZnJvbSAnbWlzYy5qcyc7XG5cblxuXG4vLyB0ZW1wb3JhaWx5IGFkZCBwZGYgdHlwZSB0byBwbHVwbG9hZCBzZXR0aW5ncyxcbi8vIHNvIHRoZSB1cGxvYWRlciBkb2Vzbid0IGNhbmNlbCB0b28gZWFybHkuXG4vLyBGaWxlIHR5cGVzIGFyZSBjaGVja2VkIHNlcnZlci1zaWRlIHRvbywgc29cbi8vIHRoZXJlIHNob3VsZCBiZSBubyBzZWN1cml0eSBpbXBsaWNhdGlvbnMuXG5pZiAoICEgcGRmQWxsb3dlZCApIHtcblx0X3dwUGx1cGxvYWRTZXR0aW5ncy5kZWZhdWx0cy5maWx0ZXJzLm1pbWVfdHlwZXNbMF0uZXh0ZW5zaW9ucyArPSAnLHBkZic7XG59XG5cblxuLy8gZXh0ZW5kIFdQIFVwbG9hZGVyIHdpbmRvd1xuXy5leHRlbmQoIHdwLm1lZGlhLnZpZXcuVXBsb2FkZXJXaW5kb3cucHJvdG90eXBlLCB7XG5cdF9wYXJlbnRSZWFkeTogd3AubWVkaWEudmlldy5VcGxvYWRlcldpbmRvdy5wcm90b3R5cGUucmVhZHksXG5cdGRpZFJlYWR5OmZhbHNlLFxuXG5cdHJlYWR5OmZ1bmN0aW9uKCkge1xuXHRcdGNvbnN0IHBkZnMgPSBbXSxcblx0XHRcdHNlbGYgPSB0aGlzO1xuXHRcdGxldCBwZGZNb2RhbCwgcmV0O1xuXG5cdFx0Ly8gcHJldmVudCBkb3VibGUgaW5pdFxuXHRcdGlmICggdGhpcy5kaWRSZWFkeSApIHtcblx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnRSZWFkeS5hcHBseSggdGhpcyAsIGFyZ3VtZW50cyApO1xuXHRcdH1cblx0XHR0aGlzLmRpZFJlYWR5ID0gdHJ1ZTtcblxuXHRcdHJldCA9IHRoaXMuX3BhcmVudFJlYWR5LmFwcGx5KCB0aGlzICwgYXJndW1lbnRzICk7XG5cblx0XHRmdW5jdGlvbiBwZGZQb3B1cCggdXBsb2FkZXIsIGZpbGVJdGVtICkge1xuXG5cdFx0XHRpZiAoIHBkZk1vZGFsICkge1xuXHRcdFx0XHRwZGZNb2RhbC5yZXNldCgpLmNsb3NlKCkuZGlzcG9zZSgpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cGRmTW9kYWwgPSBuZXcgUERGRnJhbWUoIHtcblx0XHRcdFx0XHRjb250cm9sbGVyOiAkKHRoaXMpLFxuXHRcdFx0XHRcdHVwbG9hZGVyOnVwbG9hZGVyXG5cdFx0XHRcdH0gKTtcblx0XHRcdFx0cGRmTW9kYWwub24oJ2NhbmNlbC11cGxvYWQnLCAoKSA9PiB7XG5cdFx0XHRcdFx0Ly8gc3RvcCBlY2VyeXRoaW5nIVxuXHRcdFx0XHRcdHVwbG9hZGVyLnJlbW92ZUZpbGUoIHBkZk1vZGFsLmZpbGUuZmlsZSApO1xuXHRcdFx0XHRcdHBkZk1vZGFsLmZpbGUuZmlsZS5hdHRhY2htZW50LmRlc3Ryb3koKTtcblxuXHRcdFx0XHR9KS5vbignY29udGludWUtdXBsb2FkJywoKSA9PiB7XG5cdFx0XHRcdFx0Ly8gZ28gYWhlYWQgd2l0aCBhIG5vcm1hbCBXUCB1cGxvYWQuLlxuXHRcdFx0XHRcdHVwbG9hZGVyLnN0YXJ0KCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRwZGZNb2RhbC5zZXRGaWxlKCBmaWxlSXRlbSApO1xuXHRcdFx0cGRmTW9kYWwub3BlbigpO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqXHRAcmV0dXJuIG5hdGl2ZSBmaWxlIG9iamVjdCBvciBibG9iXG5cdFx0ICovXG5cdFx0ZnVuY3Rpb24gcmVzb2x2ZUZpbGUoIGZpbGUgKSB7XG5cdFx0XHRjb25zdCBfcmV0ID0ge1xuXHRcdFx0XHRmaWxlOiBmaWxlLFxuXHRcdFx0XHRibG9iOmZpbGUuZ2V0TmF0aXZlKClcblx0XHRcdH07XG5cdFx0XHRpZiAoICEgX3JldC5ibG9iICkge1xuXHRcdFx0XHRfcmV0LmJsb2IgPSBmaWxlLmdldFNvdXJjZSgpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIF9yZXQ7XG5cdFx0fVxuXG5cdFx0Ly8gc2VuZCBjcm9wZGF0YVxuXHRcdHRoaXMudXBsb2FkZXIudXBsb2FkZXIuYmluZCgnQmVmb3JlVXBsb2FkJyxmdW5jdGlvbiggdXAsIGZpbGUgKSB7XG5cblx0XHRcdGlmICggZmlsZS50eXBlID09ICdhcHBsaWNhdGlvbi9wZGYnKSB7XG5cblx0XHRcdFx0Y29uc3QgZmlsZURhdGEgPSByZXNvbHZlRmlsZSggZmlsZSApO1xuXHRcdFx0XHRpZiAoIGZpbGVEYXRhLmJsb2IgaW5zdGFuY2VvZiBCbG9iICkge1xuXHRcdFx0XHRcdHVwLnN0b3AoKTtcblx0XHRcdFx0XHR1cC5yZWZyZXNoKCk7XG5cdFx0XHRcdFx0cGRmUG9wdXAoIHVwLCBmaWxlRGF0YSApOyAvLyB3aWxsIGFzayBmb3IgZm9jdXMgb3Igc3RhcnQgdXBsb2FkZXJcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0fSk7XG5cdFx0cmV0dXJuIHJldDtcblx0fVxufSk7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IHtcblx0cGRmQWxsb3dlZDogX3dwUGx1cGxvYWRTZXR0aW5ncy5kZWZhdWx0cy5maWx0ZXJzLm1pbWVfdHlwZXNbMF0uZXh0ZW5zaW9ucy5zcGxpdCgnLCcpLmluZGV4T2YoJ3BkZicpICE9PSAtMSxcblx0bDEwbjogcGRmX3JlbmRlcmVyLmwxMG4sXG5cdG9wdGlvbnM6IHBkZl9yZW5kZXJlci5vcHRpb25zXG59XG4iLCJcbm1vZHVsZS5leHBvcnRzID0gd3AubWVkaWEuVmlldy5leHRlbmQoe1xuXHR0ZW1wbGF0ZTogIHdwLnRlbXBsYXRlKCdwZGYtcGFnZS1pdGVtJyksXG5cdGNsYXNzTmFtZToncGRmLXBhZ2UtaXRlbScsXG5cdGV2ZW50czoge1xuXHR9XG59KTtcbiIsImltcG9ydCAkIGZyb20gJ2pxdWVyeSc7XG5pbXBvcnQgbyBmcm9tICdtb3hpZSc7XG5pbXBvcnQgUGFnZUl0ZW0gZnJvbSAncGFnZS1pdGVtLmpzJztcbmltcG9ydCB7IHBkZkFsbG93ZWQsIGwxMG4sIG9wdGlvbnMgfSBmcm9tICdtaXNjLmpzJztcblxucGRmanNMaWIuR2xvYmFsV29ya2VyT3B0aW9ucy53b3JrZXJTcmMgPSBvcHRpb25zLndvcmtlcl91cmw7XG5cbm1vZHVsZS5leHBvcnRzID0gd3AubWVkaWEudmlldy5NZWRpYUZyYW1lLmV4dGVuZCh7XG5cdHRlbXBsYXRlOiB3cC50ZW1wbGF0ZSgncGRmLW1vZGFsJyksXG5cdHJlZ2lvbnM6IFsgJ3RpdGxlJywnY29udGVudCcsJ2luc3RydWN0aW9ucycsJ2J1dHRvbnMnLCAncGFnZW5hdicgXSxcblx0ZXZlbnRzOiB7XG5cdFx0J2NsaWNrIFtkYXRhLXBhZ2VdJyA6ICdjbGlja1BhZ2UnLFxuXHRcdCdjbGljayAubWVkaWEtbW9kYWwtY2xvc2UnIDogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLnRyaWdnZXIoJ2NhbmNlbC11cGxvYWQnKTtcblx0XHRcdHRoaXMucmVzZXQoKS5jbG9zZSgpO1xuXHRcdH0sXG5cdFx0J2NsaWNrIFtkYXRhLWFjdGlvbj1cInNlbGVjdC1hbGxcIl0nIDogJ3NlbGVjdEFsbCcsXG5cdFx0J2NsaWNrIFtkYXRhLWFjdGlvbj1cInVuc2VsZWN0LWFsbFwiXScgOiAndW5zZWxlY3RBbGwnXG5cdH0sXG5cdF9zdGF0ZTogJ3BkZi1mcmFtZScsXG5cdGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuXG5cdFx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cblx0XHRfLmRlZmF1bHRzKCB0aGlzLm9wdGlvbnMsIHtcblx0XHRcdHVwbG9hZGVyOlx0ZmFsc2UsXG5cdFx0fSk7XG5cblx0XHR3cC5tZWRpYS52aWV3Lk1lZGlhRnJhbWUucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXG5cdFx0dGhpcy5fcGRmID0gdGhpcy5fY2FudmFzID0gbnVsbDtcblx0XHR0aGlzLl9jdXJyZW50X3BhZ2UgPSAwO1xuXG5cdFx0dGhpcy5fdXBsb2FkQnRuID0gbmV3IHdwLm1lZGlhLnZpZXcuQnV0dG9uKHtcblx0XHRcdHRleHQ6IGwxMG4uVXBsb2FkSW1hZ2VzLFxuXHRcdFx0Y2xhc3NOYW1lOiAnYnV0dG9uLXByaW1hcnknLFxuXHRcdFx0Y2xpY2s6ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHNlbGYudHJpZ2dlcignY2FuY2VsLXVwbG9hZCcpO1xuXHRcdFx0XHRzZWxmLnVwbG9hZEltYWdlcygpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdGlmICggcGRmQWxsb3dlZCApIHtcblx0XHRcdHRoaXMuX3NraXBCdG4gPSBuZXcgd3AubWVkaWEudmlldy5CdXR0b24oe1xuXHRcdFx0XHR0ZXh0OiBsMTBuLlVwbG9hZFBERixcblx0XHRcdFx0Y2xhc3NOYW1lOiAndXBsb2FkLXBkZicsXG5cdFx0XHRcdGNsaWNrOmZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHNlbGYudHJpZ2dlcignY29udGludWUtdXBsb2FkJyk7XG5cdFx0XHRcdFx0c2VsZi5yZXNldCgpLmNsb3NlKCk7XG5cdFx0XHRcdFx0Ly8gZGlzbWlzcywgY29udGludWUgd2l0aCB3cCBkZWZhdWx0IGJlaGF2aW91clxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0dGhpcy5fY2FuY2VsQnRuID0gbmV3IHdwLm1lZGlhLnZpZXcuQnV0dG9uKHtcblx0XHRcdHRleHQ6IGwxMG4uQ2FuY2VsVXBsb2FkLFxuXHRcdFx0Y2xhc3NOYW1lOiAnY2FuY2VsLXVwbG9hZCcsXG5cdFx0XHRjbGljazpmdW5jdGlvbigpIHtcblx0XHRcdFx0c2VsZi50cmlnZ2VyKCdjYW5jZWwtdXBsb2FkJyk7XG5cdFx0XHRcdHNlbGYucmVzZXQoKS5jbG9zZSgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0dGhpcy5fcGFnZXMgPSBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbigpO1xuXHRcdHRoaXMubGlzdGVuVG8odGhpcy5fcGFnZXMsJ2NoYW5nZTpzZWxlY3RlZCcsZnVuY3Rpb24oZSl7XG5cdFx0XHQvLyBkaXNhYmxlIGltZyB1cGxvYWQgYnRuIGlmIG5vIHBhZ2VzIHNlbGVjdGVkXG5cdFx0XHR0aGlzLl91cGxvYWRCdG4uJGVsLnByb3AoJ2Rpc2FibGVkJywgISB0aGlzLl9wYWdlcy53aGVyZSggeyBzZWxlY3RlZDogdHJ1ZSB9ICkubGVuZ3RoIClcblx0XHR9KVxuXG5cdFx0dGhpcy5jcmVhdGVUaXRsZSgpO1xuXHRcdHRoaXMuY3JlYXRlQnV0dG9ucygpO1xuXG5cdFx0dGhpcy5vbiggJ2VzY2FwZScsICgpID0+IHtcblx0XHRcdHNlbGYucmVzZXQoKTtcblx0XHRcdHNlbGYudHJpZ2dlcignY2FuY2VsLXVwbG9hZCcpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cblx0fSxcblx0cmVuZGVyOmZ1bmN0aW9uKCkge1xuXHRcdGNvbnN0IHJldCA9IHdwLm1lZGlhLnZpZXcuTWVkaWFGcmFtZS5wcm90b3R5cGUucmVuZGVyLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcblx0XHR0aGlzLiQoYFtuYW1lPVwicGRmLXJlbmRlcmVyLWZpbGVmb3JtYXRcIl1bdmFsdWU9XCIke29wdGlvbnMuaW1hZ2VfdHlwZX1cIl1gKS5wcm9wKCdjaGVja2VkJyx0cnVlKVxuXHRcdHJldHVybiByZXQ7XG5cdH0sXG5cdGdldEltYWdlVHlwZTpmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gdGhpcy4kKCdbbmFtZT1cInBkZi1yZW5kZXJlci1maWxlZm9ybWF0XCJdOmNoZWNrZWQnKS52YWwoKTtcblx0fSxcblx0cmVzZXQ6IGZ1bmN0aW9uKCkge1xuXHRcdHRoaXMuYWN0aW9uQnRuLmZvckVhY2goIGJ0biA9PiBidG4uJGVsLnByb3AoICdkaXNhYmxlZCcsIGZhbHNlICkgKVxuXHRcdHRoaXMudGl0bGUuc2V0KFtdKTtcblx0XHR0aGlzLmNvbnRlbnQuc2V0KFtdKTtcblx0XHR0aGlzLnBhZ2VuYXYuc2V0KFtdKTtcblx0XHR0aGlzLl9wYWdlcy5yZXNldChbXSk7XG5cdFx0dGhpcy5fcGRmID0gdGhpcy5fY2FudmFzID0gbnVsbDtcblx0XHR0aGlzLl9jdXJyZW50X3BhZ2UgPSAwO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9LFxuXHRjcmVhdGVUaXRsZTogZnVuY3Rpb24oICkge1xuXHRcdGxldCB0aXRsZTtcblx0XHR0aGlzLl90aXRsZSA9IG5ldyB3cC5tZWRpYS5WaWV3KHtcblx0XHRcdHRhZ05hbWU6ICdoMSdcblx0XHR9KTtcblx0XHRpZiAoIHRoaXMuZmlsZSApIHtcblx0XHRcdHRpdGxlID0gbDEwbi5VcGxvYWQgKyAnOiAnICsgdGhpcy5maWxlLmZpbGUubmFtZS5yZXBsYWNlKC9cXC5bYS16MC05XSskLywnJyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRpdGxlID1cdGwxMG4ucGRmVXBsb2FkO1xuXHRcdH1cblx0XHR0aGlzLl90aXRsZS4kZWwudGV4dCggdGl0bGUgKTtcblx0XHR0aGlzLnRpdGxlLnNldCggWyB0aGlzLl90aXRsZSBdICk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH0sXG5cdGNyZWF0ZUJ1dHRvbnM6IGZ1bmN0aW9uKCkge1xuXHRcdHRoaXMuYWN0aW9uQnRuID0gW107XG5cblx0XHR0aGlzLmFjdGlvbkJ0bi5wdXNoKCB0aGlzLl9jYW5jZWxCdG4gKTtcblx0XHRpZiAoICEhIHRoaXMuX3NraXBCdG4gKSB7XG5cdFx0XHR0aGlzLmFjdGlvbkJ0bi5wdXNoKCB0aGlzLl9za2lwQnRuICk7XG5cdFx0fVxuXHRcdHRoaXMuYWN0aW9uQnRuLnB1c2goIHRoaXMuX3VwbG9hZEJ0biApO1xuXG5cdFx0dGhpcy5idXR0b25zLnNldCggdGhpcy5hY3Rpb25CdG4gKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fSxcblx0c2V0RmlsZTpmdW5jdGlvbiggZmlsZSApIHtcblx0XHRjb25zdCBzZWxmID0gdGhpcyxcblx0XHRcdGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXHRcdHRoaXMuZmlsZSA9IGZpbGU7XG5cdFx0ZmlsZVJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbihldmVudCkge1xuLy9cdFx0XHQgICAgYXJyYXlCdWZmZXIgPSBldmVudC50YXJnZXQucmVzdWx0O1xuXHRcdFx0c2VsZi5wYXJzZVBERiggZXZlbnQudGFyZ2V0LnJlc3VsdCApO1xuXHRcdH07XG5cdFx0ZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlciggZmlsZS5ibG9iICk7XG5cdFx0cmV0dXJuIHRoaXMuY3JlYXRlVGl0bGUoKTtcblx0fSxcblx0Y2xpY2tQYWdlOmZ1bmN0aW9uKGUpIHtcblx0XHR0aGlzLnNob3dQYWdlKCQoZS50YXJnZXQpLmF0dHIoJ2RhdGEtcGFnZScpKTtcblx0fSxcblx0cmVuZGVyUGFnZU5hdjpmdW5jdGlvbihudW1QYWdlcykge1xuXHRcdGNvbnN0IHNlbGYgPSB0aGlzLCBidG5zID0gW107XG5cdFx0bGV0IG0sIGkgPSAxLCBwZ0l0ZW07XG5cblx0XHR3aGlsZSAoIHRoaXMuX3BhZ2VzLmxlbmd0aCApIHtcblx0XHRcdHRoaXMuX3BhZ2VzLnBvcCgpO1xuXHRcdH1cblxuXHRcdGZvciAoaTtpPD1udW1QYWdlcztpKyspIHtcblx0XHRcdG0gPSBuZXcgQmFja2JvbmUuTW9kZWwoe1xuXHRcdFx0XHRpZDppLFxuXHRcdFx0XHRzZWxlY3RlZDp0cnVlLFxuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLl9wYWdlcy5hZGQoIG0gKTtcblx0XHRcdHBnSXRlbSA9IG5ldyBQYWdlSXRlbSh7XG5cdFx0XHRcdHBhZ2VudW06aSxcblx0XHRcdFx0c2VsZWN0ZWQ6dHJ1ZSxcblx0XHRcdFx0bW9kZWw6bSxcblx0XHRcdFx0ZXZlbnRzOntcblx0XHRcdFx0XHQnY2hhbmdlIFt0eXBlPVwicmFkaW9cIl0nIDogZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdGlmICggdGhpcy4kKCdbdHlwZT1cInJhZGlvXCJdJykucHJvcCgnY2hlY2tlZCcpICkge1xuXHRcdFx0XHRcdFx0XHRzZWxmLnNob3dQYWdlKCB0aGlzLm9wdGlvbnMucGFnZW51bSApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0J2NoYW5nZSBbdHlwZT1cImNoZWNrYm94XCJdJyA6IGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHR0aGlzLm1vZGVsLnNldCggJ3NlbGVjdGVkJywgdGhpcy4kKCdbdHlwZT1cImNoZWNrYm94XCJdJykucHJvcCgnY2hlY2tlZCcpICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdG0uc2V0KCAncGFnZUl0ZW0nLCBwZ0l0ZW0gKTtcblx0XHRcdGJ0bnMucHVzaCggcGdJdGVtICk7XG5cdFx0fVxuXHRcdHRoaXMucGFnZW5hdi5zZXQoIGJ0bnMgKTtcblx0fSxcblx0c2VsZWN0QWxsOmZ1bmN0aW9uKCkge1xuXHRcdHRoaXMuJCgnLnBkZi1wYWdlLWl0ZW0gPiBbdHlwZT1cImNoZWNrYm94XCJdJykuZWFjaCgoaSxlbCkgPT4ge1xuXHRcdFx0JChlbCkucHJvcCgnY2hlY2tlZCcsdHJ1ZSkudHJpZ2dlcignY2hhbmdlJylcblx0XHR9KVxuXHR9LFxuXHR1bnNlbGVjdEFsbDpmdW5jdGlvbigpIHtcblx0XHR0aGlzLiQoJy5wZGYtcGFnZS1pdGVtID4gW3R5cGU9XCJjaGVja2JveFwiXScpLmVhY2goKGksZWwpID0+IHtcblx0XHRcdCQoZWwpLnByb3AoJ2NoZWNrZWQnLGZhbHNlKS50cmlnZ2VyKCdjaGFuZ2UnKVxuXHRcdH0pXG5cdH0sXG5cdHBhcnNlUERGOiBmdW5jdGlvbiggYXJyICkge1xuXHRcdGNvbnN0IHNlbGYgPSB0aGlzO1xuXHRcdHBkZmpzTGliLmdldERvY3VtZW50KGFycikucHJvbWlzZS50aGVuKFxuXHRcdFx0cGRmID0+IHtcblx0XHRcdFx0c2VsZi5fcGRmID0gcGRmO1xuXHRcdFx0XHRzZWxmLnJlbmRlclBhZ2VOYXYocGRmLm51bVBhZ2VzKVxuXG5cdFx0XHRcdHNlbGYuc2hvd1BhZ2UoMSk7XG5cdFx0XHR9LFxuXHRcdFx0Y29uc29sZS5lcnJvclxuXHRcdClcblx0fSxcblx0c2hvd1BhZ2U6ZnVuY3Rpb24oaWR4KSB7XG5cdFx0Y29uc3Qgc2VsZiA9IHRoaXMsXG5cdFx0XHRtID0gdGhpcy5fcGFnZXMuZ2V0KGlkeCk7XG5cblx0XHRpZiAoICEhIG0uZ2V0KCdjYW52YXMnKSApIHtcblx0XHRcdHRoaXMuY29udGVudC5zZXQoIFtcblx0XHRcdFx0bmV3IHdwLm1lZGlhLlZpZXcoe1xuXHRcdFx0XHRcdGVsOiBtLmdldCgnY2FudmFzJyksXG5cdFx0XHRcdH0pXG5cdFx0XHRdICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuY29udGVudC5zZXQoW25ldyBCYWNrYm9uZS5WaWV3KCldKVxuXHRcdFx0dGhpcy5yZW5kZXJQYWdlKCBpZHgsIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdHNlbGYuc2hvd1BhZ2UoaWR4KTtcblx0XHRcdH0gKTtcblx0XHR9XG5cblx0fSxcblx0cmVuZGVyUGFnZTpmdW5jdGlvbihpZHgsY2IsY2JfYXJncykge1xuXHRcdGNvbnN0IHNlbGYgPSB0aGlzLFxuXHRcdFx0bSA9IHRoaXMuX3BhZ2VzLmdldChpZHgpO1xuXHRcdChhc3luYyAoKSA9PiB7XG5cdFx0XHRjb25zdCBwYWdlID0gYXdhaXQgc2VsZi5fcGRmLmdldFBhZ2UoaWR4KSxcblx0XHRcdFx0Y2FudmFzID0gJCgnPGNhbnZhcz48L2NhbnZhcz4nKS5nZXQoMCksXG5cdFx0XHRcdGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuXG5cdFx0XHRsZXQgdnAgPSBwYWdlLmdldFZpZXdwb3J0KHtzY2FsZToxfSk7XG5cblx0XHRcdHZwID0gcGFnZS5nZXRWaWV3cG9ydCggeyBzY2FsZTogb3B0aW9ucy5pbWFnZV93aWR0aCAvIHZwLndpZHRoIH0gKTtcblxuXHRcdFx0Y2FudmFzLndpZHRoID0gdnAud2lkdGg7XG5cdFx0XHRjYW52YXMuaGVpZ2h0ID0gdnAuaGVpZ2h0O1xuXG5cdFx0XHRwYWdlLnJlbmRlcih7XG5cdFx0XHRcdGNhbnZhc0NvbnRleHQ6IGN0eCxcblx0XHRcdFx0dmlld3BvcnQ6IHZwLFxuXHRcdFx0fSkucHJvbWlzZS50aGVuKCgpID0+IHtcblx0XHRcdFx0bS5zZXQoICdwYWdlJywgcGFnZSApO1xuXHRcdFx0XHRtLnNldCggJ2NhbnZhcycsIGNhbnZhcyApO1xuXHRcdFx0XHQhIWNiICYmIGNiLmFwcGx5KG0sY2JfYXJnc3x8W10pO1xuXHRcdFx0fSk7XG5cblxuXHRcdH0pKCk7XG5cdH0sXG5cblx0dXBsb2FkSW1hZ2VzOmZ1bmN0aW9uKCkge1xuXHRcdGNvbnN0IHNlbGYgPSB0aGlzLFxuXHRcdFx0dHlwZSA9IHNlbGYuZ2V0SW1hZ2VUeXBlKCksXG5cdFx0XHR1cGxvYWQgPSBmdW5jdGlvbiggbmFtZSApIHtcblxuXHRcdFx0XHRjb25zdCBpbWcgPSBuZXcgby5JbWFnZSgpLFxuXHRcdFx0XHRcdG0gPSB0aGlzO1xuXG5cdFx0XHRcdGltZy5vbmxvYWQgPSAoKSA9PiB7XG5cblx0XHRcdFx0XHRpbWcubmFtZSA9IG5hbWU7XG5cdFx0XHRcdFx0aW1nLnR5cGUgPSB0eXBlO1xuXG5cdFx0XHRcdFx0aWYgKCB0eXBlID09PSAnaW1hZ2UvanBlZycgKSB7XG5cdFx0XHRcdFx0XHRzZWxmLm9wdGlvbnMudXBsb2FkZXIuYWRkRmlsZSggaW1nLmdldEFzQmxvYiggdHlwZSwgb3B0aW9ucy5qcGVnX3F1YWxpdHkgKiAwLjAxICksIG5hbWUgKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0c2VsZi5vcHRpb25zLnVwbG9hZGVyLmFkZEZpbGUoIGltZy5nZXRBc0Jsb2IoIHR5cGUgKSwgbmFtZSApO1xuXHRcdFx0XHRcdH1cblxuXG5cdFx0XHRcdFx0bS5zZXQoICdzZWxlY3RlZCcsIGZhbHNlICk7XG5cblx0XHRcdFx0XHRpZiAoICEgc2VsZi5fcGFnZXMud2hlcmUoIHsgc2VsZWN0ZWQ6IHRydWUgfSApLmxlbmd0aCApIHtcblx0XHRcdFx0XHRcdC8vIHRyaWdnZXIgc29tZXRoaW5nXG5cdFx0XHRcdFx0XHRzZWxmLnRyaWdnZXIoJ2NvbXBsZXRlJyk7XG5cdFx0XHRcdFx0XHRzZWxmLnJlc2V0KCkuY2xvc2UoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpbWcubG9hZCggdGhpcy5nZXQoJ2NhbnZhcycpLnRvRGF0YVVSTCggdHlwZSApICk7XG5cdFx0XHRcdC8vXG5cdFx0XHRcdCQoJ2JvZHknKS5hcHBlbmQoaW1nKTtcblx0XHRcdH07XG5cblx0XHR0aGlzLmFjdGlvbkJ0bi5mb3JFYWNoKCBidG4gPT4gYnRuLiRlbC5wcm9wKCdkaXNhYmxlZCcsdHJ1ZSkgKVxuXG5cdFx0Ly8gY3JlYXRlIGUgbmV3IG1lZGlhIG1vZGVsIGZyb20gYmxvYiBkYXRhIFVSTCB0aGluZ3lcblx0XHRfLmVhY2goIHRoaXMuX3BhZ2VzLndoZXJlKCB7IHNlbGVjdGVkOiB0cnVlIH0gKSwgKCBwZywgaSApID0+IHtcblxuXHRcdFx0Y29uc3QgbmFtZSA9IHNlbGYuZmlsZS5maWxlLm5hbWUucmVwbGFjZSgvXFwuW2EtejAtOV0rJC8sJycpICsgJy1wJyArIGkgKyAnLicgKyAoICdpbWFnZS9wbmcnICA9PT0gdHlwZSA/ICdwbmcnIDogJ2pwZycgKTtcblxuXHRcdFx0aWYgKCAhIHBnLmdldCgnY2FudmFzJykgKSB7XG5cdFx0XHRcdC8vIG5lZWRzIHJlbmRlcmluZ1xuXHRcdFx0XHRzZWxmLnJlbmRlclBhZ2UoIHBnLmdldCgnaWQnKSwgdXBsb2FkLFtuYW1lXSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR1cGxvYWQuYXBwbHkocGcsW25hbWVdKVxuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdHRoaXMucmVzZXQoKS5jbG9zZSgpXG5cdH1cbn0pO1xuIl19
