!function(p,l,s){var o,c={view:{}},d=l.l10n,t=-1!==_wpPluploadSettings.defaults.filters.mime_types[0].extensions.split(",").indexOf("pdf");t||(_wpPluploadSettings.defaults.filters.mime_types[0].extensions+=",pdf"),o=wp.media.View.extend({template:wp.template("pdf-page-item"),className:"pdf-page-item",initialize:function(){return wp.media.View.prototype.initialize.apply(this,arguments)},render:function(){return wp.media.View.prototype.render.apply(this,arguments)}}),c.view.PDFFrame=wp.media.view.MediaFrame.extend({template:wp.template("pdf-modal"),regions:["title","content","instructions","buttons","pagenav"],events:{"click [data-page]":"clickPage","click .media-modal-close":function(){this.trigger("cancel-upload"),this.close()}},initialize:function(){var e=this;return _.defaults(this.options,{uploader:!1,title:d.pdfUpload}),wp.media.view.MediaFrame.prototype.initialize.apply(this,arguments),this._pdf=this._canvas=null,this._current_page=0,this._uploadBtn=new wp.media.view.Button({text:d.UploadImages,className:"button-primary",click:function(){e.trigger("cancel-upload"),e.uploadImages()}}),t&&(this._skipBtn=new wp.media.view.Button({text:d.UploadPDF,className:"upload-pdf",click:function(){e.trigger("continue-upload"),e.close()}})),this._cancelBtn=new wp.media.view.Button({text:d.CancelUpload,className:"cancel-upload",click:function(){e.trigger("cancel-upload"),e.close()}}),this._pages=new Backbone.Collection,this.listenTo(this._pages,"change:selected",function(e){this._uploadBtn.$el.prop("disabled",0===this._pages.where({selected:!0}).length)}),this.createTitle(),this.createButtons(),this.on("escape",function(){e.trigger("cancel-upload")}),this},escape:function(){return console.log(this),this.trigger("cancel-upload"),wp.media.view.MediaFrame.prototype.escape.apply(this,arguments)},createTitle:function(){this._title=new wp.media.View({tagName:"h1"}),this._title.$el.text(this.options.title),this.title.set([this._title])},createButtons:function(){var e=[];e.push(this._cancelBtn),t&&e.push(this._skipBtn),e.push(this._uploadBtn),this.buttons.set(e)},setFile:function(e){var t=this,i=new FileReader;return this.file=e,i.onload=function(e){t.parsePDF(e.target.result)},i.readAsArrayBuffer(e.blob),this},clickPage:function(e){this.showPage(p(e.target).attr("data-page"))},renderPageNav:function(e){console.log();for(var t,i=this,a=1,n=[];this._pages.length;)this._pages.pop();for(;a<=e;a++)t=new Backbone.Model({id:a,selected:!0}),this._pages.add(t),n.push(new o({pagenum:a,selected:!0,model:t,events:{'change [type="radio"]':function(){this.$('[type="radio"]').prop("checked")&&i.showPage(this.options.pagenum)},'change [type="checkbox"]':function(){this.model.set("selected",this.$('[type="checkbox"]').prop("checked"))}}}));this.pagenav.set(n)},parsePDF:function(e){var t=this;pdfjsLib.getDocument(e).then(function(e){t._pdf=e,t.renderPageNav(e.numPages),t.showPage(1)})},showPage:function(e){var t=this,i=this._pages.get(e);i.get("canvas")?this.content.set([new wp.media.View({el:i.get("canvas")})]):(this.content.set([new Backbone.View]),this.renderPage(e,function(){t.showPage(e)}))},renderPage:function(e,n,o){var s=this._pages.get(e);this._pdf.getPage(e).then(function(e){var t=e.getViewport(1),i=p("<canvas></canvas>").get(0),a=i.getContext("2d");t=e.getViewport(l.options.image_width/t.width),i.width=t.width,i.height=t.height,e.render({canvasContext:a,viewport:t}).then(function(){s.set("page",e),s.set("canvas",i),n&&n.apply(s,o||[])})})},uploadImages:function(){var a=this,n="image/png",o=function(e){var t=new s.Image,i=this;t.onload=function(){t.name=e,t.type=n,a.options.uploader.addFile(t.getAsBlob(),e),a._pages.remove(i.id),a._pages.length||a.close()},t.load(this.get("canvas").toDataURL(n)),p("body").append(t)};_.each(this._pages.where({selected:!0}),function(e,t){var i=a.file.file.name.replace(/\.[a-z0-9]+$/,"")+"-p"+t+".png";e.get("canvas")?(o.apply(e,[i]),console.log("direct:",e.get("id"))):(a.renderPage(e.get("id"),o,[i]),console.log("render:",e.get("id")))})}}),_.extend(wp.media.view.UploaderWindow.prototype,{_parentReady:wp.media.view.UploaderWindow.prototype.ready,didReady:!1,ready:function(){var n;if(this.didReady)return this._parentReady.apply(this,arguments);return this.didReady=!0,ret=this._parentReady.apply(this,arguments),this.uploader.uploader.bind("BeforeUpload",function(e,t){var i,a;console.log("BEFORE UPLOAD"),"application/pdf"==t.type&&(fileData=((a={file:i=t,blob:i.getNative()}).blob||(a.blob=i.getSource()),a),fileData.blob instanceof Blob&&(e.stop(),e.refresh(),function e(t,i){n&&n.close().dispose(),(n=new c.view.PDFFrame({controller:p(this),uploader:t,title:d.Upload+": "+i.file.name.replace(/\.[a-z0-9]+$/,"")})).on("proceed",function(){e(t)}).on("cancel-upload",function(){t.removeFile(i.file),i.file.attachment.destroy()}).on("continue-upload",function(){t.start()}),n.setFile(i),n.open()}(e,fileData)))}),ret}})}(jQuery,pdf_renderer,mOxie);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lZGlhLmpzIl0sIm5hbWVzIjpbIiQiLCJvcHRzIiwibyIsIlBhZ2VJdGVtIiwicGRmUmVuZGVyZXIiLCJ2aWV3IiwibDEwbiIsInBkZkFsbG93ZWQiLCJfd3BQbHVwbG9hZFNldHRpbmdzIiwiZGVmYXVsdHMiLCJmaWx0ZXJzIiwibWltZV90eXBlcyIsImV4dGVuc2lvbnMiLCJzcGxpdCIsImluZGV4T2YiLCJ3cCIsIm1lZGlhIiwiVmlldyIsImV4dGVuZCIsInRlbXBsYXRlIiwiY2xhc3NOYW1lIiwiaW5pdGlhbGl6ZSIsInByb3RvdHlwZSIsImFwcGx5IiwidGhpcyIsImFyZ3VtZW50cyIsInJlbmRlciIsIlBERkZyYW1lIiwiTWVkaWFGcmFtZSIsInJlZ2lvbnMiLCJldmVudHMiLCJjbGljayBbZGF0YS1wYWdlXSIsImNsaWNrIC5tZWRpYS1tb2RhbC1jbG9zZSIsInRyaWdnZXIiLCJjbG9zZSIsInNlbGYiLCJfIiwib3B0aW9ucyIsInVwbG9hZGVyIiwidGl0bGUiLCJwZGZVcGxvYWQiLCJfcGRmIiwiX2NhbnZhcyIsIl9jdXJyZW50X3BhZ2UiLCJfdXBsb2FkQnRuIiwiQnV0dG9uIiwidGV4dCIsIlVwbG9hZEltYWdlcyIsImNsaWNrIiwidXBsb2FkSW1hZ2VzIiwiX3NraXBCdG4iLCJVcGxvYWRQREYiLCJfY2FuY2VsQnRuIiwiQ2FuY2VsVXBsb2FkIiwiX3BhZ2VzIiwiQmFja2JvbmUiLCJDb2xsZWN0aW9uIiwibGlzdGVuVG8iLCJlIiwiJGVsIiwicHJvcCIsIndoZXJlIiwic2VsZWN0ZWQiLCJsZW5ndGgiLCJjcmVhdGVUaXRsZSIsImNyZWF0ZUJ1dHRvbnMiLCJvbiIsImVzY2FwZSIsImNvbnNvbGUiLCJsb2ciLCJfdGl0bGUiLCJ0YWdOYW1lIiwic2V0IiwiYnRucyIsInB1c2giLCJidXR0b25zIiwic2V0RmlsZSIsImZpbGUiLCJmaWxlUmVhZGVyIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsImV2ZW50IiwicGFyc2VQREYiLCJ0YXJnZXQiLCJyZXN1bHQiLCJyZWFkQXNBcnJheUJ1ZmZlciIsImJsb2IiLCJjbGlja1BhZ2UiLCJzaG93UGFnZSIsImF0dHIiLCJyZW5kZXJQYWdlTmF2IiwibnVtUGFnZXMiLCJtIiwiaSIsInBvcCIsIk1vZGVsIiwiaWQiLCJhZGQiLCJwYWdlbnVtIiwibW9kZWwiLCJjaGFuZ2UgW3R5cGU9XCJyYWRpb1wiXSIsImNoYW5nZSBbdHlwZT1cImNoZWNrYm94XCJdIiwicGFnZW5hdiIsImFyciIsInBkZmpzTGliIiwiZ2V0RG9jdW1lbnQiLCJ0aGVuIiwicGRmIiwiaWR4IiwiZ2V0IiwiY29udGVudCIsImVsIiwicmVuZGVyUGFnZSIsImNiIiwiY2JfYXJncyIsImdldFBhZ2UiLCJwYWdlIiwidnAiLCJnZXRWaWV3cG9ydCIsImNhbnZhcyIsImN0eCIsImdldENvbnRleHQiLCJpbWFnZV93aWR0aCIsIndpZHRoIiwiaGVpZ2h0IiwiY2FudmFzQ29udGV4dCIsInZpZXdwb3J0IiwidHlwZSIsInVwbG9hZCIsIm5hbWUiLCJpbWciLCJJbWFnZSIsImFkZEZpbGUiLCJnZXRBc0Jsb2IiLCJyZW1vdmUiLCJsb2FkIiwidG9EYXRhVVJMIiwiYXBwZW5kIiwiZWFjaCIsInBnIiwicmVwbGFjZSIsIlVwbG9hZGVyV2luZG93IiwiX3BhcmVudFJlYWR5IiwicmVhZHkiLCJkaWRSZWFkeSIsInBkZk1vZGFsIiwicmV0IiwiYmluZCIsInVwIiwiX3JldCIsImZpbGVEYXRhIiwiZ2V0TmF0aXZlIiwiZ2V0U291cmNlIiwiQmxvYiIsInN0b3AiLCJyZWZyZXNoIiwicGRmUG9wdXAiLCJmaWxlSXRlbSIsImRpc3Bvc2UiLCJjb250cm9sbGVyIiwiVXBsb2FkIiwicmVtb3ZlRmlsZSIsImF0dGFjaG1lbnQiLCJkZXN0cm95Iiwic3RhcnQiLCJvcGVuIiwialF1ZXJ5IiwicGRmX3JlbmRlcmVyIiwibU94aWUiXSwibWFwcGluZ3MiOiJDQUFBLFNBQVdBLEVBQUdDLEVBQU1DLEdBRW5CLElBS0NDLEVBTEdDLEVBQWMsQ0FDaEJDLEtB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U0RDLFNBQVNoRSxnQkFBZ0JtRSxPQUM3QkwsRUFBR00sT0FDSE4sRUFBR08sVUEvQ04sU0FBU0MsRUFBVXRILEVBQVV1SCxHQUV2QlosR0FDSkEsRUFBUy9HLFFBQVE0SCxXQUdsQmIsRUFBVyxJQUFJN0ksRUFBWUMsS0FBS3NCLFNBQVUsQ0FDekNvSSxXQUFZL0osRUFBRXdCLE1BQ2RjLFNBQVNBLEVBQ1RDLE1BQU9qQyxFQUFLMEosT0FBUyxLQUFPSCxFQUFTaEYsS0FBS29ELEtBQUtXLFFBQVEsZUFBZSxPQUU5RDFFLEdBQUcsVUFBVSxXQUVyQjBGLEVBQVV0SCxLQUVSNEIsR0FBRyxnQkFBZ0IsV0FDckI1QixFQUFTMkgsV0FBWUosRUFBU2hGLE1BQzlCZ0YsRUFBU2hGLEtBQUtxRixXQUFXQyxZQUN2QmpHLEdBQUcsa0JBQWtCLFdBQ3ZCNUIsRUFBUzhILFVBRVZuQixFQUFTckUsUUFBU2lGLEdBQ2xCWixFQUFTb0IsT0EwQlBULENBQVVSLEVBQUlFLGNBT1ZKLE9BL1ZWLENBbVdJb0IsT0FBUUMsYUFBY0MiLCJmaWxlIjoiYWRtaW4vbWVkaWEuZGV2LmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCAkLCBvcHRzLCBvICkge1xuXG5cdHZhciBwZGZSZW5kZXJlciA9IHtcblx0XHRcdHZpZXc6IHt9XG5cdFx0fSxcblx0XHRsMTBuID0gb3B0cy5sMTBuLFxuXHRcdGltYWdlSW5mb3MgPSB7fSxcblx0XHRQYWdlSXRlbSxcblx0XHRwZGZBbGxvd2VkID0gX3dwUGx1cGxvYWRTZXR0aW5ncy5kZWZhdWx0cy5maWx0ZXJzLm1pbWVfdHlwZXNbMF0uZXh0ZW5zaW9ucy5zcGxpdCgnLCcpLmluZGV4T2YoJ3BkZicpICE9PSAtMTtcblxuXHQvLyB0ZW1wb3JhaWx5IGFkZCBwZGYgdHlwZSB0byBwbHVwbG9hZCBzZXR0aW5ncyxcblx0Ly8gc28gdGhlIHVwbG9hZGVyIGRvZXNuJ3QgY2FuY2VsIHRvbyBlYXJseS5cblx0Ly8gRmlsZSB0eXBlcyBhcmUgY2hlY2tlZCBzZXJ2ZXItc2lkZSB0b28sIHNvXG5cdC8vIHRoZXJlIHNob3VsZCBiZSBubyBzZWN1cml0eSBpbXBsaWNhdGlvbnMuXG5cdGlmICggISBwZGZBbGxvd2VkICkge1xuXHRcdF93cFBsdXBsb2FkU2V0dGluZ3MuZGVmYXVsdHMuZmlsdGVycy5taW1lX3R5cGVzWzBdLmV4dGVuc2lvbnMgKz0gJyxwZGYnO1xuXHR9XG5cblx0UGFnZUl0ZW0gPSB3cC5tZWRpYS5WaWV3LmV4dGVuZCh7XG5cdFx0dGVtcGxhdGU6ICB3cC50ZW1wbGF0ZSgncGRmLXBhZ2UtaXRlbScpLFxuXHRcdGNsYXNzTmFtZToncGRmLXBhZ2UtaXRlbScsXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB3cC5tZWRpYS5WaWV3LnByb3RvdHlwZS5pbml0aWFsaXplLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcblx0XHR9LFxuXHRcdHJlbmRlcjpmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB3cC5tZWRpYS5WaWV3LnByb3RvdHlwZS5yZW5kZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXHRcdH1cblx0fSk7XG5cblx0cGRmUmVuZGVyZXIudmlldy5QREZGcmFtZSA9IHdwLm1lZGlhLnZpZXcuTWVkaWFGcmFtZS5leHRlbmQoe1xuXHRcdHRlbXBsYXRlOiB3cC50ZW1wbGF0ZSgncGRmLW1vZGFsJyksXG5cdFx0cmVnaW9uczogWyAndGl0bGUnLCdjb250ZW50JywnaW5zdHJ1Y3Rpb25zJywnYnV0dG9ucycsICdwYWdlbmF2JyBdLFxuXHRcdGV2ZW50czoge1xuXHRcdFx0J2NsaWNrIFtkYXRhLXBhZ2VdJyA6ICdjbGlja1BhZ2UnLFxuXHRcdFx0J2NsaWNrIC5tZWRpYS1tb2RhbC1jbG9zZScgOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0dGhpcy50cmlnZ2VyKCdjYW5jZWwtdXBsb2FkJyk7XG5cdFx0XHRcdHRoaXMuY2xvc2UoKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdF8uZGVmYXVsdHMoIHRoaXMub3B0aW9ucywge1xuXHRcdFx0XHR1cGxvYWRlcjpcdGZhbHNlLFxuXHRcdFx0XHR0aXRsZTpcdFx0bDEwbi5wZGZVcGxvYWQsXG5cdFx0XHR9KTtcblxuXHRcdFx0d3AubWVkaWEudmlldy5NZWRpYUZyYW1lLnByb3RvdHlwZS5pbml0aWFsaXplLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcblxuXHRcdFx0dGhpcy5fcGRmID0gdGhpcy5fY2FudmFzID0gbnVsbDtcblx0XHRcdHRoaXMuX2N1cnJlbnRfcGFnZSA9IDA7XG5cblx0XHRcdHRoaXMuX3VwbG9hZEJ0biA9IG5ldyB3cC5tZWRpYS52aWV3LkJ1dHRvbih7XG5cdFx0XHRcdHRleHQ6IGwxMG4uVXBsb2FkSW1hZ2VzLFxuXHRcdFx0XHRjbGFzc05hbWU6ICdidXR0b24tcHJpbWFyeScsXG5cdFx0XHRcdGNsaWNrOmZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHNlbGYudHJpZ2dlcignY2FuY2VsLXVwbG9hZCcpO1xuXHRcdFx0XHRcdHNlbGYudXBsb2FkSW1hZ2VzKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0aWYgKCBwZGZBbGxvd2VkICkge1xuXHRcdFx0XHR0aGlzLl9za2lwQnRuID0gbmV3IHdwLm1lZGlhLnZpZXcuQnV0dG9uKHtcblx0XHRcdFx0XHR0ZXh0OiBsMTBuLlVwbG9hZFBERixcblx0XHRcdFx0XHRjbGFzc05hbWU6ICd1cGxvYWQtcGRmJyxcblx0XHRcdFx0XHRjbGljazpmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdHNlbGYudHJpZ2dlcignY29udGludWUtdXBsb2FkJyk7XG5cdFx0XHRcdFx0XHRzZWxmLmNsb3NlKCk7XG5cdFx0XHRcdFx0XHQvLyBkaXNtaXNzLCBjb250aW51ZSB3aXRoIHdwIGRlZmF1bHQgYmVoYXZpb3VyXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdHRoaXMuX2NhbmNlbEJ0biA9IG5ldyB3cC5tZWRpYS52aWV3LkJ1dHRvbih7XG5cdFx0XHRcdHRleHQ6IGwxMG4uQ2FuY2VsVXBsb2FkLFxuXHRcdFx0XHRjbGFzc05hbWU6ICdjYW5jZWwtdXBsb2FkJyxcblx0XHRcdFx0Y2xpY2s6ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0c2VsZi50cmlnZ2VyKCdjYW5jZWwtdXBsb2FkJyk7XG5cdFx0XHRcdFx0c2VsZi5jbG9zZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5fcGFnZXMgPSBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbigpO1xuXHRcdFx0dGhpcy5saXN0ZW5Ubyh0aGlzLl9wYWdlcywnY2hhbmdlOnNlbGVjdGVkJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0Ly8gZGlzYWJsZSBpbWcgdXBsb2FkIGJ0biBpZiBubyBwYWdlcyBzZWxlY3RlZFxuXHRcdFx0XHR0aGlzLl91cGxvYWRCdG4uJGVsLnByb3AoJ2Rpc2FibGVkJywgdGhpcy5fcGFnZXMud2hlcmUoe3NlbGVjdGVkOnRydWV9KS5sZW5ndGggPT09IDAgKVxuXHRcdFx0fSlcblxuXHRcdFx0dGhpcy5jcmVhdGVUaXRsZSgpO1xuXHRcdFx0dGhpcy5jcmVhdGVCdXR0b25zKCk7XG5cblx0XHRcdHRoaXMub24oJ2VzY2FwZScsZnVuY3Rpb24oKXtcblx0XHRcdFx0c2VsZi50cmlnZ2VyKCdjYW5jZWwtdXBsb2FkJyk7XG5cdFx0XHR9KVxuXG5cdFx0XHRyZXR1cm4gdGhpcztcblxuXHRcdH0sXG5cdFx0ZXNjYXBlOmZ1bmN0aW9uKCkge1xuXHRcdFx0Y29uc29sZS5sb2codGhpcyk7XG5cdFx0XHR0aGlzLnRyaWdnZXIoJ2NhbmNlbC11cGxvYWQnKTtcblx0XHRcdHJldHVybiB3cC5tZWRpYS52aWV3Lk1lZGlhRnJhbWUucHJvdG90eXBlLmVzY2FwZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0fSxcblx0XHRjcmVhdGVUaXRsZTogZnVuY3Rpb24oICkge1xuXHRcdFx0dGhpcy5fdGl0bGUgPSBuZXcgd3AubWVkaWEuVmlldyh7XG5cdFx0XHRcdHRhZ05hbWU6ICdoMSdcblx0XHRcdH0pO1xuXHRcdFx0dGhpcy5fdGl0bGUuJGVsLnRleHQoIHRoaXMub3B0aW9ucy50aXRsZSApO1xuXHRcdFx0dGhpcy50aXRsZS5zZXQoIFsgdGhpcy5fdGl0bGUgXSApO1xuXHRcdH0sXG5cdFx0Y3JlYXRlQnV0dG9uczogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGJ0bnMgPSBbXTtcblx0XHRcdGJ0bnMucHVzaCggdGhpcy5fY2FuY2VsQnRuICk7XG5cdFx0XHRpZiAoIHBkZkFsbG93ZWQgKSB7XG5cdFx0XHRcdGJ0bnMucHVzaCggdGhpcy5fc2tpcEJ0biApO1xuXHRcdFx0fVxuXHRcdFx0YnRucy5wdXNoKCB0aGlzLl91cGxvYWRCdG4gKTtcblx0XHRcdHRoaXMuYnV0dG9ucy5zZXQoIGJ0bnMgKTtcblx0XHR9LFxuXHRcdHNldEZpbGU6ZnVuY3Rpb24oIGZpbGUgKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXHRcdFx0dGhpcy5maWxlID0gZmlsZTtcblx0XHRcdGZpbGVSZWFkZXIub25sb2FkID0gZnVuY3Rpb24oZXZlbnQpIHtcbi8vXHRcdFx0ICAgIGFycmF5QnVmZmVyID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcblx0XHRcdFx0c2VsZi5wYXJzZVBERiggZXZlbnQudGFyZ2V0LnJlc3VsdCApO1xuXHRcdFx0fTtcblx0XHRcdGZpbGVSZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoIGZpbGUuYmxvYiApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRjbGlja1BhZ2U6ZnVuY3Rpb24oZSkge1xuXHRcdFx0dGhpcy5zaG93UGFnZSgkKGUudGFyZ2V0KS5hdHRyKCdkYXRhLXBhZ2UnKSk7XG5cdFx0fSxcblx0XHRyZW5kZXJQYWdlTmF2OmZ1bmN0aW9uKG51bVBhZ2VzKSB7XG5cdFx0XHRjb25zb2xlLmxvZygpXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGkgPSAxLCBidG5zID0gW10sIG07XG5cblx0XHRcdHdoaWxlICggdGhpcy5fcGFnZXMubGVuZ3RoICkge1xuXHRcdFx0XHR0aGlzLl9wYWdlcy5wb3AoKTtcblx0XHRcdH1cblxuXHRcdFx0Zm9yIChpO2k8PW51bVBhZ2VzO2krKykge1xuXHRcdFx0XHRtID0gbmV3IEJhY2tib25lLk1vZGVsKHtcblx0XHRcdFx0XHRpZDppLFxuXHRcdFx0XHRcdHNlbGVjdGVkOnRydWUsXG5cdFx0XHRcdH0pO1xuXHRcdFx0XHR0aGlzLl9wYWdlcy5hZGQoIG0gKTtcblxuXHRcdFx0XHRidG5zLnB1c2goXG5cdFx0XHRcdFx0bmV3IFBhZ2VJdGVtKHtcblx0XHRcdFx0XHRcdHBhZ2VudW06aSxcblx0XHRcdFx0XHRcdHNlbGVjdGVkOnRydWUsXG5cdFx0XHRcdFx0XHRtb2RlbDptLFxuXHRcdFx0XHRcdFx0ZXZlbnRzOntcblx0XHRcdFx0XHRcdFx0J2NoYW5nZSBbdHlwZT1cInJhZGlvXCJdJyA6IGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKCB0aGlzLiQoJ1t0eXBlPVwicmFkaW9cIl0nKS5wcm9wKCdjaGVja2VkJykgKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzZWxmLnNob3dQYWdlKCB0aGlzLm9wdGlvbnMucGFnZW51bSApO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0J2NoYW5nZSBbdHlwZT1cImNoZWNrYm94XCJdJyA6IGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5tb2RlbC5zZXQoICdzZWxlY3RlZCcsIHRoaXMuJCgnW3R5cGU9XCJjaGVja2JveFwiXScpLnByb3AoJ2NoZWNrZWQnKSApO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0KTtcblxuXHRcdFx0fVxuXHRcdFx0dGhpcy5wYWdlbmF2LnNldCggYnRucyApO1xuXHRcdH0sXG5cdFx0cGFyc2VQREY6ZnVuY3Rpb24oIGFyciApIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdHBkZmpzTGliLmdldERvY3VtZW50KGFycikudGhlbihmdW5jdGlvbihwZGYpIHtcblx0XHRcdFx0Ly8gYnVpbGQgcGFnZXMgc2VsZWN0b3Jcblx0XHRcdFx0c2VsZi5fcGRmID0gcGRmO1xuXHRcdFx0XHRzZWxmLnJlbmRlclBhZ2VOYXYocGRmLm51bVBhZ2VzKVxuXG5cdFx0XHRcdHNlbGYuc2hvd1BhZ2UoMSk7XG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdHNob3dQYWdlOmZ1bmN0aW9uKGlkeCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRtID0gdGhpcy5fcGFnZXMuZ2V0KGlkeCk7XG5cblx0XHRcdGlmICggISEgbS5nZXQoJ2NhbnZhcycpICkge1xuXHRcdFx0XHR0aGlzLmNvbnRlbnQuc2V0KCBbXG5cdFx0XHRcdFx0bmV3IHdwLm1lZGlhLlZpZXcoe1xuXHRcdFx0XHRcdFx0ZWw6IG0uZ2V0KCdjYW52YXMnKSxcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRdICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmNvbnRlbnQuc2V0KFtuZXcgQmFja2JvbmUuVmlldygpXSlcblx0XHRcdFx0dGhpcy5yZW5kZXJQYWdlKCBpZHgsIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0c2VsZi5zaG93UGFnZShpZHgpO1xuXHRcdFx0XHR9ICk7XG5cdFx0XHR9XG5cblx0XHR9LFxuXHRcdHJlbmRlclBhZ2U6ZnVuY3Rpb24oaWR4LGNiLGNiX2FyZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0bSA9IHRoaXMuX3BhZ2VzLmdldChpZHgpO1xuXG5cdFx0XHRzZWxmLl9wZGYuZ2V0UGFnZShpZHgpLnRoZW4oZnVuY3Rpb24ocGFnZSl7XG5cdFx0XHRcdHZhciB2cCA9IHBhZ2UuZ2V0Vmlld3BvcnQoMSksXG5cdFx0XHRcdFx0Y2FudmFzID0gJCgnPGNhbnZhcz48L2NhbnZhcz4nKS5nZXQoMCksXG5cdFx0XHRcdFx0Y3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cblx0XHRcdFx0dnAgPSBwYWdlLmdldFZpZXdwb3J0KCBvcHRzLm9wdGlvbnMuaW1hZ2Vfd2lkdGggLyB2cC53aWR0aCApO1xuXG5cdFx0XHRcdGNhbnZhcy53aWR0aCA9IHZwLndpZHRoO1xuXHRcdFx0XHRjYW52YXMuaGVpZ2h0ID0gdnAuaGVpZ2h0O1xuXG5cdFx0XHRcdHBhZ2UucmVuZGVyKHtcblx0XHRcdFx0XHRjYW52YXNDb250ZXh0OiBjdHgsXG5cdFx0XHRcdFx0dmlld3BvcnQ6IHZwLFxuXHRcdFx0XHR9KS50aGVuKGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0bS5zZXQoICdwYWdlJywgcGFnZSApO1xuXHRcdFx0XHRcdG0uc2V0KCAnY2FudmFzJywgY2FudmFzICk7XG5cblx0XHRcdFx0XHQhIWNiICYmIGNiLmFwcGx5KG0sY2JfYXJnc3x8W10pO1xuLy9cdFx0XHRcdFx0c2VsZi5zaG93UGFnZShpZHgpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblxuXHRcdHVwbG9hZEltYWdlczpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0dHlwZSA9ICdpbWFnZS9wbmcnLFxuXHRcdFx0XHR1cGxvYWQgPSBmdW5jdGlvbihuYW1lKXtcblx0XHRcdFx0XHQvKlxuXHRcdFx0XHRcdHRoaXMuY2FudmFzLnRvQmxvYihmdW5jdGlvbihibG9iKXtcblx0XHRcdFx0XHRcdGJsb2IubmFtZSA9IG5hbWU7XG5cdFx0XHRcdFx0XHRibG9iLnR5cGUgPSB0eXBlO1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coYmxvYi5uYW1lKVxuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coc2VsZi5vcHRpb25zLnVwbG9hZGVyLGJsb2IpXG5cdFx0XHRcdFx0XHRzZWxmLm9wdGlvbnMudXBsb2FkZXIuYWRkRmlsZSggYmxvYiwgbmFtZSApO1xuXHRcdFx0XHRcdH0sdHlwZSk7XG5cdFx0XHRcdFx0LyovXG5cdFx0XHRcdFx0dmFyIGltZyA9IG5ldyBvLkltYWdlKCksXG5cdFx0XHRcdFx0XHRtID0gdGhpcztcblx0XHRcdFx0XHRpbWcub25sb2FkID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRpbWcubmFtZSA9IG5hbWU7XG5cdFx0XHRcdFx0XHRpbWcudHlwZSA9IHR5cGU7XG5cdFx0XHRcdFx0XHRzZWxmLm9wdGlvbnMudXBsb2FkZXIuYWRkRmlsZSggaW1nLmdldEFzQmxvYigpLCBuYW1lICk7XG5cblx0XHRcdFx0XHRcdHNlbGYuX3BhZ2VzLnJlbW92ZShtLmlkKTtcblxuXHRcdFx0XHRcdFx0aWYgKCAhIHNlbGYuX3BhZ2VzLmxlbmd0aCApIHtcblx0XHRcdFx0XHRcdFx0c2VsZi5jbG9zZSgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGltZy5sb2FkKCB0aGlzLmdldCgnY2FudmFzJykudG9EYXRhVVJMKHR5cGUpICk7XG5cdFx0XHRcdFx0Ly9cblx0XHRcdFx0XHQkKCdib2R5JykuYXBwZW5kKGltZyk7XG5cdFx0XHRcdH07XG5cblx0XHRcdC8vIGNyZWF0ZSBlIG5ldyBtZWRpYSBtb2RlbCBmcm9tIGJsb2IgZGF0YSBVUkwgdGhpbmd5XG5cblx0XHRcdF8uZWFjaCggdGhpcy5fcGFnZXMud2hlcmUoIHsgc2VsZWN0ZWQ6IHRydWUgfSApLCBmdW5jdGlvbiggcGcsIGkgKXtcblxuXHRcdFx0XHR2YXIgbmFtZSA9IHNlbGYuZmlsZS5maWxlLm5hbWUucmVwbGFjZSgvXFwuW2EtejAtOV0rJC8sJycpICsgJy1wJyArIGkgKyAnLnBuZyc7XG5cblx0XHRcdFx0aWYgKCAhIHBnLmdldCgnY2FudmFzJykgKSB7XG5cdFx0XHRcdFx0Ly8gbmVlZHMgcmVuZGVyaW5nXG5cdFx0XHRcdFx0c2VsZi5yZW5kZXJQYWdlKCBwZy5nZXQoJ2lkJyksIHVwbG9hZCxbbmFtZV0pO1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKCdyZW5kZXI6JyxwZy5nZXQoJ2lkJykpXG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dXBsb2FkLmFwcGx5KHBnLFtuYW1lXSlcblx0XHRcdFx0XHRjb25zb2xlLmxvZygnZGlyZWN0OicscGcuZ2V0KCdpZCcpKVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXG5cdFx0XHQvL1xuXHRcdH1cblx0fSk7XG5cblxuXHRfLmV4dGVuZCggd3AubWVkaWEudmlldy5VcGxvYWRlcldpbmRvdy5wcm90b3R5cGUsIHtcblx0XHRfcGFyZW50UmVhZHk6IHdwLm1lZGlhLnZpZXcuVXBsb2FkZXJXaW5kb3cucHJvdG90eXBlLnJlYWR5LFxuXHRcdGRpZFJlYWR5OmZhbHNlLFxuXG5cdFx0cmVhZHk6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgcGRmcyA9IFtdLFxuXHRcdFx0XHRwZGZNb2RhbCwgc2VsZiA9IHRoaXM7XG5cblx0XHRcdC8vIHByZXZlbnQgZG91YmxlIGluaXRcblx0XHRcdGlmICggdGhpcy5kaWRSZWFkeSApIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX3BhcmVudFJlYWR5LmFwcGx5KCB0aGlzICwgYXJndW1lbnRzICk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLmRpZFJlYWR5ID0gdHJ1ZTtcblxuXHRcdFx0cmV0ID0gdGhpcy5fcGFyZW50UmVhZHkuYXBwbHkoIHRoaXMgLCBhcmd1bWVudHMgKTtcblxuXHRcdFx0ZnVuY3Rpb24gcGRmUG9wdXAoIHVwbG9hZGVyLCBmaWxlSXRlbSApIHtcblxuXHRcdFx0XHRpZiAoIHBkZk1vZGFsICkge1xuXHRcdFx0XHRcdHBkZk1vZGFsLmNsb3NlKCkuZGlzcG9zZSgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cGRmTW9kYWwgPSBuZXcgcGRmUmVuZGVyZXIudmlldy5QREZGcmFtZSgge1xuXHRcdFx0XHRcdGNvbnRyb2xsZXI6ICQodGhpcyksXG5cdFx0XHRcdFx0dXBsb2FkZXI6dXBsb2FkZXIsXG5cdFx0XHRcdFx0dGl0bGU6IGwxMG4uVXBsb2FkICsgJzogJyArIGZpbGVJdGVtLmZpbGUubmFtZS5yZXBsYWNlKC9cXC5bYS16MC05XSskLywnJyksXG5cdFx0XHRcdH0gKTtcblx0XHRcdFx0cGRmTW9kYWwub24oJ3Byb2NlZWQnLGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdC8vIG5leHRcblx0XHRcdFx0XHRwZGZQb3B1cCggdXBsb2FkZXIgKTtcblxuXHRcdFx0XHR9KS5vbignY2FuY2VsLXVwbG9hZCcsZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0dXBsb2FkZXIucmVtb3ZlRmlsZSggZmlsZUl0ZW0uZmlsZSApOyAvLyAhIVxuXHRcdFx0XHRcdGZpbGVJdGVtLmZpbGUuYXR0YWNobWVudC5kZXN0cm95KCk7XG5cdFx0XHRcdH0pLm9uKCdjb250aW51ZS11cGxvYWQnLGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0dXBsb2FkZXIuc3RhcnQoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdHBkZk1vZGFsLnNldEZpbGUoIGZpbGVJdGVtICk7XG5cdFx0XHRcdHBkZk1vZGFsLm9wZW4oKTtcblx0XHRcdH1cblxuXHRcdFx0LyoqXG5cdFx0XHQgKlx0QHJldHVybiBuYXRpdmUgZmlsZSBvYmplY3Qgb3IgYmxvYlxuXHRcdFx0ICovXG5cdFx0XHRmdW5jdGlvbiByZXNvbHZlRmlsZSggZmlsZSApIHtcblx0XHRcdFx0dmFyIF9yZXQgPSB7XG5cdFx0XHRcdFx0ZmlsZTogZmlsZSxcblx0XHRcdFx0XHRibG9iOmZpbGUuZ2V0TmF0aXZlKClcblx0XHRcdFx0fSwgX3JldDIsIGJ5dGVzLCBpO1xuXHRcdFx0XHRpZiAoICEgX3JldC5ibG9iICkge1xuXHRcdFx0XHRcdF9yZXQuYmxvYiA9IGZpbGUuZ2V0U291cmNlKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIF9yZXQ7XG5cdFx0XHR9XG5cblx0XHRcdC8vIHNlbmQgY3JvcGRhdGFcblx0XHRcdHRoaXMudXBsb2FkZXIudXBsb2FkZXIuYmluZCgnQmVmb3JlVXBsb2FkJyxmdW5jdGlvbiggdXAsIGZpbGUgKSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdCRUZPUkUgVVBMT0FEJylcblx0XHRcdFx0aWYgKCBmaWxlLnR5cGUgPT0gJ2FwcGxpY2F0aW9uL3BkZicpIHtcblxuXHRcdFx0XHRcdGZpbGVEYXRhID0gcmVzb2x2ZUZpbGUoIGZpbGUgKTtcblx0XHRcdFx0XHRpZiAoIGZpbGVEYXRhLmJsb2IgaW5zdGFuY2VvZiBCbG9iICkge1xuXHRcdFx0XHRcdFx0dXAuc3RvcCgpO1xuXHRcdFx0XHRcdFx0dXAucmVmcmVzaCgpO1xuXHRcdFx0XHRcdFx0cGRmUG9wdXAoIHVwLCBmaWxlRGF0YSApOyAvLyB3aWxsIGFzayBmb3IgZm9jdXMgb3Igc3RhcnQgdXBsb2FkZXJcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIHBkZnMubGVuZ3RoICkge1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXHR9KTtcblxufSkoIGpRdWVyeSwgcGRmX3JlbmRlcmVyLCBtT3hpZSApO1xuIl19
