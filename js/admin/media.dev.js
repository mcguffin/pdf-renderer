!function(p,l,s){var o,c={view:{}},d=l.l10n,t=-1!==_wpPluploadSettings.defaults.filters.mime_types[0].extensions.split(",").indexOf("pdf");t||(_wpPluploadSettings.defaults.filters.mime_types[0].extensions+=",pdf"),o=wp.media.View.extend({template:wp.template("pdf-page-item"),className:"pdf-page-item",initialize:function(){return wp.media.View.prototype.initialize.apply(this,arguments)},render:function(){return wp.media.View.prototype.render.apply(this,arguments)}}),c.view.PDFFrame=wp.media.view.MediaFrame.extend({template:wp.template("pdf-modal"),regions:["title","content","instructions","buttons","pagenav"],events:{"click [data-page]":"clickPage","click .media-modal-close":function(){this.trigger("cancel-upload"),this.close()}},initialize:function(){var e=this;return _.defaults(this.options,{uploader:!1,title:d.pdfUpload}),wp.media.view.MediaFrame.prototype.initialize.apply(this,arguments),this._pdf=this._canvas=null,this._current_page=0,this._uploadBtn=new wp.media.view.Button({text:d.UploadImages,className:"button-primary",click:function(){e.trigger("cancel-upload"),e.uploadImages()}}),t&&(this._skipBtn=new wp.media.view.Button({text:d.UploadPDF,className:"upload-pdf",click:function(){e.trigger("continue-upload"),e.close()}})),this._cancelBtn=new wp.media.view.Button({text:d.CancelUpload,className:"cancel-upload",click:function(){e.trigger("cancel-upload"),e.close()}}),this._pages=new Backbone.Collection,this._uploadPages=new Backbone.Collection,this.listenTo(this._pages,"change:selected",function(e){this._uploadBtn.$el.prop("disabled",0===this._pages.where({selected:!0}).length)}),this.createTitle(),this.createButtons(),this.on("escape",function(){e.trigger("cancel-upload")}),this},escape:function(){return console.log(this),this.trigger("cancel-upload"),wp.media.view.MediaFrame.prototype.escape.apply(this,arguments)},createTitle:function(){this._title=new wp.media.View({tagName:"h1"}),this._title.$el.text(this.options.title),this.title.set([this._title])},createButtons:function(){this.actionBtn=[],this.actionBtn.push(this._cancelBtn),t&&this.actionBtn.push(this._skipBtn),this.actionBtn.push(this._uploadBtn),this.buttons.set(this.actionBtn)},setFile:function(e){var t=this,i=new FileReader;return this.file=e,i.onload=function(e){t.parsePDF(e.target.result)},i.readAsArrayBuffer(e.blob),this},clickPage:function(e){this.showPage(p(e.target).attr("data-page"))},renderPageNav:function(e){console.log();for(var t,i=this,a=1,n=[];this._pages.length;)this._pages.pop();for(;a<=e;a++)t=new Backbone.Model({id:a,selected:!0}),this._pages.add(t),n.push(new o({pagenum:a,selected:!0,model:t,events:{'change [type="radio"]':function(){this.$('[type="radio"]').prop("checked")&&i.showPage(this.options.pagenum)},'change [type="checkbox"]':function(){this.model.set("selected",this.$('[type="checkbox"]').prop("checked"))}}}));this.pagenav.set(n)},parsePDF:function(e){var t=this;pdfjsLib.getDocument(e).then(function(e){t._pdf=e,t.renderPageNav(e.numPages),t.showPage(1)})},showPage:function(e){var t=this,i=this._pages.get(e);i.get("canvas")?this.content.set([new wp.media.View({el:i.get("canvas")})]):(this.content.set([new Backbone.View]),this.renderPage(e,function(){t.showPage(e)}))},renderPage:function(e,n,o){var s=this._pages.get(e);this._pdf.getPage(e).then(function(e){var t=e.getViewport(1),i=p("<canvas></canvas>").get(0),a=i.getContext("2d");t=e.getViewport(l.options.image_width/t.width),i.width=t.width,i.height=t.height,e.render({canvasContext:a,viewport:t}).then(function(){s.set("page",e),s.set("canvas",i),n&&n.apply(s,o||[])})})},uploadImages:function(){var a=this,n="image/png",o=function(e){var t=new s.Image,i=this;t.onload=function(){t.name=e,t.type=n,t._fromPDF=!0,a.options.uploader.addFile(t.getAsBlob(),e),a._pages.remove(i.id),i.set("image",t),a._uploadPages.add(i),a._uploadPages.length===a._pages.where({selected:!0}).length&&(a.trigger("complete"),a.close())},t.load(this.get("canvas").toDataURL(n)),p("body").append(t)};_.each(this.actionBtn,function(e){e.$el.prop("disabled",!0)}),_.each(this._pages.where({selected:!0}),function(e,t){var i=a.file.file.name.replace(/\.[a-z0-9]+$/,"")+"-p"+t+".png";e.get("canvas")?(o.apply(e,[i]),console.log("direct:",e.get("id"))):(a.renderPage(e.get("id"),o,[i]),console.log("render:",e.get("id")))})}}),_.extend(wp.media.view.UploaderWindow.prototype,{_parentReady:wp.media.view.UploaderWindow.prototype.ready,didReady:!1,ready:function(){var n;if(this.didReady)return this._parentReady.apply(this,arguments);return this.didReady=!0,ret=this._parentReady.apply(this,arguments),this.uploader.uploader.bind("BeforeUpload",function(e,t){var i,a;console.log("BEFORE UPLOAD"),"application/pdf"==t.type&&(fileData=((a={file:i=t,blob:i.getNative()}).blob||(a.blob=i.getSource()),a),fileData.blob instanceof Blob&&(e.stop(),e.refresh(),function(e,t){n&&n.close().dispose(),(n=new c.view.PDFFrame({controller:p(this),uploader:e,title:d.Upload+": "+t.file.name.replace(/\.[a-z0-9]+$/,"")})).on("cancel-upload",function(){e.removeFile(t.file),t.file.attachment.destroy()}).on("continue-upload",function(){e.start()}),n.setFile(t),n.open()}(e,fileData)))}),ret}})}(jQuery,pdf_renderer,mOxie);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lZGlhLmpzIl0sIm5hbWVzIjpbIiQiLCJvcHRzIiwibyIsIlBhZ2VJdGVtIiwicGRmUmVuZGVyZXIiLCJ2aWV3IiwibDEwbiIsInBkZkFsbG93ZWQiLCJfd3BQbHVwbG9hZFNldHRpbmdzIiwiZGVmYXVsdHMiLCJmaWx0ZXJzIiwibWltZV90eXBlcyIsImV4dGVuc2lvbnMiLCJzcGxpdCIsImluZGV4T2YiLCJ3cCIsIm1lZGlhIiwiVmlldyIsImV4dGVuZCIsInRlbXBsYXRlIiwiY2xhc3NOYW1lIiwiaW5pdGlhbGl6ZSIsInByb3RvdHlwZSIsImFwcGx5IiwidGhpcyIsImFyZ3VtZW50cyIsInJlbmRlciIsIlBERkZyYW1lIiwiTWVkaWFGcmFtZSIsInJlZ2lvbnMiLCJldmVudHMiLCJjbGljayBbZGF0YS1wYWdlXSIsImNsaWNrIC5tZWRpYS1tb2RhbC1jbG9zZSIsInRyaWdnZXIiLCJjbG9zZSIsInNlbGYiLCJfIiwib3B0aW9ucyIsInVwbG9hZGVyIiwidGl0bGUiLCJwZGZVcGxvYWQiLCJfcGRmIiwiX2NhbnZhcyIsIl9jdXJyZW50X3BhZ2UiLCJfdXBsb2FkQnRuIiwiQnV0dG9uIiwidGV4dCIsIlVwbG9hZEltYWdlcyIsImNsaWNrIiwidXBsb2FkSW1hZ2VzIiwiX3NraXBCdG4iLCJVcGxvYWRQREYiLCJfY2FuY2VsQnRuIiwiQ2FuY2VsVXBsb2FkIiwiX3BhZ2VzIiwiQmFja2JvbmUiLCJDb2xsZWN0aW9uIiwiX3VwbG9hZFBhZ2VzIiwibGlzdGVuVG8iLCJlIiwiJGVsIiwicHJvcCIsIndoZXJlIiwic2VsZWN0ZWQiLCJsZW5ndGgiLCJjcmVhdGVUaXRsZSIsImNyZWF0ZUJ1dHRvbnMiLCJvbiIsImVzY2FwZSIsImNvbnNvbGUiLCJsb2ciLCJfdGl0bGUiLCJ0YWdOYW1lIiwic2V0IiwiYWN0aW9uQnRuIiwicHVzaCIsImJ1dHRvbnMiLCJzZXRGaWxlIiwiZmlsZSIsImZpbGVSZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkIiwiZXZlbnQiLCJwYXJzZVBERiIsInRhcmdldCIsInJlc3VsdCIsInJlYWRBc0FycmF5QnVmZmVyIiwiYmxvYiIsImNsaWNrUGFnZSIsInNob3dQYWdlIiwiYXR0ciIsInJlbmRlclBhZ2VOYXYiLCJudW1QYWdlcyIsIm0iLCJpIiwiYnRucyIsInBvcCIsIk1vZGVsIiwiaWQiLCJhZGQiLCJwYWdlbnVtIiwibW9kZWwiLCJjaGFuZ2UgW3R5cGU9XCJyYWRpb1wiXSIsImNoYW5nZSBbdHlwZT1cImNoZWNrYm94XCJdIiwicGFnZW5hdiIsImFyciIsInBkZmpzTGliIiwiZ2V0RG9jdW1lbnQiLCJ0aGVuIiwicGRmIiwiaWR4IiwiZ2V0IiwiY29udGVudCIsImVsIiwicmVuZGVyUGFnZSIsImNiIiwiY2JfYXJncyIsImdldFBhZ2UiLCJwYWdlIiwidnAiLCJnZXRWaWV3cG9ydCIsImNhbnZhcyIsImN0eCIsImdldENvbnRleHQiLCJpbWFnZV93aWR0aCIsIndpZHRoIiwiaGVpZ2h0IiwiY2FudmFzQ29udGV4dCIsInZpZXdwb3J0IiwidHlwZSIsInVwbG9hZCIsIm5hbWUiLCJpbWciLCJJbWFnZSIsIl9mcm9tUERGIiwiYWRkRmlsZSIsImdldEFzQmxvYiIsInJlbW92ZSIsImxvYWQiLCJ0b0RhdGFVUkwiLCJhcHBlbmQiLCJlYWNoIiwiYnRuIiwicGciLCJyZXBsYWNlIiwiVXBsb2FkZXJXaW5kb3ciLCJfcGFyZW50UmVhZHkiLCJyZWFkeSIsImRpZFJlYWR5IiwicGRmTW9kYWwiLCJyZXQiLCJiaW5kIiwidXAiLCJfcmV0IiwiZmlsZURhdGEiLCJnZXROYXRpdmUiLCJnZXRTb3VyY2UiLCJCbG9iIiwic3RvcCIsInJlZnJlc2giLCJmaWxlSXRlbSIsImRpc3Bvc2UiLCJjb250cm9sbGVyIiwiVXBsb2FkIiwicmVtb3ZlRmlsZSIsImF0dGFjaG1lbnQiLCJkZXN0cm95Iiwic3RhcnQiLCJvcGVuIiwicGRmUG9wdXAiLCJqUXVlcnkiLCJwZGZfcmVuZGVyZXIiLCJtT3hpZSJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBV0Es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U0FDVCxPQUFPNUgsS0FBSzBILGFBQWEzSCxNQUFPQyxLQUFPQyxXQTZEeEMsT0EzREFELEtBQUs0SCxVQUFXLEVBRWhCRSxJQUFNOUgsS0FBSzBILGFBQWEzSCxNQUFPQyxLQUFPQyxXQTBDdENELEtBQUtjLFNBQVNBLFNBQVNpSCxLQUFLLGVBQWUsU0FBVUMsRUFBSTFFLEdBWnpELElBQXNCQSxFQUNqQjJFLEVBWUpwRixRQUFRQyxJQUFJLGlCQUNNLG1CQUFiUSxFQUFLbUQsT0FFVHlCLFdBZkdELEVBQU8sQ0FDVjNFLEtBRm9CQSxFQWdCSUEsRUFieEJTLEtBQUtULEVBQUs2RSxjQUVDcEUsT0FDWGtFLEVBQUtsRSxLQUFPVCxFQUFLOEUsYUFFWEgsR0FTREMsU0FBU25FLGdCQUFnQnNFLE9BQzdCTCxFQUFHTSxPQUNITixFQUFHTyxVQS9DTixTQUFtQnpILEVBQVUwSCxHQUV2QlgsR0FDSkEsRUFBU25ILFFBQVErSCxXQUdsQlosRUFBVyxJQUFJakosRUFBWUMsS0FBS3NCLFNBQVUsQ0FDekN1SSxXQUFZbEssRUFBRXdCLE1BQ2RjLFNBQVNBLEVBQ1RDLE1BQU9qQyxFQUFLNkosT0FBUyxLQUFPSCxFQUFTbEYsS0FBS3FELEtBQUthLFFBQVEsZUFBZSxPQUU5RDdFLEdBQUcsZ0JBQWdCLFdBRTNCN0IsRUFBUzhILFdBQVlKLEVBQVNsRixNQUM5QmtGLEVBQVNsRixLQUFLdUYsV0FBV0MsWUFFdkJuRyxHQUFHLGtCQUFrQixXQUV2QjdCLEVBQVNpSSxVQUdWbEIsRUFBU3hFLFFBQVNtRixHQUNsQlgsRUFBU21CLE9BMEJQQyxDQUFVakIsRUFBSUUsY0FPVkosT0F4V1YsQ0E0V0lvQixPQUFRQyxhQUFjQyIsImZpbGUiOiJhZG1pbi9tZWRpYS5kZXYuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oICQsIG9wdHMsIG8gKSB7XG5cblx0dmFyIHBkZlJlbmRlcmVyID0ge1xuXHRcdFx0dmlldzoge31cblx0XHR9LFxuXHRcdGwxMG4gPSBvcHRzLmwxMG4sXG5cdFx0aW1hZ2VJbmZvcyA9IHt9LFxuXHRcdFBhZ2VJdGVtLFxuXHRcdHBkZkFsbG93ZWQgPSBfd3BQbHVwbG9hZFNldHRpbmdzLmRlZmF1bHRzLmZpbHRlcnMubWltZV90eXBlc1swXS5leHRlbnNpb25zLnNwbGl0KCcsJykuaW5kZXhPZigncGRmJykgIT09IC0xO1xuXG5cdC8vIHRlbXBvcmFpbHkgYWRkIHBkZiB0eXBlIHRvIHBsdXBsb2FkIHNldHRpbmdzLFxuXHQvLyBzbyB0aGUgdXBsb2FkZXIgZG9lc24ndCBjYW5jZWwgdG9vIGVhcmx5LlxuXHQvLyBGaWxlIHR5cGVzIGFyZSBjaGVja2VkIHNlcnZlci1zaWRlIHRvbywgc29cblx0Ly8gdGhlcmUgc2hvdWxkIGJlIG5vIHNlY3VyaXR5IGltcGxpY2F0aW9ucy5cblx0aWYgKCAhIHBkZkFsbG93ZWQgKSB7XG5cdFx0X3dwUGx1cGxvYWRTZXR0aW5ncy5kZWZhdWx0cy5maWx0ZXJzLm1pbWVfdHlwZXNbMF0uZXh0ZW5zaW9ucyArPSAnLHBkZic7XG5cdH1cblxuXHRQYWdlSXRlbSA9IHdwLm1lZGlhLlZpZXcuZXh0ZW5kKHtcblx0XHR0ZW1wbGF0ZTogIHdwLnRlbXBsYXRlKCdwZGYtcGFnZS1pdGVtJyksXG5cdFx0Y2xhc3NOYW1lOidwZGYtcGFnZS1pdGVtJyxcblx0XHRpbml0aWFsaXplOmZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHdwLm1lZGlhLlZpZXcucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXHRcdH0sXG5cdFx0cmVuZGVyOmZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHdwLm1lZGlhLlZpZXcucHJvdG90eXBlLnJlbmRlci5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0fVxuXHR9KTtcblxuXHRwZGZSZW5kZXJlci52aWV3LlBERkZyYW1lID0gd3AubWVkaWEudmlldy5NZWRpYUZyYW1lLmV4dGVuZCh7XG5cdFx0dGVtcGxhdGU6IHdwLnRlbXBsYXRlKCdwZGYtbW9kYWwnKSxcblx0XHRyZWdpb25zOiBbICd0aXRsZScsJ2NvbnRlbnQnLCdpbnN0cnVjdGlvbnMnLCdidXR0b25zJywgJ3BhZ2VuYXYnIF0sXG5cdFx0ZXZlbnRzOiB7XG5cdFx0XHQnY2xpY2sgW2RhdGEtcGFnZV0nIDogJ2NsaWNrUGFnZScsXG5cdFx0XHQnY2xpY2sgLm1lZGlhLW1vZGFsLWNsb3NlJyA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0aGlzLnRyaWdnZXIoJ2NhbmNlbC11cGxvYWQnKTtcblx0XHRcdFx0dGhpcy5jbG9zZSgpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0Xy5kZWZhdWx0cyggdGhpcy5vcHRpb25zLCB7XG5cdFx0XHRcdHVwbG9hZGVyOlx0ZmFsc2UsXG5cdFx0XHRcdHRpdGxlOlx0XHRsMTBuLnBkZlVwbG9hZCxcblx0XHRcdH0pO1xuXG5cdFx0XHR3cC5tZWRpYS52aWV3Lk1lZGlhRnJhbWUucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXG5cdFx0XHR0aGlzLl9wZGYgPSB0aGlzLl9jYW52YXMgPSBudWxsO1xuXHRcdFx0dGhpcy5fY3VycmVudF9wYWdlID0gMDtcblxuXHRcdFx0dGhpcy5fdXBsb2FkQnRuID0gbmV3IHdwLm1lZGlhLnZpZXcuQnV0dG9uKHtcblx0XHRcdFx0dGV4dDogbDEwbi5VcGxvYWRJbWFnZXMsXG5cdFx0XHRcdGNsYXNzTmFtZTogJ2J1dHRvbi1wcmltYXJ5Jyxcblx0XHRcdFx0Y2xpY2s6ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0c2VsZi50cmlnZ2VyKCdjYW5jZWwtdXBsb2FkJyk7XG5cdFx0XHRcdFx0c2VsZi51cGxvYWRJbWFnZXMoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRpZiAoIHBkZkFsbG93ZWQgKSB7XG5cdFx0XHRcdHRoaXMuX3NraXBCdG4gPSBuZXcgd3AubWVkaWEudmlldy5CdXR0b24oe1xuXHRcdFx0XHRcdHRleHQ6IGwxMG4uVXBsb2FkUERGLFxuXHRcdFx0XHRcdGNsYXNzTmFtZTogJ3VwbG9hZC1wZGYnLFxuXHRcdFx0XHRcdGNsaWNrOmZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0c2VsZi50cmlnZ2VyKCdjb250aW51ZS11cGxvYWQnKTtcblx0XHRcdFx0XHRcdHNlbGYuY2xvc2UoKTtcblx0XHRcdFx0XHRcdC8vIGRpc21pc3MsIGNvbnRpbnVlIHdpdGggd3AgZGVmYXVsdCBiZWhhdmlvdXJcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5fY2FuY2VsQnRuID0gbmV3IHdwLm1lZGlhLnZpZXcuQnV0dG9uKHtcblx0XHRcdFx0dGV4dDogbDEwbi5DYW5jZWxVcGxvYWQsXG5cdFx0XHRcdGNsYXNzTmFtZTogJ2NhbmNlbC11cGxvYWQnLFxuXHRcdFx0XHRjbGljazpmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRzZWxmLnRyaWdnZXIoJ2NhbmNlbC11cGxvYWQnKTtcblx0XHRcdFx0XHRzZWxmLmNsb3NlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLl9wYWdlcyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCk7XG5cdFx0XHR0aGlzLl91cGxvYWRQYWdlcyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCk7XG5cdFx0XHR0aGlzLmxpc3RlblRvKHRoaXMuX3BhZ2VzLCdjaGFuZ2U6c2VsZWN0ZWQnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHQvLyBkaXNhYmxlIGltZyB1cGxvYWQgYnRuIGlmIG5vIHBhZ2VzIHNlbGVjdGVkXG5cdFx0XHRcdHRoaXMuX3VwbG9hZEJ0bi4kZWwucHJvcCgnZGlzYWJsZWQnLCB0aGlzLl9wYWdlcy53aGVyZSh7c2VsZWN0ZWQ6dHJ1ZX0pLmxlbmd0aCA9PT0gMCApXG5cdFx0XHR9KVxuXG5cdFx0XHR0aGlzLmNyZWF0ZVRpdGxlKCk7XG5cdFx0XHR0aGlzLmNyZWF0ZUJ1dHRvbnMoKTtcblxuXHRcdFx0dGhpcy5vbignZXNjYXBlJyxmdW5jdGlvbigpe1xuXHRcdFx0XHRzZWxmLnRyaWdnZXIoJ2NhbmNlbC11cGxvYWQnKTtcblx0XHRcdH0pXG5cblx0XHRcdHJldHVybiB0aGlzO1xuXG5cdFx0fSxcblx0XHRlc2NhcGU6ZnVuY3Rpb24oKSB7XG5cdFx0XHRjb25zb2xlLmxvZyh0aGlzKTtcblx0XHRcdHRoaXMudHJpZ2dlcignY2FuY2VsLXVwbG9hZCcpO1xuXHRcdFx0cmV0dXJuIHdwLm1lZGlhLnZpZXcuTWVkaWFGcmFtZS5wcm90b3R5cGUuZXNjYXBlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcblx0XHR9LFxuXHRcdGNyZWF0ZVRpdGxlOiBmdW5jdGlvbiggKSB7XG5cdFx0XHR0aGlzLl90aXRsZSA9IG5ldyB3cC5tZWRpYS5WaWV3KHtcblx0XHRcdFx0dGFnTmFtZTogJ2gxJ1xuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLl90aXRsZS4kZWwudGV4dCggdGhpcy5vcHRpb25zLnRpdGxlICk7XG5cdFx0XHR0aGlzLnRpdGxlLnNldCggWyB0aGlzLl90aXRsZSBdICk7XG5cdFx0fSxcblx0XHRjcmVhdGVCdXR0b25zOiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMuYWN0aW9uQnRuID0gW107XG5cblx0XHRcdHRoaXMuYWN0aW9uQnRuLnB1c2goIHRoaXMuX2NhbmNlbEJ0biApO1xuXHRcdFx0aWYgKCBwZGZBbGxvd2VkICkge1xuXHRcdFx0XHR0aGlzLmFjdGlvbkJ0bi5wdXNoKCB0aGlzLl9za2lwQnRuICk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLmFjdGlvbkJ0bi5wdXNoKCB0aGlzLl91cGxvYWRCdG4gKTtcblxuXHRcdFx0dGhpcy5idXR0b25zLnNldCggdGhpcy5hY3Rpb25CdG4gKTtcblxuXHRcdH0sXG5cdFx0c2V0RmlsZTpmdW5jdGlvbiggZmlsZSApIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0ZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cdFx0XHR0aGlzLmZpbGUgPSBmaWxlO1xuXHRcdFx0ZmlsZVJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbihldmVudCkge1xuLy9cdFx0XHQgICAgYXJyYXlCdWZmZXIgPSBldmVudC50YXJnZXQucmVzdWx0O1xuXHRcdFx0XHRzZWxmLnBhcnNlUERGKCBldmVudC50YXJnZXQucmVzdWx0ICk7XG5cdFx0XHR9O1xuXHRcdFx0ZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlciggZmlsZS5ibG9iICk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGNsaWNrUGFnZTpmdW5jdGlvbihlKSB7XG5cdFx0XHR0aGlzLnNob3dQYWdlKCQoZS50YXJnZXQpLmF0dHIoJ2RhdGEtcGFnZScpKTtcblx0XHR9LFxuXHRcdHJlbmRlclBhZ2VOYXY6ZnVuY3Rpb24obnVtUGFnZXMpIHtcblx0XHRcdGNvbnNvbGUubG9nKClcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0aSA9IDEsIGJ0bnMgPSBbXSwgbTtcblxuXHRcdFx0d2hpbGUgKCB0aGlzLl9wYWdlcy5sZW5ndGggKSB7XG5cdFx0XHRcdHRoaXMuX3BhZ2VzLnBvcCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKGk7aTw9bnVtUGFnZXM7aSsrKSB7XG5cdFx0XHRcdG0gPSBuZXcgQmFja2JvbmUuTW9kZWwoe1xuXHRcdFx0XHRcdGlkOmksXG5cdFx0XHRcdFx0c2VsZWN0ZWQ6dHJ1ZSxcblx0XHRcdFx0fSk7XG5cdFx0XHRcdHRoaXMuX3BhZ2VzLmFkZCggbSApO1xuXG5cdFx0XHRcdGJ0bnMucHVzaChcblx0XHRcdFx0XHRuZXcgUGFnZUl0ZW0oe1xuXHRcdFx0XHRcdFx0cGFnZW51bTppLFxuXHRcdFx0XHRcdFx0c2VsZWN0ZWQ6dHJ1ZSxcblx0XHRcdFx0XHRcdG1vZGVsOm0sXG5cdFx0XHRcdFx0XHRldmVudHM6e1xuXHRcdFx0XHRcdFx0XHQnY2hhbmdlIFt0eXBlPVwicmFkaW9cIl0nIDogZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdFx0XHRpZiAoIHRoaXMuJCgnW3R5cGU9XCJyYWRpb1wiXScpLnByb3AoJ2NoZWNrZWQnKSApIHtcblx0XHRcdFx0XHRcdFx0XHRcdHNlbGYuc2hvd1BhZ2UoIHRoaXMub3B0aW9ucy5wYWdlbnVtICk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0XHQnY2hhbmdlIFt0eXBlPVwiY2hlY2tib3hcIl0nIDogZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdFx0XHR0aGlzLm1vZGVsLnNldCggJ3NlbGVjdGVkJywgdGhpcy4kKCdbdHlwZT1cImNoZWNrYm94XCJdJykucHJvcCgnY2hlY2tlZCcpICk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KVxuXHRcdFx0XHQpO1xuXG5cdFx0XHR9XG5cdFx0XHR0aGlzLnBhZ2VuYXYuc2V0KCBidG5zICk7XG5cdFx0fSxcblx0XHRwYXJzZVBERjpmdW5jdGlvbiggYXJyICkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0cGRmanNMaWIuZ2V0RG9jdW1lbnQoYXJyKS50aGVuKGZ1bmN0aW9uKHBkZikge1xuXHRcdFx0XHQvLyBidWlsZCBwYWdlcyBzZWxlY3RvclxuXHRcdFx0XHRzZWxmLl9wZGYgPSBwZGY7XG5cdFx0XHRcdHNlbGYucmVuZGVyUGFnZU5hdihwZGYubnVtUGFnZXMpXG5cblx0XHRcdFx0c2VsZi5zaG93UGFnZSgxKTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cdFx0c2hvd1BhZ2U6ZnVuY3Rpb24oaWR4KSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdG0gPSB0aGlzLl9wYWdlcy5nZXQoaWR4KTtcblxuXHRcdFx0aWYgKCAhISBtLmdldCgnY2FudmFzJykgKSB7XG5cdFx0XHRcdHRoaXMuY29udGVudC5zZXQoIFtcblx0XHRcdFx0XHRuZXcgd3AubWVkaWEuVmlldyh7XG5cdFx0XHRcdFx0XHRlbDogbS5nZXQoJ2NhbnZhcycpLFxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdF0gKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuY29udGVudC5zZXQoW25ldyBCYWNrYm9uZS5WaWV3KCldKVxuXHRcdFx0XHR0aGlzLnJlbmRlclBhZ2UoIGlkeCwgZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRzZWxmLnNob3dQYWdlKGlkeCk7XG5cdFx0XHRcdH0gKTtcblx0XHRcdH1cblxuXHRcdH0sXG5cdFx0cmVuZGVyUGFnZTpmdW5jdGlvbihpZHgsY2IsY2JfYXJncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRtID0gdGhpcy5fcGFnZXMuZ2V0KGlkeCk7XG5cblx0XHRcdHNlbGYuX3BkZi5nZXRQYWdlKGlkeCkudGhlbihmdW5jdGlvbihwYWdlKXtcblx0XHRcdFx0dmFyIHZwID0gcGFnZS5nZXRWaWV3cG9ydCgxKSxcblx0XHRcdFx0XHRjYW52YXMgPSAkKCc8Y2FudmFzPjwvY2FudmFzPicpLmdldCgwKSxcblx0XHRcdFx0XHRjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuXHRcdFx0XHR2cCA9IHBhZ2UuZ2V0Vmlld3BvcnQoIG9wdHMub3B0aW9ucy5pbWFnZV93aWR0aCAvIHZwLndpZHRoICk7XG5cblx0XHRcdFx0Y2FudmFzLndpZHRoID0gdnAud2lkdGg7XG5cdFx0XHRcdGNhbnZhcy5oZWlnaHQgPSB2cC5oZWlnaHQ7XG5cblx0XHRcdFx0cGFnZS5yZW5kZXIoe1xuXHRcdFx0XHRcdGNhbnZhc0NvbnRleHQ6IGN0eCxcblx0XHRcdFx0XHR2aWV3cG9ydDogdnAsXG5cdFx0XHRcdH0pLnRoZW4oZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRtLnNldCggJ3BhZ2UnLCBwYWdlICk7XG5cdFx0XHRcdFx0bS5zZXQoICdjYW52YXMnLCBjYW52YXMgKTtcblxuXHRcdFx0XHRcdCEhY2IgJiYgY2IuYXBwbHkobSxjYl9hcmdzfHxbXSk7XG4vL1x0XHRcdFx0XHRzZWxmLnNob3dQYWdlKGlkeCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXG5cdFx0dXBsb2FkSW1hZ2VzOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHR0eXBlID0gJ2ltYWdlL3BuZycsXG5cdFx0XHRcdHVwbG9hZCA9IGZ1bmN0aW9uKCBuYW1lICkge1xuXHRcdFx0XHRcdC8qXG5cdFx0XHRcdFx0dGhpcy5jYW52YXMudG9CbG9iKGZ1bmN0aW9uKGJsb2Ipe1xuXHRcdFx0XHRcdFx0YmxvYi5uYW1lID0gbmFtZTtcblx0XHRcdFx0XHRcdGJsb2IudHlwZSA9IHR5cGU7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhibG9iLm5hbWUpXG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhzZWxmLm9wdGlvbnMudXBsb2FkZXIsYmxvYilcblx0XHRcdFx0XHRcdHNlbGYub3B0aW9ucy51cGxvYWRlci5hZGRGaWxlKCBibG9iLCBuYW1lICk7XG5cdFx0XHRcdFx0fSx0eXBlKTtcblx0XHRcdFx0XHQvKi9cblx0XHRcdFx0XHR2YXIgaW1nID0gbmV3IG8uSW1hZ2UoKSxcblx0XHRcdFx0XHRcdG0gPSB0aGlzO1xuXHRcdFx0XHRcdGltZy5vbmxvYWQgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGltZy5uYW1lID0gbmFtZTtcblx0XHRcdFx0XHRcdGltZy50eXBlID0gdHlwZTtcblx0XHRcdFx0XHRcdGltZy5fZnJvbVBERiA9IHRydWU7XG5cdFx0XHRcdFx0XHRzZWxmLm9wdGlvbnMudXBsb2FkZXIuYWRkRmlsZSggaW1nLmdldEFzQmxvYigpLCBuYW1lICk7XG5cblx0XHRcdFx0XHRcdHNlbGYuX3BhZ2VzLnJlbW92ZShtLmlkKTtcblx0XHRcdFx0XHRcdG0uc2V0KCAnaW1hZ2UnLCBpbWcgKTtcblx0XHRcdFx0XHRcdHNlbGYuX3VwbG9hZFBhZ2VzLmFkZChtKTtcblx0XHRcdFx0XHRcdGlmICggc2VsZi5fdXBsb2FkUGFnZXMubGVuZ3RoID09PSBzZWxmLl9wYWdlcy53aGVyZSggeyBzZWxlY3RlZDogdHJ1ZSB9ICkubGVuZ3RoICkge1xuXHRcdFx0XHRcdFx0XHQvLyB0cmlnZ2VyIHNvbWV0aGluZ1xuXHRcdFx0XHRcdFx0XHRzZWxmLnRyaWdnZXIoJ2NvbXBsZXRlJyk7XG5cdFx0XHRcdFx0XHRcdHNlbGYuY2xvc2UoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpbWcubG9hZCggdGhpcy5nZXQoJ2NhbnZhcycpLnRvRGF0YVVSTCh0eXBlKSApO1xuXHRcdFx0XHRcdC8vXG5cdFx0XHRcdFx0JCgnYm9keScpLmFwcGVuZChpbWcpO1xuXHRcdFx0XHR9O1xuXHRcdFx0Xy5lYWNoKCB0aGlzLmFjdGlvbkJ0biwgZnVuY3Rpb24oYnRuKXtcblx0XHRcdFx0YnRuLiRlbC5wcm9wKCdkaXNhYmxlZCcsdHJ1ZSk7XG5cdFx0XHR9ICk7XG5cdFx0XHQvLyBjcmVhdGUgZSBuZXcgbWVkaWEgbW9kZWwgZnJvbSBibG9iIGRhdGEgVVJMIHRoaW5neVxuXG5cdFx0XHRfLmVhY2goIHRoaXMuX3BhZ2VzLndoZXJlKCB7IHNlbGVjdGVkOiB0cnVlIH0gKSwgZnVuY3Rpb24oIHBnLCBpICl7XG5cblx0XHRcdFx0dmFyIG5hbWUgPSBzZWxmLmZpbGUuZmlsZS5uYW1lLnJlcGxhY2UoL1xcLlthLXowLTldKyQvLCcnKSArICctcCcgKyBpICsgJy5wbmcnO1xuXG5cdFx0XHRcdGlmICggISBwZy5nZXQoJ2NhbnZhcycpICkge1xuXHRcdFx0XHRcdC8vIG5lZWRzIHJlbmRlcmluZ1xuXHRcdFx0XHRcdHNlbGYucmVuZGVyUGFnZSggcGcuZ2V0KCdpZCcpLCB1cGxvYWQsW25hbWVdKTtcblx0XHRcdFx0XHRjb25zb2xlLmxvZygncmVuZGVyOicscGcuZ2V0KCdpZCcpKVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHVwbG9hZC5hcHBseShwZyxbbmFtZV0pXG5cdFx0XHRcdFx0Y29uc29sZS5sb2coJ2RpcmVjdDonLHBnLmdldCgnaWQnKSlcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblxuXHRcdFx0Ly9cblx0XHR9XG5cdH0pO1xuXG5cblx0Xy5leHRlbmQoIHdwLm1lZGlhLnZpZXcuVXBsb2FkZXJXaW5kb3cucHJvdG90eXBlLCB7XG5cdFx0X3BhcmVudFJlYWR5OiB3cC5tZWRpYS52aWV3LlVwbG9hZGVyV2luZG93LnByb3RvdHlwZS5yZWFkeSxcblx0XHRkaWRSZWFkeTpmYWxzZSxcblxuXHRcdHJlYWR5OmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHBkZnMgPSBbXSxcblx0XHRcdFx0cGRmTW9kYWwsIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHQvLyBwcmV2ZW50IGRvdWJsZSBpbml0XG5cdFx0XHRpZiAoIHRoaXMuZGlkUmVhZHkgKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnRSZWFkeS5hcHBseSggdGhpcyAsIGFyZ3VtZW50cyApO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5kaWRSZWFkeSA9IHRydWU7XG5cblx0XHRcdHJldCA9IHRoaXMuX3BhcmVudFJlYWR5LmFwcGx5KCB0aGlzICwgYXJndW1lbnRzICk7XG5cblx0XHRcdGZ1bmN0aW9uIHBkZlBvcHVwKCB1cGxvYWRlciwgZmlsZUl0ZW0gKSB7XG5cblx0XHRcdFx0aWYgKCBwZGZNb2RhbCApIHtcblx0XHRcdFx0XHRwZGZNb2RhbC5jbG9zZSgpLmRpc3Bvc2UoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHBkZk1vZGFsID0gbmV3IHBkZlJlbmRlcmVyLnZpZXcuUERGRnJhbWUoIHtcblx0XHRcdFx0XHRjb250cm9sbGVyOiAkKHRoaXMpLFxuXHRcdFx0XHRcdHVwbG9hZGVyOnVwbG9hZGVyLFxuXHRcdFx0XHRcdHRpdGxlOiBsMTBuLlVwbG9hZCArICc6ICcgKyBmaWxlSXRlbS5maWxlLm5hbWUucmVwbGFjZSgvXFwuW2EtejAtOV0rJC8sJycpLFxuXHRcdFx0XHR9ICk7XG5cdFx0XHRcdHBkZk1vZGFsLm9uKCdjYW5jZWwtdXBsb2FkJyxmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQvLyBzdG9wIGVjZXJ5dGhpbmchXG5cdFx0XHRcdFx0dXBsb2FkZXIucmVtb3ZlRmlsZSggZmlsZUl0ZW0uZmlsZSApO1xuXHRcdFx0XHRcdGZpbGVJdGVtLmZpbGUuYXR0YWNobWVudC5kZXN0cm95KCk7XG5cblx0XHRcdFx0fSkub24oJ2NvbnRpbnVlLXVwbG9hZCcsZnVuY3Rpb24oKXtcblx0XHRcdFx0XHQvLyBnbyBhaGVhZCB3aXRoIGEgbm9ybWFsIFdQIHVwbG9hZC4uXG5cdFx0XHRcdFx0dXBsb2FkZXIuc3RhcnQoKTtcblxuXHRcdFx0XHR9KTtcblx0XHRcdFx0cGRmTW9kYWwuc2V0RmlsZSggZmlsZUl0ZW0gKTtcblx0XHRcdFx0cGRmTW9kYWwub3BlbigpO1xuXHRcdFx0fVxuXG5cdFx0XHQvKipcblx0XHRcdCAqXHRAcmV0dXJuIG5hdGl2ZSBmaWxlIG9iamVjdCBvciBibG9iXG5cdFx0XHQgKi9cblx0XHRcdGZ1bmN0aW9uIHJlc29sdmVGaWxlKCBmaWxlICkge1xuXHRcdFx0XHR2YXIgX3JldCA9IHtcblx0XHRcdFx0XHRmaWxlOiBmaWxlLFxuXHRcdFx0XHRcdGJsb2I6ZmlsZS5nZXROYXRpdmUoKVxuXHRcdFx0XHR9LCBfcmV0MiwgYnl0ZXMsIGk7XG5cdFx0XHRcdGlmICggISBfcmV0LmJsb2IgKSB7XG5cdFx0XHRcdFx0X3JldC5ibG9iID0gZmlsZS5nZXRTb3VyY2UoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gX3JldDtcblx0XHRcdH1cblxuXHRcdFx0Ly8gc2VuZCBjcm9wZGF0YVxuXHRcdFx0dGhpcy51cGxvYWRlci51cGxvYWRlci5iaW5kKCdCZWZvcmVVcGxvYWQnLGZ1bmN0aW9uKCB1cCwgZmlsZSApIHtcblx0XHRcdFx0Y29uc29sZS5sb2coJ0JFRk9SRSBVUExPQUQnKVxuXHRcdFx0XHRpZiAoIGZpbGUudHlwZSA9PSAnYXBwbGljYXRpb24vcGRmJykge1xuXG5cdFx0XHRcdFx0ZmlsZURhdGEgPSByZXNvbHZlRmlsZSggZmlsZSApO1xuXHRcdFx0XHRcdGlmICggZmlsZURhdGEuYmxvYiBpbnN0YW5jZW9mIEJsb2IgKSB7XG5cdFx0XHRcdFx0XHR1cC5zdG9wKCk7XG5cdFx0XHRcdFx0XHR1cC5yZWZyZXNoKCk7XG5cdFx0XHRcdFx0XHRwZGZQb3B1cCggdXAsIGZpbGVEYXRhICk7IC8vIHdpbGwgYXNrIGZvciBmb2N1cyBvciBzdGFydCB1cGxvYWRlclxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggcGRmcy5sZW5ndGggKSB7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cdH0pO1xuXG59KSggalF1ZXJ5LCBwZGZfcmVuZGVyZXIsIG1PeGllICk7XG4iXX0=
