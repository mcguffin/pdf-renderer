!function(p,l,s){var o,d={view:{}},c=l.l10n,t=-1!==_wpPluploadSettings.defaults.filters.mime_types[0].extensions.split(",").indexOf("pdf");t||(_wpPluploadSettings.defaults.filters.mime_types[0].extensions+=",pdf"),o=wp.media.View.extend({template:wp.template("pdf-page-item"),className:"pdf-page-item",initialize:function(){return wp.media.View.prototype.initialize.apply(this,arguments)},render:function(){return wp.media.View.prototype.render.apply(this,arguments)}}),d.view.PDFFrame=wp.media.view.MediaFrame.extend({template:wp.template("pdf-modal"),regions:["title","content","instructions","buttons","pagenav"],events:{"click [data-page]":"clickPage","click .media-modal-close":function(){this.trigger("cancel-upload"),this.close()}},initialize:function(){var e=this;return _.defaults(this.options,{uploader:!1,title:c.pdfUpload}),wp.media.view.MediaFrame.prototype.initialize.apply(this,arguments),this._pdf=this._canvas=null,this._current_page=0,this._uploadBtn=new wp.media.view.Button({text:c.UploadImages,className:"button-primary",click:function(){e.trigger("cancel-upload"),e.uploadImages()}}),t&&(this._skipBtn=new wp.media.view.Button({text:c.UploadPDF,className:"upload-pdf",click:function(){e.trigger("continue-upload"),e.close()}})),this._cancelBtn=new wp.media.view.Button({text:c.CancelUpload,className:"cancel-upload",click:function(){e.trigger("cancel-upload"),e.close()}}),this._pages=new Backbone.Collection,this._uploadPages=new Backbone.Collection,this.listenTo(this._pages,"change:selected",function(e){this._uploadBtn.$el.prop("disabled",0===this._pages.where({selected:!0}).length)}),this.createTitle(),this.createButtons(),this.on("escape",function(){e.trigger("cancel-upload")}),this},escape:function(){return this.trigger("cancel-upload"),wp.media.view.MediaFrame.prototype.escape.apply(this,arguments)},createTitle:function(){this._title=new wp.media.View({tagName:"h1"}),this._title.$el.text(this.options.title),this.title.set([this._title])},createButtons:function(){this.actionBtn=[],this.actionBtn.push(this._cancelBtn),t&&this.actionBtn.push(this._skipBtn),this.actionBtn.push(this._uploadBtn),this.buttons.set(this.actionBtn)},setFile:function(e){var t=this,i=new FileReader;return this.file=e,i.onload=function(e){t.parsePDF(e.target.result)},i.readAsArrayBuffer(e.blob),this},clickPage:function(e){this.showPage(p(e.target).attr("data-page"))},renderPageNav:function(e){for(var t,i=this,a=1,n=[];this._pages.length;)this._pages.pop();for(;a<=e;a++)t=new Backbone.Model({id:a,selected:!0}),this._pages.add(t),n.push(new o({pagenum:a,selected:!0,model:t,events:{'change [type="radio"]':function(){this.$('[type="radio"]').prop("checked")&&i.showPage(this.options.pagenum)},'change [type="checkbox"]':function(){this.model.set("selected",this.$('[type="checkbox"]').prop("checked"))}}}));this.pagenav.set(n)},parsePDF:function(e){var t=this;pdfjsLib.getDocument(e).then(function(e){t._pdf=e,t.renderPageNav(e.numPages),t.showPage(1)})},showPage:function(e){var t=this,i=this._pages.get(e);i.get("canvas")?this.content.set([new wp.media.View({el:i.get("canvas")})]):(this.content.set([new Backbone.View]),this.renderPage(e,function(){t.showPage(e)}))},renderPage:function(e,n,o){var s=this._pages.get(e);this._pdf.getPage(e).then(function(e){var t=e.getViewport(1),i=p("<canvas></canvas>").get(0),a=i.getContext("2d");t=e.getViewport(l.options.image_width/t.width),i.width=t.width,i.height=t.height,e.render({canvasContext:a,viewport:t}).then(function(){s.set("page",e),s.set("canvas",i),n&&n.apply(s,o||[])})})},uploadImages:function(){var a=this,n=l.options.image_type,o=function(e){var t=new s.Image,i=this;t.onload=function(){t.name=e,t.type=n,t._fromPDF=!0,a.options.uploader.addFile(t.getAsBlob(),e),a._pages.remove(i.id),i.set("image",t),a._uploadPages.add(i),a._uploadPages.length===a._pages.where({selected:!0}).length&&(a.trigger("complete"),a.close())},t.load(this.get("canvas").toDataURL(l.options.image_type,.01*l.options.jpeg_quality)),p("body").append(t)};_.each(this.actionBtn,function(e){e.$el.prop("disabled",!0)}),_.each(this._pages.where({selected:!0}),function(e,t){var i=a.file.file.name.replace(/\.[a-z0-9]+$/,"")+"-p"+t+".png";e.get("canvas")?o.apply(e,[i]):a.renderPage(e.get("id"),o,[i])})}}),_.extend(wp.media.view.UploaderWindow.prototype,{_parentReady:wp.media.view.UploaderWindow.prototype.ready,didReady:!1,ready:function(){var n;if(this.didReady)return this._parentReady.apply(this,arguments);return this.didReady=!0,ret=this._parentReady.apply(this,arguments),this.uploader.uploader.bind("BeforeUpload",function(e,t){var i,a;"application/pdf"==t.type&&(fileData=((a={file:i=t,blob:i.getNative()}).blob||(a.blob=i.getSource()),a),fileData.blob instanceof Blob&&(e.stop(),e.refresh(),function(e,t){n&&n.close().dispose(),(n=new d.view.PDFFrame({controller:p(this),uploader:e,title:c.Upload+": "+t.file.name.replace(/\.[a-z0-9]+$/,"")})).on("cancel-upload",function(){e.removeFile(t.file),t.file.attachment.destroy()}).on("continue-upload",function(){e.start()}),n.setFile(t),n.open()}(e,fileData)))}),ret}}),_.extend(pdf_renderer,d)}(jQuery,pdf_renderer,mOxie);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lZGlhLmpzIl0sIm5hbWVzIjpbIiQiLCJvcHRzIiwibyIsIlBhZ2VJdGVtIiwicGRmUmVuZGVyZXIiLCJ2aWV3IiwibDEwbiIsInBkZkFsbG93ZWQiLCJfd3BQbHVwbG9hZFNldHRpbmdzIiwiZGVmYXVsdHMiLCJmaWx0ZXJzIiwibWltZV90eXBlcyIsImV4dGVuc2lvbnMiLCJzcGxpdCIsImluZGV4T2YiLCJ3cCIsIm1lZGlhIiwiVmlldyIsImV4dGVuZCIsInRlbXBsYXRlIiwiY2xhc3NOYW1lIiwiaW5pdGlhbGl6ZSIsInByb3RvdHlwZSIsImFwcGx5IiwidGhpcyIsImFyZ3VtZW50cyIsInJlbmRlciIsIlBERkZyYW1lIiwiTWVkaWFGcmFtZSIsInJlZ2lvbnMiLCJldmVudHMiLCJjbGljayBbZGF0YS1wYWdlXSIsImNsaWNrIC5tZWRpYS1tb2RhbC1jbG9zZSIsInRyaWdnZXIiLCJjbG9zZSIsInNlbGYiLCJfIiwib3B0aW9ucyIsInVwbG9hZGVyIiwidGl0bGUiLCJwZGZVcGxvYWQiLCJfcGRmIiwiX2NhbnZhcyIsIl9jdXJyZW50X3BhZ2UiLCJfdXBsb2FkQnRuIiwiQnV0dG9uIiwidGV4dCIsIlVwbG9hZEltYWdlcyIsImNsaWNrIiwidXBsb2FkSW1hZ2VzIiwiX3NraXBCdG4iLCJVcGxvYWRQREYiLCJfY2FuY2VsQnRuIiwiQ2FuY2VsVXBsb2FkIiwiX3BhZ2VzIiwiQmFja2JvbmUiLCJDb2xsZWN0aW9uIiwiX3VwbG9hZFBhZ2VzIiwibGlzdGVuVG8iLCJlIiwiJGVsIiwicHJvcCIsIndoZXJlIiwic2VsZWN0ZWQiLCJsZW5ndGgiLCJjcmVhdGVUaXRsZSIsImNyZWF0ZUJ1dHRvbnMiLCJvbiIsImVzY2FwZSIsIl90aXRsZSIsInRhZ05hbWUiLCJzZXQiLCJhY3Rpb25CdG4iLCJwdXNoIiwiYnV0dG9ucyIsInNldEZpbGUiLCJmaWxlIiwiZmlsZVJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJldmVudCIsInBhcnNlUERGIiwidGFyZ2V0IiwicmVzdWx0IiwicmVhZEFzQXJyYXlCdWZmZXIiLCJibG9iIiwiY2xpY2tQYWdlIiwic2hvd1BhZ2UiLCJhdHRyIiwicmVuZGVyUGFnZU5hdiIsIm51bVBhZ2VzIiwibSIsImkiLCJidG5zIiwicG9wIiwiTW9kZWwiLCJpZCIsImFkZCIsInBhZ2VudW0iLCJtb2RlbCIsImNoYW5nZSBbdHlwZT1cInJhZGlvXCJdIiwiY2hhbmdlIFt0eXBlPVwiY2hlY2tib3hcIl0iLCJwYWdlbmF2IiwiYXJyIiwicGRmanNMaWIiLCJnZXREb2N1bWVudCIsInRoZW4iLCJwZGYiLCJpZHgiLCJnZXQiLCJjb250ZW50IiwiZWwiLCJyZW5kZXJQYWdlIiwiY2IiLCJjYl9hcmdzIiwiZ2V0UGFnZSIsInBhZ2UiLCJ2cCIsImdldFZpZXdwb3J0IiwiY2FudmFzIiwiY3R4IiwiZ2V0Q29udGV4dCIsImltYWdlX3dpZHRoIiwid2lkdGgiLCJoZWlnaHQiLCJjYW52YXNDb250ZXh0Iiwidmlld3BvcnQiLCJ0eXBlIiwiaW1hZ2VfdHlwZSIsInVwbG9hZCIsIm5hbWUiLCJpbWciLCJJbWFnZSIsIl9mcm9tUERGIiwiYWRkRmlsZSIsImdldEFzQmxvYiIsInJlbW92ZSIsImxvYWQiLCJ0b0RhdGFVUkwiLCJqcGVnX3F1YWxpdHkiLCJhcHBlbmQiLCJlYWNoIiwiYnRuIiwicGciLCJyZXBsYWNlIiwiVXBsb2FkZXJXaW5kb3ciLCJfcGFyZW50UmVhZHkiLCJyZWFkeSIsImRpZFJlYWR5IiwicGRmTW9kYWwiLCJyZXQiLCJiaW5kIiwidXAiLCJfcmV0IiwiZmlsZURhdGEiLCJnZXROYXRpdmUiLCJnZXRTb3VyY2UiLCJCbG9iIiwic3RvcCIsInJlZnJlc2giLCJmaWxlSXRlbSIsImRpc3Bvc2UiLCJjb250cm9sbGVyIiwiVXBsb2FkIiwicmVtb3ZlRmlsZSIsImF0dGFjaG1lbnQiLCJkZXN0cm95Iiwic3RhcnQiLCJvcGVuIiwicGRmUG9wdXAiLCJwZGZfcmVuZGVyZXIiLCJqUXVlcnkiLCJtT3hpZSJdLCJtYXBwaW5ncyI6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QyxXQTZEeEMsT0EzREFELEtBQUs0SCxVQUFXLEVBRWhCRSxJQUFNOUgsS0FBSzBILGFBQWEzSCxNQUFPQyxLQUFPQyxXQTBDdENELEtBQUtjLFNBQVNBLFNBQVNpSCxLQUFLLGVBQWUsU0FBVUMsRUFBSTVFLEdBWnpELElBQXNCQSxFQUNqQjZFLEVBYWMsbUJBQWI3RSxFQUFLbUQsT0FFVDJCLFdBZkdELEVBQU8sQ0FDVjdFLEtBRm9CQSxFQWdCSUEsRUFieEJTLEtBQUtULEVBQUsrRSxjQUVDdEUsT0FDWG9FLEVBQUtwRSxLQUFPVCxFQUFLZ0YsYUFFWEgsR0FTREMsU0FBU3JFLGdCQUFnQndFLE9BQzdCTCxFQUFHTSxPQUNITixFQUFHTyxVQS9DTixTQUFtQnpILEVBQVUwSCxHQUV2QlgsR0FDSkEsRUFBU25ILFFBQVErSCxXQUdsQlosRUFBVyxJQUFJakosRUFBWUMsS0FBS3NCLFNBQVUsQ0FDekN1SSxXQUFZbEssRUFBRXdCLE1BQ2RjLFNBQVNBLEVBQ1RDLE1BQU9qQyxFQUFLNkosT0FBUyxLQUFPSCxFQUFTcEYsS0FBS3NELEtBQUtjLFFBQVEsZUFBZSxPQUU5RDdFLEdBQUcsZ0JBQWdCLFdBRTNCN0IsRUFBUzhILFdBQVlKLEVBQVNwRixNQUM5Qm9GLEVBQVNwRixLQUFLeUYsV0FBV0MsWUFFdkJuRyxHQUFHLGtCQUFrQixXQUV2QjdCLEVBQVNpSSxVQUdWbEIsRUFBUzFFLFFBQVNxRixHQUNsQlgsRUFBU21CLE9BMEJQQyxDQUFVakIsRUFBSUUsY0FPVkosT0FHVGxILEVBQUVsQixPQUFRd0osYUFBY3RLLEdBM1Z6QixDQTRWSXVLLE9BQVFELGFBQWNFIiwiZmlsZSI6ImFkbWluL21lZGlhLmRldi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiggJCwgb3B0cywgbyApIHtcblxuXHR2YXIgcGRmUmVuZGVyZXIgPSB7XG5cdFx0XHR2aWV3OiB7fVxuXHRcdH0sXG5cdFx0bDEwbiA9IG9wdHMubDEwbixcblx0XHRpbWFnZUluZm9zID0ge30sXG5cdFx0UGFnZUl0ZW0sXG5cdFx0cGRmQWxsb3dlZCA9IF93cFBsdXBsb2FkU2V0dGluZ3MuZGVmYXVsdHMuZmlsdGVycy5taW1lX3R5cGVzWzBdLmV4dGVuc2lvbnMuc3BsaXQoJywnKS5pbmRleE9mKCdwZGYnKSAhPT0gLTE7XG5cblx0Ly8gdGVtcG9yYWlseSBhZGQgcGRmIHR5cGUgdG8gcGx1cGxvYWQgc2V0dGluZ3MsXG5cdC8vIHNvIHRoZSB1cGxvYWRlciBkb2Vzbid0IGNhbmNlbCB0b28gZWFybHkuXG5cdC8vIEZpbGUgdHlwZXMgYXJlIGNoZWNrZWQgc2VydmVyLXNpZGUgdG9vLCBzb1xuXHQvLyB0aGVyZSBzaG91bGQgYmUgbm8gc2VjdXJpdHkgaW1wbGljYXRpb25zLlxuXHRpZiAoICEgcGRmQWxsb3dlZCApIHtcblx0XHRfd3BQbHVwbG9hZFNldHRpbmdzLmRlZmF1bHRzLmZpbHRlcnMubWltZV90eXBlc1swXS5leHRlbnNpb25zICs9ICcscGRmJztcblx0fVxuXG5cdFBhZ2VJdGVtID0gd3AubWVkaWEuVmlldy5leHRlbmQoe1xuXHRcdHRlbXBsYXRlOiAgd3AudGVtcGxhdGUoJ3BkZi1wYWdlLWl0ZW0nKSxcblx0XHRjbGFzc05hbWU6J3BkZi1wYWdlLWl0ZW0nLFxuXHRcdGluaXRpYWxpemU6ZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gd3AubWVkaWEuVmlldy5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0fSxcblx0XHRyZW5kZXI6ZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gd3AubWVkaWEuVmlldy5wcm90b3R5cGUucmVuZGVyLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcblx0XHR9XG5cdH0pO1xuXG5cdHBkZlJlbmRlcmVyLnZpZXcuUERGRnJhbWUgPSB3cC5tZWRpYS52aWV3Lk1lZGlhRnJhbWUuZXh0ZW5kKHtcblx0XHR0ZW1wbGF0ZTogd3AudGVtcGxhdGUoJ3BkZi1tb2RhbCcpLFxuXHRcdHJlZ2lvbnM6IFsgJ3RpdGxlJywnY29udGVudCcsJ2luc3RydWN0aW9ucycsJ2J1dHRvbnMnLCAncGFnZW5hdicgXSxcblx0XHRldmVudHM6IHtcblx0XHRcdCdjbGljayBbZGF0YS1wYWdlXScgOiAnY2xpY2tQYWdlJyxcblx0XHRcdCdjbGljayAubWVkaWEtbW9kYWwtY2xvc2UnIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRoaXMudHJpZ2dlcignY2FuY2VsLXVwbG9hZCcpO1xuXHRcdFx0XHR0aGlzLmNsb3NlKCk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRfLmRlZmF1bHRzKCB0aGlzLm9wdGlvbnMsIHtcblx0XHRcdFx0dXBsb2FkZXI6XHRmYWxzZSxcblx0XHRcdFx0dGl0bGU6XHRcdGwxMG4ucGRmVXBsb2FkLFxuXHRcdFx0fSk7XG5cblx0XHRcdHdwLm1lZGlhLnZpZXcuTWVkaWFGcmFtZS5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cblx0XHRcdHRoaXMuX3BkZiA9IHRoaXMuX2NhbnZhcyA9IG51bGw7XG5cdFx0XHR0aGlzLl9jdXJyZW50X3BhZ2UgPSAwO1xuXG5cdFx0XHR0aGlzLl91cGxvYWRCdG4gPSBuZXcgd3AubWVkaWEudmlldy5CdXR0b24oe1xuXHRcdFx0XHR0ZXh0OiBsMTBuLlVwbG9hZEltYWdlcyxcblx0XHRcdFx0Y2xhc3NOYW1lOiAnYnV0dG9uLXByaW1hcnknLFxuXHRcdFx0XHRjbGljazpmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRzZWxmLnRyaWdnZXIoJ2NhbmNlbC11cGxvYWQnKTtcblx0XHRcdFx0XHRzZWxmLnVwbG9hZEltYWdlcygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdGlmICggcGRmQWxsb3dlZCApIHtcblx0XHRcdFx0dGhpcy5fc2tpcEJ0biA9IG5ldyB3cC5tZWRpYS52aWV3LkJ1dHRvbih7XG5cdFx0XHRcdFx0dGV4dDogbDEwbi5VcGxvYWRQREYsXG5cdFx0XHRcdFx0Y2xhc3NOYW1lOiAndXBsb2FkLXBkZicsXG5cdFx0XHRcdFx0Y2xpY2s6ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnRyaWdnZXIoJ2NvbnRpbnVlLXVwbG9hZCcpO1xuXHRcdFx0XHRcdFx0c2VsZi5jbG9zZSgpO1xuXHRcdFx0XHRcdFx0Ly8gZGlzbWlzcywgY29udGludWUgd2l0aCB3cCBkZWZhdWx0IGJlaGF2aW91clxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLl9jYW5jZWxCdG4gPSBuZXcgd3AubWVkaWEudmlldy5CdXR0b24oe1xuXHRcdFx0XHR0ZXh0OiBsMTBuLkNhbmNlbFVwbG9hZCxcblx0XHRcdFx0Y2xhc3NOYW1lOiAnY2FuY2VsLXVwbG9hZCcsXG5cdFx0XHRcdGNsaWNrOmZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHNlbGYudHJpZ2dlcignY2FuY2VsLXVwbG9hZCcpO1xuXHRcdFx0XHRcdHNlbGYuY2xvc2UoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuX3BhZ2VzID0gbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oKTtcblx0XHRcdHRoaXMuX3VwbG9hZFBhZ2VzID0gbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oKTtcblx0XHRcdHRoaXMubGlzdGVuVG8odGhpcy5fcGFnZXMsJ2NoYW5nZTpzZWxlY3RlZCcsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdC8vIGRpc2FibGUgaW1nIHVwbG9hZCBidG4gaWYgbm8gcGFnZXMgc2VsZWN0ZWRcblx0XHRcdFx0dGhpcy5fdXBsb2FkQnRuLiRlbC5wcm9wKCdkaXNhYmxlZCcsIHRoaXMuX3BhZ2VzLndoZXJlKHtzZWxlY3RlZDp0cnVlfSkubGVuZ3RoID09PSAwIClcblx0XHRcdH0pXG5cblx0XHRcdHRoaXMuY3JlYXRlVGl0bGUoKTtcblx0XHRcdHRoaXMuY3JlYXRlQnV0dG9ucygpO1xuXG5cdFx0XHR0aGlzLm9uKCdlc2NhcGUnLGZ1bmN0aW9uKCl7XG5cdFx0XHRcdHNlbGYudHJpZ2dlcignY2FuY2VsLXVwbG9hZCcpO1xuXHRcdFx0fSlcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cblx0XHR9LFxuXHRcdGVzY2FwZTpmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMudHJpZ2dlcignY2FuY2VsLXVwbG9hZCcpO1xuXHRcdFx0cmV0dXJuIHdwLm1lZGlhLnZpZXcuTWVkaWFGcmFtZS5wcm90b3R5cGUuZXNjYXBlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcblx0XHR9LFxuXHRcdGNyZWF0ZVRpdGxlOiBmdW5jdGlvbiggKSB7XG5cdFx0XHR0aGlzLl90aXRsZSA9IG5ldyB3cC5tZWRpYS5WaWV3KHtcblx0XHRcdFx0dGFnTmFtZTogJ2gxJ1xuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLl90aXRsZS4kZWwudGV4dCggdGhpcy5vcHRpb25zLnRpdGxlICk7XG5cdFx0XHR0aGlzLnRpdGxlLnNldCggWyB0aGlzLl90aXRsZSBdICk7XG5cdFx0fSxcblx0XHRjcmVhdGVCdXR0b25zOiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMuYWN0aW9uQnRuID0gW107XG5cblx0XHRcdHRoaXMuYWN0aW9uQnRuLnB1c2goIHRoaXMuX2NhbmNlbEJ0biApO1xuXHRcdFx0aWYgKCBwZGZBbGxvd2VkICkge1xuXHRcdFx0XHR0aGlzLmFjdGlvbkJ0bi5wdXNoKCB0aGlzLl9za2lwQnRuICk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLmFjdGlvbkJ0bi5wdXNoKCB0aGlzLl91cGxvYWRCdG4gKTtcblxuXHRcdFx0dGhpcy5idXR0b25zLnNldCggdGhpcy5hY3Rpb25CdG4gKTtcblxuXHRcdH0sXG5cdFx0c2V0RmlsZTpmdW5jdGlvbiggZmlsZSApIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0ZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cdFx0XHR0aGlzLmZpbGUgPSBmaWxlO1xuXHRcdFx0ZmlsZVJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbihldmVudCkge1xuLy9cdFx0XHQgICAgYXJyYXlCdWZmZXIgPSBldmVudC50YXJnZXQucmVzdWx0O1xuXHRcdFx0XHRzZWxmLnBhcnNlUERGKCBldmVudC50YXJnZXQucmVzdWx0ICk7XG5cdFx0XHR9O1xuXHRcdFx0ZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlciggZmlsZS5ibG9iICk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGNsaWNrUGFnZTpmdW5jdGlvbihlKSB7XG5cdFx0XHR0aGlzLnNob3dQYWdlKCQoZS50YXJnZXQpLmF0dHIoJ2RhdGEtcGFnZScpKTtcblx0XHR9LFxuXHRcdHJlbmRlclBhZ2VOYXY6ZnVuY3Rpb24obnVtUGFnZXMpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0aSA9IDEsIGJ0bnMgPSBbXSwgbTtcblxuXHRcdFx0d2hpbGUgKCB0aGlzLl9wYWdlcy5sZW5ndGggKSB7XG5cdFx0XHRcdHRoaXMuX3BhZ2VzLnBvcCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKGk7aTw9bnVtUGFnZXM7aSsrKSB7XG5cdFx0XHRcdG0gPSBuZXcgQmFja2JvbmUuTW9kZWwoe1xuXHRcdFx0XHRcdGlkOmksXG5cdFx0XHRcdFx0c2VsZWN0ZWQ6dHJ1ZSxcblx0XHRcdFx0fSk7XG5cdFx0XHRcdHRoaXMuX3BhZ2VzLmFkZCggbSApO1xuXG5cdFx0XHRcdGJ0bnMucHVzaChcblx0XHRcdFx0XHRuZXcgUGFnZUl0ZW0oe1xuXHRcdFx0XHRcdFx0cGFnZW51bTppLFxuXHRcdFx0XHRcdFx0c2VsZWN0ZWQ6dHJ1ZSxcblx0XHRcdFx0XHRcdG1vZGVsOm0sXG5cdFx0XHRcdFx0XHRldmVudHM6e1xuXHRcdFx0XHRcdFx0XHQnY2hhbmdlIFt0eXBlPVwicmFkaW9cIl0nIDogZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdFx0XHRpZiAoIHRoaXMuJCgnW3R5cGU9XCJyYWRpb1wiXScpLnByb3AoJ2NoZWNrZWQnKSApIHtcblx0XHRcdFx0XHRcdFx0XHRcdHNlbGYuc2hvd1BhZ2UoIHRoaXMub3B0aW9ucy5wYWdlbnVtICk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0XHQnY2hhbmdlIFt0eXBlPVwiY2hlY2tib3hcIl0nIDogZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdFx0XHR0aGlzLm1vZGVsLnNldCggJ3NlbGVjdGVkJywgdGhpcy4kKCdbdHlwZT1cImNoZWNrYm94XCJdJykucHJvcCgnY2hlY2tlZCcpICk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KVxuXHRcdFx0XHQpO1xuXG5cdFx0XHR9XG5cdFx0XHR0aGlzLnBhZ2VuYXYuc2V0KCBidG5zICk7XG5cdFx0fSxcblx0XHRwYXJzZVBERjpmdW5jdGlvbiggYXJyICkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0cGRmanNMaWIuZ2V0RG9jdW1lbnQoYXJyKS50aGVuKGZ1bmN0aW9uKHBkZikge1xuXHRcdFx0XHQvLyBidWlsZCBwYWdlcyBzZWxlY3RvclxuXHRcdFx0XHRzZWxmLl9wZGYgPSBwZGY7XG5cdFx0XHRcdHNlbGYucmVuZGVyUGFnZU5hdihwZGYubnVtUGFnZXMpXG5cblx0XHRcdFx0c2VsZi5zaG93UGFnZSgxKTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cdFx0c2hvd1BhZ2U6ZnVuY3Rpb24oaWR4KSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdG0gPSB0aGlzLl9wYWdlcy5nZXQoaWR4KTtcblxuXHRcdFx0aWYgKCAhISBtLmdldCgnY2FudmFzJykgKSB7XG5cdFx0XHRcdHRoaXMuY29udGVudC5zZXQoIFtcblx0XHRcdFx0XHRuZXcgd3AubWVkaWEuVmlldyh7XG5cdFx0XHRcdFx0XHRlbDogbS5nZXQoJ2NhbnZhcycpLFxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdF0gKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuY29udGVudC5zZXQoW25ldyBCYWNrYm9uZS5WaWV3KCldKVxuXHRcdFx0XHR0aGlzLnJlbmRlclBhZ2UoIGlkeCwgZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRzZWxmLnNob3dQYWdlKGlkeCk7XG5cdFx0XHRcdH0gKTtcblx0XHRcdH1cblxuXHRcdH0sXG5cdFx0cmVuZGVyUGFnZTpmdW5jdGlvbihpZHgsY2IsY2JfYXJncykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRtID0gdGhpcy5fcGFnZXMuZ2V0KGlkeCk7XG5cblx0XHRcdHNlbGYuX3BkZi5nZXRQYWdlKGlkeCkudGhlbihmdW5jdGlvbihwYWdlKXtcblx0XHRcdFx0dmFyIHZwID0gcGFnZS5nZXRWaWV3cG9ydCgxKSxcblx0XHRcdFx0XHRjYW52YXMgPSAkKCc8Y2FudmFzPjwvY2FudmFzPicpLmdldCgwKSxcblx0XHRcdFx0XHRjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuXHRcdFx0XHR2cCA9IHBhZ2UuZ2V0Vmlld3BvcnQoIG9wdHMub3B0aW9ucy5pbWFnZV93aWR0aCAvIHZwLndpZHRoICk7XG5cblx0XHRcdFx0Y2FudmFzLndpZHRoID0gdnAud2lkdGg7XG5cdFx0XHRcdGNhbnZhcy5oZWlnaHQgPSB2cC5oZWlnaHQ7XG5cblx0XHRcdFx0cGFnZS5yZW5kZXIoe1xuXHRcdFx0XHRcdGNhbnZhc0NvbnRleHQ6IGN0eCxcblx0XHRcdFx0XHR2aWV3cG9ydDogdnAsXG5cdFx0XHRcdH0pLnRoZW4oZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRtLnNldCggJ3BhZ2UnLCBwYWdlICk7XG5cdFx0XHRcdFx0bS5zZXQoICdjYW52YXMnLCBjYW52YXMgKTtcblxuXHRcdFx0XHRcdCEhY2IgJiYgY2IuYXBwbHkobSxjYl9hcmdzfHxbXSk7XG4vL1x0XHRcdFx0XHRzZWxmLnNob3dQYWdlKGlkeCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXG5cdFx0dXBsb2FkSW1hZ2VzOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHR0eXBlID0gb3B0cy5vcHRpb25zLmltYWdlX3R5cGUsXG5cdFx0XHRcdHVwbG9hZCA9IGZ1bmN0aW9uKCBuYW1lICkge1xuXHRcdFx0XHRcdHZhciBpbWcgPSBuZXcgby5JbWFnZSgpLFxuXHRcdFx0XHRcdFx0bSA9IHRoaXM7XG5cdFx0XHRcdFx0aW1nLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0aW1nLm5hbWUgPSBuYW1lO1xuXHRcdFx0XHRcdFx0aW1nLnR5cGUgPSB0eXBlO1xuXHRcdFx0XHRcdFx0aW1nLl9mcm9tUERGID0gdHJ1ZTtcblx0XHRcdFx0XHRcdHNlbGYub3B0aW9ucy51cGxvYWRlci5hZGRGaWxlKCBpbWcuZ2V0QXNCbG9iKCksIG5hbWUgKTtcblxuXHRcdFx0XHRcdFx0c2VsZi5fcGFnZXMucmVtb3ZlKG0uaWQpO1xuXHRcdFx0XHRcdFx0bS5zZXQoICdpbWFnZScsIGltZyApO1xuXHRcdFx0XHRcdFx0c2VsZi5fdXBsb2FkUGFnZXMuYWRkKG0pO1xuXHRcdFx0XHRcdFx0aWYgKCBzZWxmLl91cGxvYWRQYWdlcy5sZW5ndGggPT09IHNlbGYuX3BhZ2VzLndoZXJlKCB7IHNlbGVjdGVkOiB0cnVlIH0gKS5sZW5ndGggKSB7XG5cdFx0XHRcdFx0XHRcdC8vIHRyaWdnZXIgc29tZXRoaW5nXG5cdFx0XHRcdFx0XHRcdHNlbGYudHJpZ2dlcignY29tcGxldGUnKTtcblx0XHRcdFx0XHRcdFx0c2VsZi5jbG9zZSgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGltZy5sb2FkKCB0aGlzLmdldCgnY2FudmFzJykudG9EYXRhVVJMKCBvcHRzLm9wdGlvbnMuaW1hZ2VfdHlwZSwgb3B0cy5vcHRpb25zLmpwZWdfcXVhbGl0eSAqIDAuMDEgKSApO1xuXHRcdFx0XHRcdC8vXG5cdFx0XHRcdFx0JCgnYm9keScpLmFwcGVuZChpbWcpO1xuXHRcdFx0XHR9O1xuXHRcdFx0Xy5lYWNoKCB0aGlzLmFjdGlvbkJ0biwgZnVuY3Rpb24oYnRuKXtcblx0XHRcdFx0YnRuLiRlbC5wcm9wKCdkaXNhYmxlZCcsdHJ1ZSk7XG5cdFx0XHR9ICk7XG5cdFx0XHQvLyBjcmVhdGUgZSBuZXcgbWVkaWEgbW9kZWwgZnJvbSBibG9iIGRhdGEgVVJMIHRoaW5neVxuXG5cdFx0XHRfLmVhY2goIHRoaXMuX3BhZ2VzLndoZXJlKCB7IHNlbGVjdGVkOiB0cnVlIH0gKSwgZnVuY3Rpb24oIHBnLCBpICl7XG5cblx0XHRcdFx0dmFyIG5hbWUgPSBzZWxmLmZpbGUuZmlsZS5uYW1lLnJlcGxhY2UoL1xcLlthLXowLTldKyQvLCcnKSArICctcCcgKyBpICsgJy5wbmcnO1xuXG5cdFx0XHRcdGlmICggISBwZy5nZXQoJ2NhbnZhcycpICkge1xuXHRcdFx0XHRcdC8vIG5lZWRzIHJlbmRlcmluZ1xuXHRcdFx0XHRcdHNlbGYucmVuZGVyUGFnZSggcGcuZ2V0KCdpZCcpLCB1cGxvYWQsW25hbWVdKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR1cGxvYWQuYXBwbHkocGcsW25hbWVdKVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdH0pO1xuXG5cblx0Xy5leHRlbmQoIHdwLm1lZGlhLnZpZXcuVXBsb2FkZXJXaW5kb3cucHJvdG90eXBlLCB7XG5cdFx0X3BhcmVudFJlYWR5OiB3cC5tZWRpYS52aWV3LlVwbG9hZGVyV2luZG93LnByb3RvdHlwZS5yZWFkeSxcblx0XHRkaWRSZWFkeTpmYWxzZSxcblxuXHRcdHJlYWR5OmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHBkZnMgPSBbXSxcblx0XHRcdFx0cGRmTW9kYWwsIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHQvLyBwcmV2ZW50IGRvdWJsZSBpbml0XG5cdFx0XHRpZiAoIHRoaXMuZGlkUmVhZHkgKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9wYXJlbnRSZWFkeS5hcHBseSggdGhpcyAsIGFyZ3VtZW50cyApO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5kaWRSZWFkeSA9IHRydWU7XG5cblx0XHRcdHJldCA9IHRoaXMuX3BhcmVudFJlYWR5LmFwcGx5KCB0aGlzICwgYXJndW1lbnRzICk7XG5cblx0XHRcdGZ1bmN0aW9uIHBkZlBvcHVwKCB1cGxvYWRlciwgZmlsZUl0ZW0gKSB7XG5cblx0XHRcdFx0aWYgKCBwZGZNb2RhbCApIHtcblx0XHRcdFx0XHRwZGZNb2RhbC5jbG9zZSgpLmRpc3Bvc2UoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHBkZk1vZGFsID0gbmV3IHBkZlJlbmRlcmVyLnZpZXcuUERGRnJhbWUoIHtcblx0XHRcdFx0XHRjb250cm9sbGVyOiAkKHRoaXMpLFxuXHRcdFx0XHRcdHVwbG9hZGVyOnVwbG9hZGVyLFxuXHRcdFx0XHRcdHRpdGxlOiBsMTBuLlVwbG9hZCArICc6ICcgKyBmaWxlSXRlbS5maWxlLm5hbWUucmVwbGFjZSgvXFwuW2EtejAtOV0rJC8sJycpLFxuXHRcdFx0XHR9ICk7XG5cdFx0XHRcdHBkZk1vZGFsLm9uKCdjYW5jZWwtdXBsb2FkJyxmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQvLyBzdG9wIGVjZXJ5dGhpbmchXG5cdFx0XHRcdFx0dXBsb2FkZXIucmVtb3ZlRmlsZSggZmlsZUl0ZW0uZmlsZSApO1xuXHRcdFx0XHRcdGZpbGVJdGVtLmZpbGUuYXR0YWNobWVudC5kZXN0cm95KCk7XG5cblx0XHRcdFx0fSkub24oJ2NvbnRpbnVlLXVwbG9hZCcsZnVuY3Rpb24oKXtcblx0XHRcdFx0XHQvLyBnbyBhaGVhZCB3aXRoIGEgbm9ybWFsIFdQIHVwbG9hZC4uXG5cdFx0XHRcdFx0dXBsb2FkZXIuc3RhcnQoKTtcblxuXHRcdFx0XHR9KTtcblx0XHRcdFx0cGRmTW9kYWwuc2V0RmlsZSggZmlsZUl0ZW0gKTtcblx0XHRcdFx0cGRmTW9kYWwub3BlbigpO1xuXHRcdFx0fVxuXG5cdFx0XHQvKipcblx0XHRcdCAqXHRAcmV0dXJuIG5hdGl2ZSBmaWxlIG9iamVjdCBvciBibG9iXG5cdFx0XHQgKi9cblx0XHRcdGZ1bmN0aW9uIHJlc29sdmVGaWxlKCBmaWxlICkge1xuXHRcdFx0XHR2YXIgX3JldCA9IHtcblx0XHRcdFx0XHRmaWxlOiBmaWxlLFxuXHRcdFx0XHRcdGJsb2I6ZmlsZS5nZXROYXRpdmUoKVxuXHRcdFx0XHR9LCBfcmV0MiwgYnl0ZXMsIGk7XG5cdFx0XHRcdGlmICggISBfcmV0LmJsb2IgKSB7XG5cdFx0XHRcdFx0X3JldC5ibG9iID0gZmlsZS5nZXRTb3VyY2UoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gX3JldDtcblx0XHRcdH1cblxuXHRcdFx0Ly8gc2VuZCBjcm9wZGF0YVxuXHRcdFx0dGhpcy51cGxvYWRlci51cGxvYWRlci5iaW5kKCdCZWZvcmVVcGxvYWQnLGZ1bmN0aW9uKCB1cCwgZmlsZSApIHtcblxuXHRcdFx0XHRpZiAoIGZpbGUudHlwZSA9PSAnYXBwbGljYXRpb24vcGRmJykge1xuXG5cdFx0XHRcdFx0ZmlsZURhdGEgPSByZXNvbHZlRmlsZSggZmlsZSApO1xuXHRcdFx0XHRcdGlmICggZmlsZURhdGEuYmxvYiBpbnN0YW5jZW9mIEJsb2IgKSB7XG5cdFx0XHRcdFx0XHR1cC5zdG9wKCk7XG5cdFx0XHRcdFx0XHR1cC5yZWZyZXNoKCk7XG5cdFx0XHRcdFx0XHRwZGZQb3B1cCggdXAsIGZpbGVEYXRhICk7IC8vIHdpbGwgYXNrIGZvciBmb2N1cyBvciBzdGFydCB1cGxvYWRlclxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggcGRmcy5sZW5ndGggKSB7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHJldDtcblx0XHR9XG5cdH0pO1xuXHRfLmV4dGVuZCggcGRmX3JlbmRlcmVyLCBwZGZSZW5kZXJlciApO1xufSkoIGpRdWVyeSwgcGRmX3JlbmRlcmVyLCBtT3hpZSApO1xuIl19
