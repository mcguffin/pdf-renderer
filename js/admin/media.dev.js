!function(p,l,s){var o,c={view:{}},d=l.l10n,t=-1!==_wpPluploadSettings.defaults.filters.mime_types[0].extensions.split(",").indexOf("pdf");t||(_wpPluploadSettings.defaults.filters.mime_types[0].extensions+=",pdf"),o=wp.media.View.extend({template:wp.template("pdf-page-item"),className:"pdf-page-item",initialize:function(){return wp.media.View.prototype.initialize.apply(this,arguments)},render:function(){return wp.media.View.prototype.render.apply(this,arguments)}}),c.view.PDFFrame=wp.media.view.MediaFrame.extend({template:wp.template("pdf-modal"),regions:["title","content","instructions","buttons","pagenav"],events:{"click [data-page]":"clickPage","click .media-modal-close":function(){this.trigger("cancel-upload"),this.close()}},initialize:function(){var e=this;return _.defaults(this.options,{uploader:!1,title:d.pdfUpload}),wp.media.view.MediaFrame.prototype.initialize.apply(this,arguments),this._pdf=this._canvas=null,this._current_page=0,this._uploadBtn=new wp.media.view.Button({text:d.UploadImages,className:"button-primary",click:function(){e.trigger("cancel-upload"),e.uploadImages()}}),t&&(this._skipBtn=new wp.media.view.Button({text:d.UploadPDF,className:"upload-pdf",click:function(){e.trigger("continue-upload"),e.close()}})),this._cancelBtn=new wp.media.view.Button({text:d.CancelUpload,className:"cancel-upload",click:function(){e.trigger("cancel-upload"),e.close()}}),this._pages=new Backbone.Collection,this._uploadPages=new Backbone.Collection,this.listenTo(this._pages,"change:selected",function(e){this._uploadBtn.$el.prop("disabled",0===this._pages.where({selected:!0}).length)}),this.createTitle(),this.createButtons(),this.on("escape",function(){e.trigger("cancel-upload")}),this},escape:function(){return this.trigger("cancel-upload"),wp.media.view.MediaFrame.prototype.escape.apply(this,arguments)},createTitle:function(){this._title=new wp.media.View({tagName:"h1"}),this._title.$el.text(this.options.title),this.title.set([this._title])},createButtons:function(){this.actionBtn=[],this.actionBtn.push(this._cancelBtn),t&&this.actionBtn.push(this._skipBtn),this.actionBtn.push(this._uploadBtn),this.buttons.set(this.actionBtn)},setFile:function(e){var t=this,i=new FileReader;return this.file=e,i.onload=function(e){t.parsePDF(e.target.result)},i.readAsArrayBuffer(e.blob),this},clickPage:function(e){this.showPage(p(e.target).attr("data-page"))},renderPageNav:function(e){for(var t,i=this,a=1,n=[];this._pages.length;)this._pages.pop();for(;a<=e;a++)t=new Backbone.Model({id:a,selected:!0}),this._pages.add(t),n.push(new o({pagenum:a,selected:!0,model:t,events:{'change [type="radio"]':function(){this.$('[type="radio"]').prop("checked")&&i.showPage(this.options.pagenum)},'change [type="checkbox"]':function(){this.model.set("selected",this.$('[type="checkbox"]').prop("checked"))}}}));this.pagenav.set(n)},parsePDF:function(e){var t=this;pdfjsLib.getDocument(e).then(function(e){t._pdf=e,t.renderPageNav(e.numPages),t.showPage(1)})},showPage:function(e){var t=this,i=this._pages.get(e);i.get("canvas")?this.content.set([new wp.media.View({el:i.get("canvas")})]):(this.content.set([new Backbone.View]),this.renderPage(e,function(){t.showPage(e)}))},renderPage:function(e,n,o){var s=this._pages.get(e);this._pdf.getPage(e).then(function(e){var t=e.getViewport(1),i=p("<canvas></canvas>").get(0),a=i.getContext("2d");t=e.getViewport(l.options.image_width/t.width),i.width=t.width,i.height=t.height,e.render({canvasContext:a,viewport:t}).then(function(){s.set("page",e),s.set("canvas",i),n&&n.apply(s,o||[])})})},uploadImages:function(){var a=this,n=l.options.image_type,o=function(e){var t=new s.Image,i=this;t.onload=function(){t.name=e,t.type=n,t._fromPDF=!0,a.options.uploader.addFile(t.getAsBlob(),e),a._pages.remove(i.id),i.set("image",t),a._uploadPages.add(i),a._uploadPages.length===a._pages.where({selected:!0}).length&&(a.trigger("complete"),a.close())},t.load(this.get("canvas").toDataURL(l.options.image_type,.01*l.options.jpeg_quality)),p("body").append(t)};_.each(this.actionBtn,function(e){e.$el.prop("disabled",!0)}),_.each(this._pages.where({selected:!0}),function(e,t){var i=a.file.file.name.replace(/\.[a-z0-9]+$/,"")+"-p"+t+".png";e.get("canvas")?o.apply(e,[i]):a.renderPage(e.get("id"),o,[i])})}}),_.extend(wp.media.view.UploaderWindow.prototype,{_parentReady:wp.media.view.UploaderWindow.prototype.ready,didReady:!1,ready:function(){var n;if(this.didReady)return this._parentReady.apply(this,arguments);return this.didReady=!0,ret=this._parentReady.apply(this,arguments),this.uploader.uploader.bind("BeforeUpload",function(e,t){var i,a;"application/pdf"==t.type&&(fileData=((a={file:i=t,blob:i.getNative()}).blob||(a.blob=i.getSource()),a),fileData.blob instanceof Blob&&(e.stop(),e.refresh(),function(e,t){n&&n.close().dispose(),(n=new c.view.PDFFrame({controller:p(this),uploader:e,title:d.Upload+": "+t.file.name.replace(/\.[a-z0-9]+$/,"")})).on("cancel-upload",function(){e.removeFile(t.file),t.file.attachment.destroy()}).on("continue-upload",function(){e.start()}),n.setFile(t),n.open()}(e,fileData)))}),ret}})}(jQuery,pdf_renderer,mOxie);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lZGlhLmpzIl0sIm5hbWVzIjpbIiQiLCJvcHRzIiwibyIsIlBhZ2VJdGVtIiwicGRmUmVuZGVyZXIiLCJ2aWV3IiwibDEwbiIsInBkZkFsbG93ZWQiLCJfd3BQbHVwbG9hZFNldHRpbmdzIiwiZGVmYXVsdHMiLCJmaWx0ZXJzIiwibWltZV90eXBlcyIsImV4dGVuc2lvbnMiLCJzcGxpdCIsImluZGV4T2YiLCJ3cCIsIm1lZGlhIiwiVmlldyIsImV4dGVuZCIsInRlbXBsYXRlIiwiY2xhc3NOYW1lIiwiaW5pdGlhbGl6ZSIsInByb3RvdHlwZSIsImFwcGx5IiwidGhpcyIsImFyZ3VtZW50cyIsInJlbmRlciIsIlBERkZyYW1lIiwiTWVkaWFGcmFtZSIsInJlZ2lvbnMiLCJldmVudHMiLCJjbGljayBbZGF0YS1wYWdlXSIsImNsaWNrIC5tZWRpYS1tb2RhbC1jbG9zZSIsInRyaWdnZXIiLCJjbG9zZSIsInNlbGYiLCJfIiwib3B0aW9ucyIsInVwbG9hZGVyIiwidGl0bGUiLCJwZGZVcGxvYWQiLCJfcGRmIiwiX2NhbnZhcyIsIl9jdXJyZW50X3BhZ2UiLCJfdXBsb2FkQnRuIiwiQnV0dG9uIiwidGV4dCIsIlVwbG9hZEltYWdlcyIsImNsaWNrIiwidXBsb2FkSW1hZ2VzIiwiX3NraXBCdG4iLCJVcGxvYWRQREYiLCJfY2FuY2VsQnRuIiwiQ2FuY2VsVXBsb2FkIiwiX3BhZ2VzIiwiQmFja2JvbmUiLCJDb2xsZWN0aW9uIiwiX3VwbG9hZFBhZ2VzIiwibGlzdGVuVG8iLCJlIiwiJGVsIiwicHJvcCIsIndoZXJlIiwic2VsZWN0ZWQiLCJsZW5ndGgiLCJjcmVhdGVUaXRsZSIsImNyZWF0ZUJ1dHRvbnMiLCJvbiIsImVzY2FwZSIsIl90aXRsZSIsInRhZ05hbWUiLCJzZXQiLCJhY3Rpb25CdG4iLCJwdXNoIiwiYnV0dG9ucyIsInNldEZpbGUiLCJmaWxlIiwiZmlsZVJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJldmVudCIsInBhcnNlUERGIiwidGFyZ2V0IiwicmVzdWx0IiwicmVhZEFzQXJyYXlCdWZmZXIiLCJibG9iIiwiY2xpY2tQYWdlIiwic2hvd1BhZ2UiLCJhdHRyIiwicmVuZGVyUGFnZU5hdiIsIm51bVBhZ2VzIiwibSIsImkiLCJidG5zIiwicG9wIiwiTW9kZWwiLCJpZCIsImFkZCIsInBhZ2VudW0iLCJtb2RlbCIsImNoYW5nZSBbdHlwZT1cInJhZGlvXCJdIiwiY2hhbmdlIFt0eXBlPVwiY2hlY2tib3hcIl0iLCJwYWdlbmF2IiwiYXJyIiwicGRmanNMaWIiLCJnZXREb2N1bWVudCIsInRoZW4iLCJwZGYiLCJpZHgiLCJnZXQiLCJjb250ZW50IiwiZWwiLCJyZW5kZXJQYWdlIiwiY2IiLCJjYl9hcmdzIiwiZ2V0UGFnZSIsInBhZ2UiLCJ2cCIsImdldFZpZXdwb3J0IiwiY2FudmFzIiwiY3R4IiwiZ2V0Q29udGV4dCIsImltYWdlX3dpZHRoIiwid2lkdGgiLCJoZWlnaHQiLCJjYW52YXNDb250ZXh0Iiwidmlld3BvcnQiLCJ0eXBlIiwiaW1hZ2VfdHlwZSIsInVwbG9hZCIsIm5hbWUiLCJpbWciLCJJbWFnZSIsIl9mcm9tUERGIiwiYWRkRmlsZSIsImdldEFzQmxvYiIsInJlbW92ZSIsImxvYWQiLCJ0b0RhdGFVUkwiLCJqcGVnX3F1YWxpdHkiLCJhcHBlbmQiLCJlYWNoIiwiYnRuIiwicGciLCJyZXBsYWNlIiwiVXBsb2FkZXJXaW5kb3ciLCJfcGFyZW50UmVhZHkiLCJyZWFkeSIsImRpZFJlYWR5IiwicGRmTW9kYWwiLCJyZXQiLCJiaW5kIiwidXAiLCJfcmV0IiwiZmlsZURhdGEiLCJnZXROYXRpdmUiLCJnZXRTb3VyY2UiLCJCbG9iIiwic3RvcCIsInJlZnJlc2giLCJmaWxlSXRlbSIsImRpc3Bvc2UiLCJjb250cm9sbGVyIiwiVXBsb2FkIiwicmVtb3ZlRmlsZSIsImF0dGFjaG1lbnQiLCJkZXN0cm95Iiwic3RhcnQiLCJvcGVuIiwicGRmUG9wdXAiLCJqUXVlcnkiLCJwZGZfcmVuZGVyZXIiLCJtT3hpZSJdLCJtYXBwaW5ncyI6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QyxXQTZEeEMsT0EzREFELEtBQUs0SCxVQUFXLEVBRWhCRSxJQUFNOUgsS0FBSzBILGFBQWEzSCxNQUFPQyxLQUFPQyxXQTBDdENELEtBQUtjLFNBQVNBLFNBQVNpSCxLQUFLLGVBQWUsU0FBVUMsRUFBSTVFLEdBWnpELElBQXNCQSxFQUNqQjZFLEVBYWMsbUJBQWI3RSxFQUFLbUQsT0FFVDJCLFdBZkdELEVBQU8sQ0FDVjdFLEtBRm9CQSxFQWdCSUEsRUFieEJTLEtBQUtULEVBQUsrRSxjQUVDdEUsT0FDWG9FLEVBQUtwRSxLQUFPVCxFQUFLZ0YsYUFFWEgsR0FTREMsU0FBU3JFLGdCQUFnQndFLE9BQzdCTCxFQUFHTSxPQUNITixFQUFHTyxVQS9DTixTQUFtQnpILEVBQVUwSCxHQUV2QlgsR0FDSkEsRUFBU25ILFFBQVErSCxXQUdsQlosRUFBVyxJQUFJakosRUFBWUMsS0FBS3NCLFNBQVUsQ0FDekN1SSxXQUFZbEssRUFBRXdCLE1BQ2RjLFNBQVNBLEVBQ1RDLE1BQU9qQyxFQUFLNkosT0FBUyxLQUFPSCxFQUFTcEYsS0FBS3NELEtBQUtjLFFBQVEsZUFBZSxPQUU5RDdFLEdBQUcsZ0JBQWdCLFdBRTNCN0IsRUFBUzhILFdBQVlKLEVBQVNwRixNQUM5Qm9GLEVBQVNwRixLQUFLeUYsV0FBV0MsWUFFdkJuRyxHQUFHLGtCQUFrQixXQUV2QjdCLEVBQVNpSSxVQUdWbEIsRUFBUzFFLFFBQVNxRixHQUNsQlgsRUFBU21CLE9BMEJQQyxDQUFVakIsRUFBSUUsY0FPVkosT0F4VlYsQ0E0VklvQixPQUFRQyxhQUFjQyIsImZpbGUiOiJhZG1pbi9tZWRpYS5kZXYuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oICQsIG9wdHMsIG8gKSB7XG5cblx0dmFyIHBkZlJlbmRlcmVyID0ge1xuXHRcdFx0dmlldzoge31cblx0XHR9LFxuXHRcdGwxMG4gPSBvcHRzLmwxMG4sXG5cdFx0aW1hZ2VJbmZvcyA9IHt9LFxuXHRcdFBhZ2VJdGVtLFxuXHRcdHBkZkFsbG93ZWQgPSBfd3BQbHVwbG9hZFNldHRpbmdzLmRlZmF1bHRzLmZpbHRlcnMubWltZV90eXBlc1swXS5leHRlbnNpb25zLnNwbGl0KCcsJykuaW5kZXhPZigncGRmJykgIT09IC0xO1xuXG5cdC8vIHRlbXBvcmFpbHkgYWRkIHBkZiB0eXBlIHRvIHBsdXBsb2FkIHNldHRpbmdzLFxuXHQvLyBzbyB0aGUgdXBsb2FkZXIgZG9lc24ndCBjYW5jZWwgdG9vIGVhcmx5LlxuXHQvLyBGaWxlIHR5cGVzIGFyZSBjaGVja2VkIHNlcnZlci1zaWRlIHRvbywgc29cblx0Ly8gdGhlcmUgc2hvdWxkIGJlIG5vIHNlY3VyaXR5IGltcGxpY2F0aW9ucy5cblx0aWYgKCAhIHBkZkFsbG93ZWQgKSB7XG5cdFx0X3dwUGx1cGxvYWRTZXR0aW5ncy5kZWZhdWx0cy5maWx0ZXJzLm1pbWVfdHlwZXNbMF0uZXh0ZW5zaW9ucyArPSAnLHBkZic7XG5cdH1cblxuXHRQYWdlSXRlbSA9IHdwLm1lZGlhLlZpZXcuZXh0ZW5kKHtcblx0XHR0ZW1wbGF0ZTogIHdwLnRlbXBsYXRlKCdwZGYtcGFnZS1pdGVtJyksXG5cdFx0Y2xhc3NOYW1lOidwZGYtcGFnZS1pdGVtJyxcblx0XHRpbml0aWFsaXplOmZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHdwLm1lZGlhLlZpZXcucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXHRcdH0sXG5cdFx0cmVuZGVyOmZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHdwLm1lZGlhLlZpZXcucHJvdG90eXBlLnJlbmRlci5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0fVxuXHR9KTtcblxuXHRwZGZSZW5kZXJlci52aWV3LlBERkZyYW1lID0gd3AubWVkaWEudmlldy5NZWRpYUZyYW1lLmV4dGVuZCh7XG5cdFx0dGVtcGxhdGU6IHdwLnRlbXBsYXRlKCdwZGYtbW9kYWwnKSxcblx0XHRyZWdpb25zOiBbICd0aXRsZScsJ2NvbnRlbnQnLCdpbnN0cnVjdGlvbnMnLCdidXR0b25zJywgJ3BhZ2VuYXYnIF0sXG5cdFx0ZXZlbnRzOiB7XG5cdFx0XHQnY2xpY2sgW2RhdGEtcGFnZV0nIDogJ2NsaWNrUGFnZScsXG5cdFx0XHQnY2xpY2sgLm1lZGlhLW1vZGFsLWNsb3NlJyA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0aGlzLnRyaWdnZXIoJ2NhbmNlbC11cGxvYWQnKTtcblx0XHRcdFx0dGhpcy5jbG9zZSgpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0Xy5kZWZhdWx0cyggdGhpcy5vcHRpb25zLCB7XG5cdFx0XHRcdHVwbG9hZGVyOlx0ZmFsc2UsXG5cdFx0XHRcdHRpdGxlOlx0XHRsMTBuLnBkZlVwbG9hZCxcblx0XHRcdH0pO1xuXG5cdFx0XHR3cC5tZWRpYS52aWV3Lk1lZGlhRnJhbWUucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXG5cdFx0XHR0aGlzLl9wZGYgPSB0aGlzLl9jYW52YXMgPSBudWxsO1xuXHRcdFx0dGhpcy5fY3VycmVudF9wYWdlID0gMDtcblxuXHRcdFx0dGhpcy5fdXBsb2FkQnRuID0gbmV3IHdwLm1lZGlhLnZpZXcuQnV0dG9uKHtcblx0XHRcdFx0dGV4dDogbDEwbi5VcGxvYWRJbWFnZXMsXG5cdFx0XHRcdGNsYXNzTmFtZTogJ2J1dHRvbi1wcmltYXJ5Jyxcblx0XHRcdFx0Y2xpY2s6ZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0c2VsZi50cmlnZ2VyKCdjYW5jZWwtdXBsb2FkJyk7XG5cdFx0XHRcdFx0c2VsZi51cGxvYWRJbWFnZXMoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRpZiAoIHBkZkFsbG93ZWQgKSB7XG5cdFx0XHRcdHRoaXMuX3NraXBCdG4gPSBuZXcgd3AubWVkaWEudmlldy5CdXR0b24oe1xuXHRcdFx0XHRcdHRleHQ6IGwxMG4uVXBsb2FkUERGLFxuXHRcdFx0XHRcdGNsYXNzTmFtZTogJ3VwbG9hZC1wZGYnLFxuXHRcdFx0XHRcdGNsaWNrOmZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0c2VsZi50cmlnZ2VyKCdjb250aW51ZS11cGxvYWQnKTtcblx0XHRcdFx0XHRcdHNlbGYuY2xvc2UoKTtcblx0XHRcdFx0XHRcdC8vIGRpc21pc3MsIGNvbnRpbnVlIHdpdGggd3AgZGVmYXVsdCBiZWhhdmlvdXJcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5fY2FuY2VsQnRuID0gbmV3IHdwLm1lZGlhLnZpZXcuQnV0dG9uKHtcblx0XHRcdFx0dGV4dDogbDEwbi5DYW5jZWxVcGxvYWQsXG5cdFx0XHRcdGNsYXNzTmFtZTogJ2NhbmNlbC11cGxvYWQnLFxuXHRcdFx0XHRjbGljazpmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRzZWxmLnRyaWdnZXIoJ2NhbmNlbC11cGxvYWQnKTtcblx0XHRcdFx0XHRzZWxmLmNsb3NlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLl9wYWdlcyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCk7XG5cdFx0XHR0aGlzLl91cGxvYWRQYWdlcyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCk7XG5cdFx0XHR0aGlzLmxpc3RlblRvKHRoaXMuX3BhZ2VzLCdjaGFuZ2U6c2VsZWN0ZWQnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHQvLyBkaXNhYmxlIGltZyB1cGxvYWQgYnRuIGlmIG5vIHBhZ2VzIHNlbGVjdGVkXG5cdFx0XHRcdHRoaXMuX3VwbG9hZEJ0bi4kZWwucHJvcCgnZGlzYWJsZWQnLCB0aGlzLl9wYWdlcy53aGVyZSh7c2VsZWN0ZWQ6dHJ1ZX0pLmxlbmd0aCA9PT0gMCApXG5cdFx0XHR9KVxuXG5cdFx0XHR0aGlzLmNyZWF0ZVRpdGxlKCk7XG5cdFx0XHR0aGlzLmNyZWF0ZUJ1dHRvbnMoKTtcblxuXHRcdFx0dGhpcy5vbignZXNjYXBlJyxmdW5jdGlvbigpe1xuXHRcdFx0XHRzZWxmLnRyaWdnZXIoJ2NhbmNlbC11cGxvYWQnKTtcblx0XHRcdH0pXG5cblx0XHRcdHJldHVybiB0aGlzO1xuXG5cdFx0fSxcblx0XHRlc2NhcGU6ZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLnRyaWdnZXIoJ2NhbmNlbC11cGxvYWQnKTtcblx0XHRcdHJldHVybiB3cC5tZWRpYS52aWV3Lk1lZGlhRnJhbWUucHJvdG90eXBlLmVzY2FwZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0fSxcblx0XHRjcmVhdGVUaXRsZTogZnVuY3Rpb24oICkge1xuXHRcdFx0dGhpcy5fdGl0bGUgPSBuZXcgd3AubWVkaWEuVmlldyh7XG5cdFx0XHRcdHRhZ05hbWU6ICdoMSdcblx0XHRcdH0pO1xuXHRcdFx0dGhpcy5fdGl0bGUuJGVsLnRleHQoIHRoaXMub3B0aW9ucy50aXRsZSApO1xuXHRcdFx0dGhpcy50aXRsZS5zZXQoIFsgdGhpcy5fdGl0bGUgXSApO1xuXHRcdH0sXG5cdFx0Y3JlYXRlQnV0dG9uczogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLmFjdGlvbkJ0biA9IFtdO1xuXG5cdFx0XHR0aGlzLmFjdGlvbkJ0bi5wdXNoKCB0aGlzLl9jYW5jZWxCdG4gKTtcblx0XHRcdGlmICggcGRmQWxsb3dlZCApIHtcblx0XHRcdFx0dGhpcy5hY3Rpb25CdG4ucHVzaCggdGhpcy5fc2tpcEJ0biApO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5hY3Rpb25CdG4ucHVzaCggdGhpcy5fdXBsb2FkQnRuICk7XG5cblx0XHRcdHRoaXMuYnV0dG9ucy5zZXQoIHRoaXMuYWN0aW9uQnRuICk7XG5cblx0XHR9LFxuXHRcdHNldEZpbGU6ZnVuY3Rpb24oIGZpbGUgKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXHRcdFx0dGhpcy5maWxlID0gZmlsZTtcblx0XHRcdGZpbGVSZWFkZXIub25sb2FkID0gZnVuY3Rpb24oZXZlbnQpIHtcbi8vXHRcdFx0ICAgIGFycmF5QnVmZmVyID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcblx0XHRcdFx0c2VsZi5wYXJzZVBERiggZXZlbnQudGFyZ2V0LnJlc3VsdCApO1xuXHRcdFx0fTtcblx0XHRcdGZpbGVSZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoIGZpbGUuYmxvYiApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRjbGlja1BhZ2U6ZnVuY3Rpb24oZSkge1xuXHRcdFx0dGhpcy5zaG93UGFnZSgkKGUudGFyZ2V0KS5hdHRyKCdkYXRhLXBhZ2UnKSk7XG5cdFx0fSxcblx0XHRyZW5kZXJQYWdlTmF2OmZ1bmN0aW9uKG51bVBhZ2VzKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGkgPSAxLCBidG5zID0gW10sIG07XG5cblx0XHRcdHdoaWxlICggdGhpcy5fcGFnZXMubGVuZ3RoICkge1xuXHRcdFx0XHR0aGlzLl9wYWdlcy5wb3AoKTtcblx0XHRcdH1cblxuXHRcdFx0Zm9yIChpO2k8PW51bVBhZ2VzO2krKykge1xuXHRcdFx0XHRtID0gbmV3IEJhY2tib25lLk1vZGVsKHtcblx0XHRcdFx0XHRpZDppLFxuXHRcdFx0XHRcdHNlbGVjdGVkOnRydWUsXG5cdFx0XHRcdH0pO1xuXHRcdFx0XHR0aGlzLl9wYWdlcy5hZGQoIG0gKTtcblxuXHRcdFx0XHRidG5zLnB1c2goXG5cdFx0XHRcdFx0bmV3IFBhZ2VJdGVtKHtcblx0XHRcdFx0XHRcdHBhZ2VudW06aSxcblx0XHRcdFx0XHRcdHNlbGVjdGVkOnRydWUsXG5cdFx0XHRcdFx0XHRtb2RlbDptLFxuXHRcdFx0XHRcdFx0ZXZlbnRzOntcblx0XHRcdFx0XHRcdFx0J2NoYW5nZSBbdHlwZT1cInJhZGlvXCJdJyA6IGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKCB0aGlzLiQoJ1t0eXBlPVwicmFkaW9cIl0nKS5wcm9wKCdjaGVja2VkJykgKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzZWxmLnNob3dQYWdlKCB0aGlzLm9wdGlvbnMucGFnZW51bSApO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0J2NoYW5nZSBbdHlwZT1cImNoZWNrYm94XCJdJyA6IGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5tb2RlbC5zZXQoICdzZWxlY3RlZCcsIHRoaXMuJCgnW3R5cGU9XCJjaGVja2JveFwiXScpLnByb3AoJ2NoZWNrZWQnKSApO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0KTtcblxuXHRcdFx0fVxuXHRcdFx0dGhpcy5wYWdlbmF2LnNldCggYnRucyApO1xuXHRcdH0sXG5cdFx0cGFyc2VQREY6ZnVuY3Rpb24oIGFyciApIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdHBkZmpzTGliLmdldERvY3VtZW50KGFycikudGhlbihmdW5jdGlvbihwZGYpIHtcblx0XHRcdFx0Ly8gYnVpbGQgcGFnZXMgc2VsZWN0b3Jcblx0XHRcdFx0c2VsZi5fcGRmID0gcGRmO1xuXHRcdFx0XHRzZWxmLnJlbmRlclBhZ2VOYXYocGRmLm51bVBhZ2VzKVxuXG5cdFx0XHRcdHNlbGYuc2hvd1BhZ2UoMSk7XG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdHNob3dQYWdlOmZ1bmN0aW9uKGlkeCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRtID0gdGhpcy5fcGFnZXMuZ2V0KGlkeCk7XG5cblx0XHRcdGlmICggISEgbS5nZXQoJ2NhbnZhcycpICkge1xuXHRcdFx0XHR0aGlzLmNvbnRlbnQuc2V0KCBbXG5cdFx0XHRcdFx0bmV3IHdwLm1lZGlhLlZpZXcoe1xuXHRcdFx0XHRcdFx0ZWw6IG0uZ2V0KCdjYW52YXMnKSxcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRdICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmNvbnRlbnQuc2V0KFtuZXcgQmFja2JvbmUuVmlldygpXSlcblx0XHRcdFx0dGhpcy5yZW5kZXJQYWdlKCBpZHgsIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0c2VsZi5zaG93UGFnZShpZHgpO1xuXHRcdFx0XHR9ICk7XG5cdFx0XHR9XG5cblx0XHR9LFxuXHRcdHJlbmRlclBhZ2U6ZnVuY3Rpb24oaWR4LGNiLGNiX2FyZ3MpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0bSA9IHRoaXMuX3BhZ2VzLmdldChpZHgpO1xuXG5cdFx0XHRzZWxmLl9wZGYuZ2V0UGFnZShpZHgpLnRoZW4oZnVuY3Rpb24ocGFnZSl7XG5cdFx0XHRcdHZhciB2cCA9IHBhZ2UuZ2V0Vmlld3BvcnQoMSksXG5cdFx0XHRcdFx0Y2FudmFzID0gJCgnPGNhbnZhcz48L2NhbnZhcz4nKS5nZXQoMCksXG5cdFx0XHRcdFx0Y3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cblx0XHRcdFx0dnAgPSBwYWdlLmdldFZpZXdwb3J0KCBvcHRzLm9wdGlvbnMuaW1hZ2Vfd2lkdGggLyB2cC53aWR0aCApO1xuXG5cdFx0XHRcdGNhbnZhcy53aWR0aCA9IHZwLndpZHRoO1xuXHRcdFx0XHRjYW52YXMuaGVpZ2h0ID0gdnAuaGVpZ2h0O1xuXG5cdFx0XHRcdHBhZ2UucmVuZGVyKHtcblx0XHRcdFx0XHRjYW52YXNDb250ZXh0OiBjdHgsXG5cdFx0XHRcdFx0dmlld3BvcnQ6IHZwLFxuXHRcdFx0XHR9KS50aGVuKGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0bS5zZXQoICdwYWdlJywgcGFnZSApO1xuXHRcdFx0XHRcdG0uc2V0KCAnY2FudmFzJywgY2FudmFzICk7XG5cblx0XHRcdFx0XHQhIWNiICYmIGNiLmFwcGx5KG0sY2JfYXJnc3x8W10pO1xuLy9cdFx0XHRcdFx0c2VsZi5zaG93UGFnZShpZHgpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblxuXHRcdHVwbG9hZEltYWdlczpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0dHlwZSA9IG9wdHMub3B0aW9ucy5pbWFnZV90eXBlLFxuXHRcdFx0XHR1cGxvYWQgPSBmdW5jdGlvbiggbmFtZSApIHtcblx0XHRcdFx0XHR2YXIgaW1nID0gbmV3IG8uSW1hZ2UoKSxcblx0XHRcdFx0XHRcdG0gPSB0aGlzO1xuXHRcdFx0XHRcdGltZy5vbmxvYWQgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGltZy5uYW1lID0gbmFtZTtcblx0XHRcdFx0XHRcdGltZy50eXBlID0gdHlwZTtcblx0XHRcdFx0XHRcdGltZy5fZnJvbVBERiA9IHRydWU7XG5cdFx0XHRcdFx0XHRzZWxmLm9wdGlvbnMudXBsb2FkZXIuYWRkRmlsZSggaW1nLmdldEFzQmxvYigpLCBuYW1lICk7XG5cblx0XHRcdFx0XHRcdHNlbGYuX3BhZ2VzLnJlbW92ZShtLmlkKTtcblx0XHRcdFx0XHRcdG0uc2V0KCAnaW1hZ2UnLCBpbWcgKTtcblx0XHRcdFx0XHRcdHNlbGYuX3VwbG9hZFBhZ2VzLmFkZChtKTtcblx0XHRcdFx0XHRcdGlmICggc2VsZi5fdXBsb2FkUGFnZXMubGVuZ3RoID09PSBzZWxmLl9wYWdlcy53aGVyZSggeyBzZWxlY3RlZDogdHJ1ZSB9ICkubGVuZ3RoICkge1xuXHRcdFx0XHRcdFx0XHQvLyB0cmlnZ2VyIHNvbWV0aGluZ1xuXHRcdFx0XHRcdFx0XHRzZWxmLnRyaWdnZXIoJ2NvbXBsZXRlJyk7XG5cdFx0XHRcdFx0XHRcdHNlbGYuY2xvc2UoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpbWcubG9hZCggdGhpcy5nZXQoJ2NhbnZhcycpLnRvRGF0YVVSTCggb3B0cy5vcHRpb25zLmltYWdlX3R5cGUsIG9wdHMub3B0aW9ucy5qcGVnX3F1YWxpdHkgKiAwLjAxICkgKTtcblx0XHRcdFx0XHQvL1xuXHRcdFx0XHRcdCQoJ2JvZHknKS5hcHBlbmQoaW1nKTtcblx0XHRcdFx0fTtcblx0XHRcdF8uZWFjaCggdGhpcy5hY3Rpb25CdG4sIGZ1bmN0aW9uKGJ0bil7XG5cdFx0XHRcdGJ0bi4kZWwucHJvcCgnZGlzYWJsZWQnLHRydWUpO1xuXHRcdFx0fSApO1xuXHRcdFx0Ly8gY3JlYXRlIGUgbmV3IG1lZGlhIG1vZGVsIGZyb20gYmxvYiBkYXRhIFVSTCB0aGluZ3lcblxuXHRcdFx0Xy5lYWNoKCB0aGlzLl9wYWdlcy53aGVyZSggeyBzZWxlY3RlZDogdHJ1ZSB9ICksIGZ1bmN0aW9uKCBwZywgaSApe1xuXG5cdFx0XHRcdHZhciBuYW1lID0gc2VsZi5maWxlLmZpbGUubmFtZS5yZXBsYWNlKC9cXC5bYS16MC05XSskLywnJykgKyAnLXAnICsgaSArICcucG5nJztcblxuXHRcdFx0XHRpZiAoICEgcGcuZ2V0KCdjYW52YXMnKSApIHtcblx0XHRcdFx0XHQvLyBuZWVkcyByZW5kZXJpbmdcblx0XHRcdFx0XHRzZWxmLnJlbmRlclBhZ2UoIHBnLmdldCgnaWQnKSwgdXBsb2FkLFtuYW1lXSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dXBsb2FkLmFwcGx5KHBnLFtuYW1lXSlcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcblxuXG5cdF8uZXh0ZW5kKCB3cC5tZWRpYS52aWV3LlVwbG9hZGVyV2luZG93LnByb3RvdHlwZSwge1xuXHRcdF9wYXJlbnRSZWFkeTogd3AubWVkaWEudmlldy5VcGxvYWRlcldpbmRvdy5wcm90b3R5cGUucmVhZHksXG5cdFx0ZGlkUmVhZHk6ZmFsc2UsXG5cblx0XHRyZWFkeTpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBwZGZzID0gW10sXG5cdFx0XHRcdHBkZk1vZGFsLCBzZWxmID0gdGhpcztcblxuXHRcdFx0Ly8gcHJldmVudCBkb3VibGUgaW5pdFxuXHRcdFx0aWYgKCB0aGlzLmRpZFJlYWR5ICkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fcGFyZW50UmVhZHkuYXBwbHkoIHRoaXMgLCBhcmd1bWVudHMgKTtcblx0XHRcdH1cblx0XHRcdHRoaXMuZGlkUmVhZHkgPSB0cnVlO1xuXG5cdFx0XHRyZXQgPSB0aGlzLl9wYXJlbnRSZWFkeS5hcHBseSggdGhpcyAsIGFyZ3VtZW50cyApO1xuXG5cdFx0XHRmdW5jdGlvbiBwZGZQb3B1cCggdXBsb2FkZXIsIGZpbGVJdGVtICkge1xuXG5cdFx0XHRcdGlmICggcGRmTW9kYWwgKSB7XG5cdFx0XHRcdFx0cGRmTW9kYWwuY2xvc2UoKS5kaXNwb3NlKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRwZGZNb2RhbCA9IG5ldyBwZGZSZW5kZXJlci52aWV3LlBERkZyYW1lKCB7XG5cdFx0XHRcdFx0Y29udHJvbGxlcjogJCh0aGlzKSxcblx0XHRcdFx0XHR1cGxvYWRlcjp1cGxvYWRlcixcblx0XHRcdFx0XHR0aXRsZTogbDEwbi5VcGxvYWQgKyAnOiAnICsgZmlsZUl0ZW0uZmlsZS5uYW1lLnJlcGxhY2UoL1xcLlthLXowLTldKyQvLCcnKSxcblx0XHRcdFx0fSApO1xuXHRcdFx0XHRwZGZNb2RhbC5vbignY2FuY2VsLXVwbG9hZCcsZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0Ly8gc3RvcCBlY2VyeXRoaW5nIVxuXHRcdFx0XHRcdHVwbG9hZGVyLnJlbW92ZUZpbGUoIGZpbGVJdGVtLmZpbGUgKTtcblx0XHRcdFx0XHRmaWxlSXRlbS5maWxlLmF0dGFjaG1lbnQuZGVzdHJveSgpO1xuXG5cdFx0XHRcdH0pLm9uKCdjb250aW51ZS11cGxvYWQnLGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0Ly8gZ28gYWhlYWQgd2l0aCBhIG5vcm1hbCBXUCB1cGxvYWQuLlxuXHRcdFx0XHRcdHVwbG9hZGVyLnN0YXJ0KCk7XG5cblx0XHRcdFx0fSk7XG5cdFx0XHRcdHBkZk1vZGFsLnNldEZpbGUoIGZpbGVJdGVtICk7XG5cdFx0XHRcdHBkZk1vZGFsLm9wZW4oKTtcblx0XHRcdH1cblxuXHRcdFx0LyoqXG5cdFx0XHQgKlx0QHJldHVybiBuYXRpdmUgZmlsZSBvYmplY3Qgb3IgYmxvYlxuXHRcdFx0ICovXG5cdFx0XHRmdW5jdGlvbiByZXNvbHZlRmlsZSggZmlsZSApIHtcblx0XHRcdFx0dmFyIF9yZXQgPSB7XG5cdFx0XHRcdFx0ZmlsZTogZmlsZSxcblx0XHRcdFx0XHRibG9iOmZpbGUuZ2V0TmF0aXZlKClcblx0XHRcdFx0fSwgX3JldDIsIGJ5dGVzLCBpO1xuXHRcdFx0XHRpZiAoICEgX3JldC5ibG9iICkge1xuXHRcdFx0XHRcdF9yZXQuYmxvYiA9IGZpbGUuZ2V0U291cmNlKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIF9yZXQ7XG5cdFx0XHR9XG5cblx0XHRcdC8vIHNlbmQgY3JvcGRhdGFcblx0XHRcdHRoaXMudXBsb2FkZXIudXBsb2FkZXIuYmluZCgnQmVmb3JlVXBsb2FkJyxmdW5jdGlvbiggdXAsIGZpbGUgKSB7XG5cblx0XHRcdFx0aWYgKCBmaWxlLnR5cGUgPT0gJ2FwcGxpY2F0aW9uL3BkZicpIHtcblxuXHRcdFx0XHRcdGZpbGVEYXRhID0gcmVzb2x2ZUZpbGUoIGZpbGUgKTtcblx0XHRcdFx0XHRpZiAoIGZpbGVEYXRhLmJsb2IgaW5zdGFuY2VvZiBCbG9iICkge1xuXHRcdFx0XHRcdFx0dXAuc3RvcCgpO1xuXHRcdFx0XHRcdFx0dXAucmVmcmVzaCgpO1xuXHRcdFx0XHRcdFx0cGRmUG9wdXAoIHVwLCBmaWxlRGF0YSApOyAvLyB3aWxsIGFzayBmb3IgZm9jdXMgb3Igc3RhcnQgdXBsb2FkZXJcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIHBkZnMubGVuZ3RoICkge1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiByZXQ7XG5cdFx0fVxuXHR9KTtcblxufSkoIGpRdWVyeSwgcGRmX3JlbmRlcmVyLCBtT3hpZSApO1xuIl19
